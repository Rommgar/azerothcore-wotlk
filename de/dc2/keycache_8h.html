<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Azerotcore-wotlk: deps/mysqllite/include/keycache.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Azerotcore-wotlk
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_94a36784afa54c0b50996002372b429e.html">deps</a></li><li class="navelem"><a class="el" href="../../dir_c19b06727b8b6746540d83e2aa4b49f4.html">mysqllite</a></li><li class="navelem"><a class="el" href="../../dir_379422bc65188c3afa1824b8cfb6608a.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">keycache.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="../../db/da9/my__sys_8h_source.html">my_sys.h</a>&quot;</code><br />
</div>
<p><a href="../../de/dc2/keycache_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d3e/structst__keycache__wqueue.html">st_keycache_wqueue</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/dcc/structst__key__cache.html">st_key_cache</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a966117cd6dafc9d365a76aa1b3ee9a16"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#a966117cd6dafc9d365a76aa1b3ee9a16">CHANGED_BLOCKS_HASH</a>&#160;&#160;&#160;128             /* must be power of 2 */</td></tr>
<tr class="separator:a966117cd6dafc9d365a76aa1b3ee9a16"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a879cc7f9e19911f69ffed9cfbce3fcf7"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="../../df/d94/structst__block__link.html">st_block_link</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#a879cc7f9e19911f69ffed9cfbce3fcf7">BLOCK_LINK</a></td></tr>
<tr class="separator:a879cc7f9e19911f69ffed9cfbce3fcf7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b7872e3a57d11a1cec01b5278a5d1dd"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="../../d1/d62/structst__keycache__page.html">st_keycache_page</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#a8b7872e3a57d11a1cec01b5278a5d1dd">KEYCACHE_PAGE</a></td></tr>
<tr class="separator:a8b7872e3a57d11a1cec01b5278a5d1dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a516af0726267906d61e4e7b1ef01069a"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="../../df/d23/structst__hash__link.html">st_hash_link</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#a516af0726267906d61e4e7b1ef01069a">HASH_LINK</a></td></tr>
<tr class="separator:a516af0726267906d61e4e7b1ef01069a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c164b4bb06998cb167a177cff7b6b6c"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="../../d6/d3e/structst__keycache__wqueue.html">st_keycache_wqueue</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#a9c164b4bb06998cb167a177cff7b6b6c">KEYCACHE_WQUEUE</a></td></tr>
<tr class="separator:a9c164b4bb06998cb167a177cff7b6b6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab63d266ea0e613e21b0e22fa35d76b0"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="../../d7/dcc/structst__key__cache.html">st_key_cache</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a></td></tr>
<tr class="separator:aab63d266ea0e613e21b0e22fa35d76b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad0fc8526a7a2b14f31b9df818414a224"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#ad0fc8526a7a2b14f31b9df818414a224">init_key_cache</a> (<a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *keycache, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> key_cache_block_size, size_t use_mem, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> division_limit, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> age_threshold)</td></tr>
<tr class="separator:ad0fc8526a7a2b14f31b9df818414a224"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d6892bc7cb4a979cbc23e89a22b386e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#a8d6892bc7cb4a979cbc23e89a22b386e">resize_key_cache</a> (<a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *keycache, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> key_cache_block_size, size_t use_mem, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> division_limit, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> age_threshold)</td></tr>
<tr class="separator:a8d6892bc7cb4a979cbc23e89a22b386e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a108f066be8ee492a53e3e6cca587fd28"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#a108f066be8ee492a53e3e6cca587fd28">change_key_cache_param</a> (<a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *keycache, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> division_limit, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> age_threshold)</td></tr>
<tr class="separator:a108f066be8ee492a53e3e6cca587fd28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd6f0770cfff1e54d9a7db0ef3e4e577"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#abd6f0770cfff1e54d9a7db0ef3e4e577">key_cache_read</a> (<a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *keycache, <a class="el" href="../../d9/df6/my__global_8h.html#ad34d82818831a94a892fcc41a95aa286">File</a> <a class="el" href="../../d2/dbc/deps_2gsoap_2_c_make_lists_8txt.html#ad0ce1f991d58ccbbb91f81e55e48bf2e">file</a>, <a class="el" href="../../d9/df6/my__global_8h.html#acc0910d1e534654a09fa48ac0f37b610">my_off_t</a> filepos, int level, <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *buff, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> length, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> block_length, int return_buffer)</td></tr>
<tr class="separator:abd6f0770cfff1e54d9a7db0ef3e4e577"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6743f1ab031dc202cea8b9ea346d5de"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#aa6743f1ab031dc202cea8b9ea346d5de">key_cache_insert</a> (<a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *keycache, <a class="el" href="../../d9/df6/my__global_8h.html#ad34d82818831a94a892fcc41a95aa286">File</a> <a class="el" href="../../d2/dbc/deps_2gsoap_2_c_make_lists_8txt.html#ad0ce1f991d58ccbbb91f81e55e48bf2e">file</a>, <a class="el" href="../../d9/df6/my__global_8h.html#acc0910d1e534654a09fa48ac0f37b610">my_off_t</a> filepos, int level, <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *buff, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> length)</td></tr>
<tr class="separator:aa6743f1ab031dc202cea8b9ea346d5de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a536057178c79150aca0461dc479ff3af"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#a536057178c79150aca0461dc479ff3af">key_cache_write</a> (<a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *keycache, <a class="el" href="../../d9/df6/my__global_8h.html#ad34d82818831a94a892fcc41a95aa286">File</a> <a class="el" href="../../d2/dbc/deps_2gsoap_2_c_make_lists_8txt.html#ad0ce1f991d58ccbbb91f81e55e48bf2e">file</a>, <a class="el" href="../../d9/df6/my__global_8h.html#acc0910d1e534654a09fa48ac0f37b610">my_off_t</a> filepos, int level, <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *buff, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> length, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> block_length, int force_write)</td></tr>
<tr class="separator:a536057178c79150aca0461dc479ff3af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6a625aa0f0d33a125d42f8520db4ce9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#ab6a625aa0f0d33a125d42f8520db4ce9">flush_key_blocks</a> (<a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *keycache, int <a class="el" href="../../d2/dbc/deps_2gsoap_2_c_make_lists_8txt.html#ad0ce1f991d58ccbbb91f81e55e48bf2e">file</a>, enum <a class="el" href="../../db/da9/my__sys_8h.html#aff94a40cf049a7ffa8c8fdc46b757085">flush_type</a> <a class="el" href="../../d5/d71/fmt_2include_2fmt_2core_8h.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>)</td></tr>
<tr class="separator:ab6a625aa0f0d33a125d42f8520db4ce9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ee68b09652c680c421c3caa4c02a476"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#a8ee68b09652c680c421c3caa4c02a476">end_key_cache</a> (<a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *keycache, <a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> cleanup)</td></tr>
<tr class="separator:a8ee68b09652c680c421c3caa4c02a476"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36f52fe93501e225e7093db427d388d2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#a36f52fe93501e225e7093db427d388d2">multi_keycache_init</a> (void)</td></tr>
<tr class="separator:a36f52fe93501e225e7093db427d388d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e343c6239058b68e9578bcd049f3fc3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#a6e343c6239058b68e9578bcd049f3fc3">multi_keycache_free</a> (void)</td></tr>
<tr class="separator:a6e343c6239058b68e9578bcd049f3fc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21d3d81541b09ac8f23d19694546b8b8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#a21d3d81541b09ac8f23d19694546b8b8">multi_key_cache_search</a> (<a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *key, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> length)</td></tr>
<tr class="separator:a21d3d81541b09ac8f23d19694546b8b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd2882a700e7e0006a4607b0321a1c56"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#abd2882a700e7e0006a4607b0321a1c56">multi_key_cache_set</a> (<a class="el" href="../../de/d95/zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *key, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> length, <a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *key_cache)</td></tr>
<tr class="separator:abd2882a700e7e0006a4607b0321a1c56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf9d3149e967d331fb0ba005c0742684"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#adf9d3149e967d331fb0ba005c0742684">multi_key_cache_change</a> (<a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *old_data, <a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *new_data)</td></tr>
<tr class="separator:adf9d3149e967d331fb0ba005c0742684"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeec97efa27786d6ee8a54c5a4652c6e6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#aeec97efa27786d6ee8a54c5a4652c6e6">reset_key_cache_counters</a> (<a class="el" href="../../de/d95/zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> char *name, <a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *key_cache)</td></tr>
<tr class="separator:aeec97efa27786d6ee8a54c5a4652c6e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a4fc715bfb4b31e5ea371b4613f246d42"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#a4fc715bfb4b31e5ea371b4613f246d42">dflt_key_cache_var</a></td></tr>
<tr class="separator:a4fc715bfb4b31e5ea371b4613f246d42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee6c9bee171d49aee38513123eab9b06"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dc2/keycache_8h.html#aee6c9bee171d49aee38513123eab9b06">dflt_key_cache</a></td></tr>
<tr class="separator:aee6c9bee171d49aee38513123eab9b06"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a966117cd6dafc9d365a76aa1b3ee9a16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a966117cd6dafc9d365a76aa1b3ee9a16">&#9670;&nbsp;</a></span>CHANGED_BLOCKS_HASH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CHANGED_BLOCKS_HASH&#160;&#160;&#160;128             /* must be power of 2 */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/dc2/keycache_8h_source.html#l00040">40</a> of file <a class="el" href="../../de/dc2/keycache_8h_source.html">keycache.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a879cc7f9e19911f69ffed9cfbce3fcf7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a879cc7f9e19911f69ffed9cfbce3fcf7">&#9670;&nbsp;</a></span>BLOCK_LINK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="../../df/d94/structst__block__link.html">st_block_link</a> <a class="el" href="../../de/dc2/keycache_8h.html#a879cc7f9e19911f69ffed9cfbce3fcf7">BLOCK_LINK</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/dc2/keycache_8h_source.html#l00023">23</a> of file <a class="el" href="../../de/dc2/keycache_8h_source.html">keycache.h</a>.</p>

</div>
</div>
<a id="a516af0726267906d61e4e7b1ef01069a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a516af0726267906d61e4e7b1ef01069a">&#9670;&nbsp;</a></span>HASH_LINK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="../../df/d23/structst__hash__link.html">st_hash_link</a> <a class="el" href="../../de/dc2/keycache_8h.html#a516af0726267906d61e4e7b1ef01069a">HASH_LINK</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/dc2/keycache_8h_source.html#l00023">23</a> of file <a class="el" href="../../de/dc2/keycache_8h_source.html">keycache.h</a>.</p>

</div>
</div>
<a id="aab63d266ea0e613e21b0e22fa35d76b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab63d266ea0e613e21b0e22fa35d76b0">&#9670;&nbsp;</a></span>KEY_CACHE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="../../d7/dcc/structst__key__cache.html">st_key_cache</a> <a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8b7872e3a57d11a1cec01b5278a5d1dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b7872e3a57d11a1cec01b5278a5d1dd">&#9670;&nbsp;</a></span>KEYCACHE_PAGE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="../../d1/d62/structst__keycache__page.html">st_keycache_page</a> <a class="el" href="../../de/dc2/keycache_8h.html#a8b7872e3a57d11a1cec01b5278a5d1dd">KEYCACHE_PAGE</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/dc2/keycache_8h_source.html#l00023">23</a> of file <a class="el" href="../../de/dc2/keycache_8h_source.html">keycache.h</a>.</p>

</div>
</div>
<a id="a9c164b4bb06998cb167a177cff7b6b6c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c164b4bb06998cb167a177cff7b6b6c">&#9670;&nbsp;</a></span>KEYCACHE_WQUEUE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="../../d6/d3e/structst__keycache__wqueue.html">st_keycache_wqueue</a> <a class="el" href="../../de/dc2/keycache_8h.html#a9c164b4bb06998cb167a177cff7b6b6c">KEYCACHE_WQUEUE</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a108f066be8ee492a53e3e6cca587fd28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a108f066be8ee492a53e3e6cca587fd28">&#9670;&nbsp;</a></span>change_key_cache_param()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void change_key_cache_param </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *&#160;</td>
          <td class="paramname"><em>keycache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>division_limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>age_threshold</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00695">695</a> of file <a class="el" href="../../d3/d26/mf__keycache_8c_source.html">mf_keycache.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;{</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;change_key_cache_param&quot;</span>);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <a class="code" href="../../d3/d26/mf__keycache_8c.html#a0ba239caffe5972f2aaffa36f1bf1d9e">keycache_pthread_mutex_lock</a>(&amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">cache_lock</a>);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="keywordflow">if</span> (division_limit)</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a5747065352c894e9888321d843039dc2">min_warm_blocks</a>= (keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a> *</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                division_limit / 100 + 1);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordflow">if</span> (age_threshold)</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#acdc4f979ecbe74d9625194ab8f96d596">age_threshold</a>=   (keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a> *</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                age_threshold / 100);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <a class="code" href="../../d3/d26/mf__keycache_8c.html#ae4716d2ef9f38b2e33369931c83a1c27">keycache_pthread_mutex_unlock</a>(&amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">cache_lock</a>);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a2d990f1c0bd095fcbac9c6596274be55">DBUG_VOID_RETURN</a>;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;}</div>
<div class="ttc" id="adbug__long_8h_html_a2d990f1c0bd095fcbac9c6596274be55"><div class="ttname"><a href="../../d1/d35/dbug__long_8h.html#a2d990f1c0bd095fcbac9c6596274be55">DBUG_VOID_RETURN</a></div><div class="ttdeci">#define DBUG_VOID_RETURN</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d35/dbug__long_8h_source.html#l00140">dbug_long.h:140</a></div></div>
<div class="ttc" id="adbug__long_8h_html_a56a51e0edb39d13c83021fd4e7bdc9e9"><div class="ttname"><a href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a></div><div class="ttdeci">#define DBUG_ENTER(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d35/dbug__long_8h_source.html#l00131">dbug_long.h:131</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a0ba239caffe5972f2aaffa36f1bf1d9e"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a0ba239caffe5972f2aaffa36f1bf1d9e">keycache_pthread_mutex_lock</a></div><div class="ttdeci">#define keycache_pthread_mutex_lock(M)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00320">mf_keycache.c:320</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_ae4716d2ef9f38b2e33369931c83a1c27"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#ae4716d2ef9f38b2e33369931c83a1c27">keycache_pthread_mutex_unlock</a></div><div class="ttdeci">#define keycache_pthread_mutex_unlock(M)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00321">mf_keycache.c:321</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a205ccdd3a670b3769a371b0f4b78ecd3"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">st_key_cache::disk_blocks</a></div><div class="ttdeci">int disk_blocks</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00061">keycache.h:61</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a5747065352c894e9888321d843039dc2"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a5747065352c894e9888321d843039dc2">st_key_cache::min_warm_blocks</a></div><div class="ttdeci">ulong min_warm_blocks</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00055">keycache.h:55</a></div></div>
<div class="ttc" id="astructst__key__cache_html_acdc4f979ecbe74d9625194ab8f96d596"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#acdc4f979ecbe74d9625194ab8f96d596">st_key_cache::age_threshold</a></div><div class="ttdeci">ulong age_threshold</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00056">keycache.h:56</a></div></div>
<div class="ttc" id="astructst__key__cache_html_ad5a09f20e50aa7eb71414882ff7e5ba3"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">st_key_cache::cache_lock</a></div><div class="ttdeci">mysql_mutex_t cache_lock</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00076">keycache.h:76</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../de/dc2/keycache_8h_source.html#l00056">st_key_cache::age_threshold</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00076">st_key_cache::cache_lock</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00140">DBUG_VOID_RETURN</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00061">st_key_cache::disk_blocks</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00320">keycache_pthread_mutex_lock</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00321">keycache_pthread_mutex_unlock</a>, and <a class="el" href="../../de/dc2/keycache_8h_source.html#l00055">st_key_cache::min_warm_blocks</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00559">resize_key_cache()</a>.</p>

</div>
</div>
<a id="a8ee68b09652c680c421c3caa4c02a476"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ee68b09652c680c421c3caa4c02a476">&#9670;&nbsp;</a></span>end_key_cache()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void end_key_cache </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *&#160;</td>
          <td class="paramname"><em>keycache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a>&#160;</td>
          <td class="paramname"><em>cleanup</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00724">724</a> of file <a class="el" href="../../d3/d26/mf__keycache_8c_source.html">mf_keycache.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;{</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;end_key_cache&quot;</span>);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;enter&quot;</span>, (<span class="stringliteral">&quot;key_cache: 0x%lx&quot;</span>, (<span class="keywordtype">long</span>) keycache));</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="keywordflow">if</span> (!keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a6b4ca9496f3778ff1fec02fe943e5ce7">key_cache_inited</a>)</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#a2d990f1c0bd095fcbac9c6596274be55">DBUG_VOID_RETURN</a>;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="keywordflow">if</span> (keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a> &gt; 0)</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  {</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">if</span> (keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#abfa3854a1818c0073587b2c91656d253">block_mem</a>)</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <a class="code" href="../../db/da9/my__sys_8h.html#aba32e671624503b488323bcbd0454bef">my_large_free</a>((<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>*) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#abfa3854a1818c0073587b2c91656d253">block_mem</a>);</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#abfa3854a1818c0073587b2c91656d253">block_mem</a>= <a class="code" href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a>;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <a class="code" href="../../db/da9/my__sys_8h.html#a3a3ddffcaadb60b7715c9889f8c56afb">my_free</a>(keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#afbf35ec0d3013bd960d554a5baadbee6">block_root</a>);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#afbf35ec0d3013bd960d554a5baadbee6">block_root</a>= <a class="code" href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a>;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    }</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a>= -1;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="comment">/* Reset blocks_changed to be safe if flush_all_key_blocks is called */</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ab9fefdf1573f621eed3162c7956ae7a2">blocks_changed</a>= 0;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;status&quot;</span>, (<span class="stringliteral">&quot;used: %lu  changed: %lu  w_requests: %lu  &quot;</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                        <span class="stringliteral">&quot;writes: %lu  r_requests: %lu  reads: %lu&quot;</span>,</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                        keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a8be000eb2b02c4546785eea3863852d5">blocks_used</a>, keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#aa4cf975fd8c509c6fc1df2085668ce3f">global_blocks_changed</a>,</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                        (<a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a6cb10b6d1a2973a85d7e12f4d5b8fc4e">global_cache_w_requests</a>,</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                        (<a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ab66e725e66c8d135d522e0fc823fb074">global_cache_write</a>,</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                        (<a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a7644055eb236db90a60a248f8371a80c">global_cache_r_requests</a>,</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                        (<a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a15e6b58b18f34975d9ab3887ef374d04">global_cache_read</a>));</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">    Reset these values to be able to detect a disabled key cache.</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">    See Bug#44068 (RESTORE can disable the MyISAM Key Cache).</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a8be000eb2b02c4546785eea3863852d5">blocks_used</a>= 0;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a10204e4188193d675167a80995d1a32b">blocks_unused</a>= 0;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160; </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="keywordflow">if</span> (cleanup)</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  {</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <a class="code" href="../../de/d55/group___thread__instrumentation.html#ga37298c942ab1882a74ed52b787605132">mysql_mutex_destroy</a>(&amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">cache_lock</a>);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a6b4ca9496f3778ff1fec02fe943e5ce7">key_cache_inited</a>= keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ae8a9712fee09d718d4b75e6cd3425a43">can_be_used</a>= 0;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <a class="code" href="../../d3/d26/mf__keycache_8c.html#a8ee571cefdea70da535b27a8d27f4885">KEYCACHE_DEBUG_CLOSE</a>;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  }</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a2d990f1c0bd095fcbac9c6596274be55">DBUG_VOID_RETURN</a>;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;} <span class="comment">/* end_key_cache */</span></div>
<div class="ttc" id="adbug__long_8h_html_a3770d2ff545ed3e4b714d20014e663df"><div class="ttname"><a href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a></div><div class="ttdeci">#define DBUG_PRINT(keyword, arglist)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d35/dbug__long_8h_source.html#l00143">dbug_long.h:143</a></div></div>
<div class="ttc" id="agroup___thread__instrumentation_html_ga37298c942ab1882a74ed52b787605132"><div class="ttname"><a href="../../de/d55/group___thread__instrumentation.html#ga37298c942ab1882a74ed52b787605132">mysql_mutex_destroy</a></div><div class="ttdeci">#define mysql_mutex_destroy(M)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da5/mysql__thread_8h_source.html#l00261">mysql_thread.h:261</a></div></div>
<div class="ttc" id="ajemalloc__internal_8h_html_ae89ee89f41328ac0ade1e3e26c103570"><div class="ttname"><a href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a></div><div class="ttdeci">arena_t NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d33/jemalloc__internal_8h_source.html#l00624">jemalloc_internal.h:624</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a8ee571cefdea70da535b27a8d27f4885"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a8ee571cefdea70da535b27a8d27f4885">KEYCACHE_DEBUG_CLOSE</a></div><div class="ttdeci">#define KEYCACHE_DEBUG_CLOSE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00268">mf_keycache.c:268</a></div></div>
<div class="ttc" id="amy__global_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00874">my_global.h:874</a></div></div>
<div class="ttc" id="amy__global_8h_html_a718b4eb2652c286f4d42dc18a8e71a1a"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a></div><div class="ttdeci">unsigned long ulong</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00908">my_global.h:908</a></div></div>
<div class="ttc" id="amy__sys_8h_html_a3a3ddffcaadb60b7715c9889f8c56afb"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#a3a3ddffcaadb60b7715c9889f8c56afb">my_free</a></div><div class="ttdeci">void my_free(void *ptr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7c/my__malloc_8c_source.html#l00124">my_malloc.c:124</a></div></div>
<div class="ttc" id="amy__sys_8h_html_aba32e671624503b488323bcbd0454bef"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#aba32e671624503b488323bcbd0454bef">my_large_free</a></div><div class="ttdeci">#define my_large_free(A)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/da9/my__sys_8h_source.html#l00179">my_sys.h:179</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a10204e4188193d675167a80995d1a32b"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a10204e4188193d675167a80995d1a32b">st_key_cache::blocks_unused</a></div><div class="ttdeci">ulong blocks_unused</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00063">keycache.h:63</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a15e6b58b18f34975d9ab3887ef374d04"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a15e6b58b18f34975d9ab3887ef374d04">st_key_cache::global_cache_read</a></div><div class="ttdeci">ulonglong global_cache_read</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00103">keycache.h:103</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a6b4ca9496f3778ff1fec02fe943e5ce7"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a6b4ca9496f3778ff1fec02fe943e5ce7">st_key_cache::key_cache_inited</a></div><div class="ttdeci">my_bool key_cache_inited</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00049">keycache.h:49</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a6cb10b6d1a2973a85d7e12f4d5b8fc4e"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a6cb10b6d1a2973a85d7e12f4d5b8fc4e">st_key_cache::global_cache_w_requests</a></div><div class="ttdeci">ulonglong global_cache_w_requests</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00100">keycache.h:100</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a7644055eb236db90a60a248f8371a80c"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a7644055eb236db90a60a248f8371a80c">st_key_cache::global_cache_r_requests</a></div><div class="ttdeci">ulonglong global_cache_r_requests</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00102">keycache.h:102</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a8be000eb2b02c4546785eea3863852d5"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a8be000eb2b02c4546785eea3863852d5">st_key_cache::blocks_used</a></div><div class="ttdeci">ulong blocks_used</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00062">keycache.h:62</a></div></div>
<div class="ttc" id="astructst__key__cache_html_aa4cf975fd8c509c6fc1df2085668ce3f"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#aa4cf975fd8c509c6fc1df2085668ce3f">st_key_cache::global_blocks_changed</a></div><div class="ttdeci">ulong global_blocks_changed</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00099">keycache.h:99</a></div></div>
<div class="ttc" id="astructst__key__cache_html_ab66e725e66c8d135d522e0fc823fb074"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#ab66e725e66c8d135d522e0fc823fb074">st_key_cache::global_cache_write</a></div><div class="ttdeci">ulonglong global_cache_write</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00101">keycache.h:101</a></div></div>
<div class="ttc" id="astructst__key__cache_html_ab9fefdf1573f621eed3162c7956ae7a2"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#ab9fefdf1573f621eed3162c7956ae7a2">st_key_cache::blocks_changed</a></div><div class="ttdeci">ulong blocks_changed</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00064">keycache.h:64</a></div></div>
<div class="ttc" id="astructst__key__cache_html_abfa3854a1818c0073587b2c91656d253"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#abfa3854a1818c0073587b2c91656d253">st_key_cache::block_mem</a></div><div class="ttdeci">uchar * block_mem</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00073">keycache.h:73</a></div></div>
<div class="ttc" id="astructst__key__cache_html_ae8a9712fee09d718d4b75e6cd3425a43"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#ae8a9712fee09d718d4b75e6cd3425a43">st_key_cache::can_be_used</a></div><div class="ttdeci">my_bool can_be_used</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00052">keycache.h:52</a></div></div>
<div class="ttc" id="astructst__key__cache_html_afbf35ec0d3013bd960d554a5baadbee6"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#afbf35ec0d3013bd960d554a5baadbee6">st_key_cache::block_root</a></div><div class="ttdeci">BLOCK_LINK * block_root</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00072">keycache.h:72</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../de/dc2/keycache_8h_source.html#l00073">st_key_cache::block_mem</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00072">st_key_cache::block_root</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00064">st_key_cache::blocks_changed</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00063">st_key_cache::blocks_unused</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00062">st_key_cache::blocks_used</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00076">st_key_cache::cache_lock</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00052">st_key_cache::can_be_used</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00143">DBUG_PRINT</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00140">DBUG_VOID_RETURN</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00061">st_key_cache::disk_blocks</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00099">st_key_cache::global_blocks_changed</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00102">st_key_cache::global_cache_r_requests</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00103">st_key_cache::global_cache_read</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00100">st_key_cache::global_cache_w_requests</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00101">st_key_cache::global_cache_write</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00049">st_key_cache::key_cache_inited</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00268">KEYCACHE_DEBUG_CLOSE</a>, <a class="el" href="../../d0/d7c/my__malloc_8c_source.html#l00124">my_free()</a>, <a class="el" href="../../db/da9/my__sys_8h_source.html#l00179">my_large_free</a>, <a class="el" href="../../da/da5/mysql__thread_8h_source.html#l00261">mysql_mutex_destroy</a>, and <a class="el" href="../../d9/d33/jemalloc__internal_8h_source.html#l00624">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00559">resize_key_cache()</a>.</p>

</div>
</div>
<a id="ab6a625aa0f0d33a125d42f8520db4ce9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6a625aa0f0d33a125d42f8520db4ce9">&#9670;&nbsp;</a></span>flush_key_blocks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int flush_key_blocks </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *&#160;</td>
          <td class="paramname"><em>keycache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="../../db/da9/my__sys_8h.html#aff94a40cf049a7ffa8c8fdc46b757085">flush_type</a>&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l04035">4035</a> of file <a class="el" href="../../d3/d26/mf__keycache_8c_source.html">mf_keycache.c</a>.</p>
<div class="fragment"><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;{</div>
<div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;  <span class="keywordtype">int</span> res= 0;</div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;flush_key_blocks&quot;</span>);</div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;enter&quot;</span>, (<span class="stringliteral">&quot;keycache: 0x%lx&quot;</span>, (<span class="keywordtype">long</span>) keycache));</div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160; </div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;  <span class="keywordflow">if</span> (!keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a6b4ca9496f3778ff1fec02fe943e5ce7">key_cache_inited</a>)</div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(0);</div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160; </div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;  <a class="code" href="../../d3/d26/mf__keycache_8c.html#a0ba239caffe5972f2aaffa36f1bf1d9e">keycache_pthread_mutex_lock</a>(&amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">cache_lock</a>);</div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;  <span class="comment">/* While waiting for lock, keycache could have been ended. */</span></div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;  <span class="keywordflow">if</span> (keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a> &gt; 0)</div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;  {</div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;    <a class="code" href="../../d3/d26/mf__keycache_8c.html#aeb81aa221bac3bdf5a164716c193acb8">inc_counter_for_resize_op</a>(keycache);</div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;    res= <a class="code" href="../../d3/d26/mf__keycache_8c.html#a2b9e9e39f7a59991a92a06c5b4d33807">flush_key_blocks_int</a>(keycache, <a class="code" href="../../d4/d71/namespacempq.html#a4d9e28a606ab362cda8f825daad0fb49">file</a>, <a class="code" href="../../d5/d71/fmt_2include_2fmt_2core_8h.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a>);</div>
<div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;    <a class="code" href="../../d3/d26/mf__keycache_8c.html#a86be03ac31d3436059c39ee7447d220a">dec_counter_for_resize_op</a>(keycache);</div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;  }</div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;  <a class="code" href="../../d3/d26/mf__keycache_8c.html#ae4716d2ef9f38b2e33369931c83a1c27">keycache_pthread_mutex_unlock</a>(&amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">cache_lock</a>);</div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(res);</div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;}</div>
<div class="ttc" id="adbug__long_8h_html_af63d1bddf8957387d14fe70b8db22b96"><div class="ttname"><a href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a></div><div class="ttdeci">#define DBUG_RETURN(a1)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d35/dbug__long_8h_source.html#l00138">dbug_long.h:138</a></div></div>
<div class="ttc" id="afmt_2include_2fmt_2core_8h_html_a7aead736a07eaf25623ad7bfa1f0ee2d"><div class="ttname"><a href="../../d5/d71/fmt_2include_2fmt_2core_8h.html#a7aead736a07eaf25623ad7bfa1f0ee2d">type</a></div><div class="ttdeci">type</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d71/fmt_2include_2fmt_2core_8h_source.html#l01048">core.h:1048</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a2b9e9e39f7a59991a92a06c5b4d33807"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a2b9e9e39f7a59991a92a06c5b4d33807">flush_key_blocks_int</a></div><div class="ttdeci">static int flush_key_blocks_int(KEY_CACHE *keycache, File file, enum flush_type type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l03586">mf_keycache.c:3586</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a86be03ac31d3436059c39ee7447d220a"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a86be03ac31d3436059c39ee7447d220a">dec_counter_for_resize_op</a></div><div class="ttdeci">static void dec_counter_for_resize_op(KEY_CACHE *keycache)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00671">mf_keycache.c:671</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_aeb81aa221bac3bdf5a164716c193acb8"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#aeb81aa221bac3bdf5a164716c193acb8">inc_counter_for_resize_op</a></div><div class="ttdeci">static void inc_counter_for_resize_op(KEY_CACHE *keycache)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00661">mf_keycache.c:661</a></div></div>
<div class="ttc" id="anamespacempq_html_a4d9e28a606ab362cda8f825daad0fb49"><div class="ttname"><a href="../../d4/d71/namespacempq.html#a4d9e28a606ab362cda8f825daad0fb49">mpq.file</a></div><div class="ttdeci">file</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d3e/mpq_8py_source.html#l00283">mpq.py:283</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../de/dc2/keycache_8h_source.html#l00076">st_key_cache::cache_lock</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00143">DBUG_PRINT</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00138">DBUG_RETURN</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00671">dec_counter_for_resize_op()</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00061">st_key_cache::disk_blocks</a>, <a class="el" href="../../d6/d3e/mpq_8py_source.html#l00283">mpq::file</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l03586">flush_key_blocks_int()</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00661">inc_counter_for_resize_op()</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00049">st_key_cache::key_cache_inited</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00320">keycache_pthread_mutex_lock</a>, and <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00321">keycache_pthread_mutex_unlock</a>.</p>

</div>
</div>
<a id="ad0fc8526a7a2b14f31b9df818414a224"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0fc8526a7a2b14f31b9df818414a224">&#9670;&nbsp;</a></span>init_key_cache()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_key_cache </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *&#160;</td>
          <td class="paramname"><em>keycache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>key_cache_block_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>use_mem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>division_limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>age_threshold</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00366">366</a> of file <a class="el" href="../../d3/d26/mf__keycache_8c_source.html">mf_keycache.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;{</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> blocks, hash_links;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d3/dc6/minigzip_8c.html#aee763da2c1c9da197307bad1d009513d">error</a>;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;init_key_cache&quot;</span>);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(key_cache_block_size &gt;= 512);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <a class="code" href="../../d3/d26/mf__keycache_8c.html#a1d4c7082211af7b0a0d2e1594785aa3e">KEYCACHE_DEBUG_OPEN</a>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keywordflow">if</span> (keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a6b4ca9496f3778ff1fec02fe943e5ce7">key_cache_inited</a> &amp;&amp; keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a> &gt; 0)</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;warning&quot;</span>,(<span class="stringliteral">&quot;key cache already in use&quot;</span>));</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(0);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a6cb10b6d1a2973a85d7e12f4d5b8fc4e">global_cache_w_requests</a>= keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a7644055eb236db90a60a248f8371a80c">global_cache_r_requests</a>= 0;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a15e6b58b18f34975d9ab3887ef374d04">global_cache_read</a>= keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ab66e725e66c8d135d522e0fc823fb074">global_cache_write</a>= 0;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a>= -1;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="keywordflow">if</span> (! keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a6b4ca9496f3778ff1fec02fe943e5ce7">key_cache_inited</a>)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a6b4ca9496f3778ff1fec02fe943e5ce7">key_cache_inited</a>= 1;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">      Initialize these variables once only.</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">      Their value must survive re-initialization during resizing.</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a45604227ffc828dfcfd01f51cdf8201f">in_resize</a>= 0;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a65a0f39109ebd8cea95c413231d9b5c8">resize_in_flush</a>= 0;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a195a3307538d819f13b9e91a025b4a8f">cnt_for_resize_op</a>= 0;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ae3c67ed105880d4caf9f1664140a21b8">waiting_for_resize_cnt</a>.<a class="code" href="../../d6/d3e/structst__keycache__wqueue.html#a27c0709f688c35d2d8dda33b3d5afbc5">last_thread</a>= <a class="code" href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a>;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a6a006dd56ebd3b5e4ae9a485799881c5">in_init</a>= 0;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="../../de/d55/group___thread__instrumentation.html#gaf4fc58e68eb34057e9954944a34824c1">mysql_mutex_init</a>(key_KEY_CACHE_cache_lock,</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                     &amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">cache_lock</a>, <a class="code" href="../../da/da8/my__pthread_8h.html#a7ac1faca6820fee0cb790ee7a7e68fea">MY_MUTEX_INIT_FAST</a>);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ab1c68aadca5cfa66a26b6a6c5f01581f">resize_queue</a>.<a class="code" href="../../d6/d3e/structst__keycache__wqueue.html#a27c0709f688c35d2d8dda33b3d5afbc5">last_thread</a>= <a class="code" href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a>;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a8a83a6143b60800f36c9e4ec01b1e0c7">key_cache_mem_size</a>= use_mem;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#af799030c4672e0745d41fcd1237c0cfc">key_cache_block_size</a>= key_cache_block_size;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;info&quot;</span>, (<span class="stringliteral">&quot;key_cache_block_size: %u&quot;</span>,</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;              key_cache_block_size));</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  blocks= (<a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) (use_mem / (<span class="keyword">sizeof</span>(<a class="code" href="../../df/d94/structst__block__link.html">BLOCK_LINK</a>) + 2 * <span class="keyword">sizeof</span>(<a class="code" href="../../df/d23/structst__hash__link.html">HASH_LINK</a>) +</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                              <span class="keyword">sizeof</span>(<a class="code" href="../../df/d23/structst__hash__link.html">HASH_LINK</a>*) * 5/4 + key_cache_block_size));</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="comment">/* It doesn&#39;t make sense to have too few blocks (less than 8) */</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keywordflow">if</span> (blocks &gt;= 8)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">for</span> ( ; ; )</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      <span class="comment">/* Set my_hash_entries to the next bigger 2 power */</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keywordflow">if</span> ((keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a73ec6aff3cdadaa94423c34117335d38">hash_entries</a>= <a class="code" href="../../d3/d26/mf__keycache_8c.html#a27848979817f779cd73b4a58b6fcccaf">next_power</a>(blocks)) &lt; blocks * 5/4)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a73ec6aff3cdadaa94423c34117335d38">hash_entries</a>&lt;&lt;= 1;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      hash_links= 2 * blocks;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;#<span class="keywordflow">if</span> defined(<a class="code" href="../../d1/d09/thr__lock_8c.html#a8b5173357adb02a86c027316e0acdfa0">MAX_THREADS</a>)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="keywordflow">if</span> (hash_links &lt; <a class="code" href="../../d1/d09/thr__lock_8c.html#a8b5173357adb02a86c027316e0acdfa0">MAX_THREADS</a> + blocks - 1)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        hash_links= <a class="code" href="../../d1/d09/thr__lock_8c.html#a8b5173357adb02a86c027316e0acdfa0">MAX_THREADS</a> + blocks - 1;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      <span class="keywordflow">while</span> ((<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>= (<a class="code" href="../../d9/df6/my__global_8h.html#a4765fea979c5ff199c51806810fe18a4">ALIGN_SIZE</a>(blocks * <span class="keyword">sizeof</span>(<a class="code" href="../../df/d94/structst__block__link.html">BLOCK_LINK</a>)) +</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;               <a class="code" href="../../d9/df6/my__global_8h.html#a4765fea979c5ff199c51806810fe18a4">ALIGN_SIZE</a>(hash_links * <span class="keyword">sizeof</span>(<a class="code" href="../../df/d23/structst__hash__link.html">HASH_LINK</a>)) +</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;               <a class="code" href="../../d9/df6/my__global_8h.html#a4765fea979c5ff199c51806810fe18a4">ALIGN_SIZE</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../df/d23/structst__hash__link.html">HASH_LINK</a>*) *</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                                  keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a73ec6aff3cdadaa94423c34117335d38">hash_entries</a>))) +</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;         ((size_t) blocks * keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#af799030c4672e0745d41fcd1237c0cfc">key_cache_block_size</a>) &gt; use_mem)</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        blocks--;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="comment">/* Allocate memory for cache page buffers */</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordflow">if</span> ((keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#abfa3854a1818c0073587b2c91656d253">block_mem</a>=</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;       <a class="code" href="../../db/da9/my__sys_8h.html#aeddd90998bb0136c794fc7ba7e54adb5">my_large_malloc</a>((<span class="keywordtype">size_t</span>) blocks * keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#af799030c4672e0745d41fcd1237c0cfc">key_cache_block_size</a>,</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;              <a class="code" href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a>(0))))</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">      Allocate memory for blocks, hash_links and hash entries;</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">      For each block 2 hash links are allocated</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="keywordflow">if</span> ((keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#afbf35ec0d3013bd960d554a5baadbee6">block_root</a>= (<a class="code" href="../../df/d94/structst__block__link.html">BLOCK_LINK</a>*) <a class="code" href="../../db/da9/my__sys_8h.html#a8f7b30ff5d0e10610637aa30c3e0048b">my_malloc</a>(<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>,</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                                                           <a class="code" href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a>(0))))</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <a class="code" href="../../db/da9/my__sys_8h.html#aba32e671624503b488323bcbd0454bef">my_large_free</a>(keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#abfa3854a1818c0073587b2c91656d253">block_mem</a>);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#abfa3854a1818c0073587b2c91656d253">block_mem</a>= 0;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordflow">if</span> (blocks &lt; 8)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <a class="code" href="../../da/da8/my__pthread_8h.html#ab607b8ccc65b942b3d56aa2aa2e507eb">my_errno</a>= ENOMEM;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <a class="code" href="../../db/da9/my__sys_8h.html#a19ebf963aef6b242322e15e01811972e">my_error</a>(<a class="code" href="../../d3/dcf/mysys__err_8h.html#ac6ce260c4e07352e8294c636515fb5a1">EE_OUTOFMEMORY</a>, <a class="code" href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a>(0), blocks * keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#af799030c4672e0745d41fcd1237c0cfc">key_cache_block_size</a>);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">goto</span> err;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      }</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      blocks= blocks / 4*3;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a10204e4188193d675167a80995d1a32b">blocks_unused</a>= blocks;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a>= (int) blocks;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a69f530a3a5ae02a0bb977610791a4ebc">hash_links</a>= hash_links;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a214bb6292a1e28f1e2097529b89fcd2a">hash_root</a>= (<a class="code" href="../../df/d23/structst__hash__link.html">HASH_LINK</a>**) ((<span class="keywordtype">char</span>*) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#afbf35ec0d3013bd960d554a5baadbee6">block_root</a> +</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                        <a class="code" href="../../d9/df6/my__global_8h.html#a4765fea979c5ff199c51806810fe18a4">ALIGN_SIZE</a>(blocks*<span class="keyword">sizeof</span>(<a class="code" href="../../df/d94/structst__block__link.html">BLOCK_LINK</a>)));</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a1f7547833bea84dfaf15a6726c49fa9f">hash_link_root</a>= (<a class="code" href="../../df/d23/structst__hash__link.html">HASH_LINK</a>*) ((<span class="keywordtype">char</span>*) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a214bb6292a1e28f1e2097529b89fcd2a">hash_root</a> +</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                            <a class="code" href="../../d9/df6/my__global_8h.html#a4765fea979c5ff199c51806810fe18a4">ALIGN_SIZE</a>((<span class="keyword">sizeof</span>(<a class="code" href="../../df/d23/structst__hash__link.html">HASH_LINK</a>*) *</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                            keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a73ec6aff3cdadaa94423c34117335d38">hash_entries</a>)));</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <a class="code" href="../../d6/dda/m__string_8h.html#ab3be5dcbbf1244672c14662b20f88b61">bzero</a>((<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>*) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#afbf35ec0d3013bd960d554a5baadbee6">block_root</a>,</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../df/d94/structst__block__link.html">BLOCK_LINK</a>));</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <a class="code" href="../../d6/dda/m__string_8h.html#ab3be5dcbbf1244672c14662b20f88b61">bzero</a>((<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>*) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a214bb6292a1e28f1e2097529b89fcd2a">hash_root</a>,</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;          keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a73ec6aff3cdadaa94423c34117335d38">hash_entries</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../df/d23/structst__hash__link.html">HASH_LINK</a>*));</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <a class="code" href="../../d6/dda/m__string_8h.html#ab3be5dcbbf1244672c14662b20f88b61">bzero</a>((<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>*) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a1f7547833bea84dfaf15a6726c49fa9f">hash_link_root</a>,</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a69f530a3a5ae02a0bb977610791a4ebc">hash_links</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../df/d23/structst__hash__link.html">HASH_LINK</a>));</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a01c4fedeb76ae5e06f29f7d1eeba7583">hash_links_used</a>= 0;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#aa8b767d9e296d3aba7c4adcd489e85d1">free_hash_list</a>= <a class="code" href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a8be000eb2b02c4546785eea3863852d5">blocks_used</a>= keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ab9fefdf1573f621eed3162c7956ae7a2">blocks_changed</a>= 0;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#aa4cf975fd8c509c6fc1df2085668ce3f">global_blocks_changed</a>= 0;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a03be2b9cb9f4d32f9f7e051561f44f6e">blocks_available</a>=0;       <span class="comment">/* For debugging */</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">/* The LRU chain is empty after initialization */</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a0fd6f4a7b37644e6593ec2109ae6a6d1">used_last</a>= <a class="code" href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a>;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a0aba6e5828e9f03609870adee8d794d1">used_ins</a>= <a class="code" href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a>;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a8c3951279d9f519a03b3f5f58e287f77">free_block_list</a>= <a class="code" href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a>;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a6d94ce3a7dd45735a3791f499fac1b48">keycache_time</a>= 0;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ab3dd090ab676f8dbffb26e6417871a26">warm_blocks</a>= 0;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a5747065352c894e9888321d843039dc2">min_warm_blocks</a>= (division_limit ?</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                blocks * division_limit / 100 + 1 :</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                blocks);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#acdc4f979ecbe74d9625194ab8f96d596">age_threshold</a>= (age_threshold ?</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                  blocks * age_threshold / 100 :</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                  blocks);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ae8a9712fee09d718d4b75e6cd3425a43">can_be_used</a>= 1;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a70c8ed6c22a38a7cc7825d45043d7ced">waiting_for_hash_link</a>.<a class="code" href="../../d6/d3e/structst__keycache__wqueue.html#a27c0709f688c35d2d8dda33b3d5afbc5">last_thread</a>= <a class="code" href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a>;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#afdb802b84e665d8365ebb1593647e4e2">waiting_for_block</a>.<a class="code" href="../../d6/d3e/structst__keycache__wqueue.html#a27c0709f688c35d2d8dda33b3d5afbc5">last_thread</a>= <a class="code" href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a>;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;exit&quot;</span>,</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;           (<span class="stringliteral">&quot;disk_blocks: %d  block_root: 0x%lx  hash_entries: %d\</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="stringliteral"> hash_root: 0x%lx  hash_links: %d  hash_link_root: 0x%lx&quot;</span>,</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a>,  (<span class="keywordtype">long</span>) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#afbf35ec0d3013bd960d554a5baadbee6">block_root</a>,</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a73ec6aff3cdadaa94423c34117335d38">hash_entries</a>, (<span class="keywordtype">long</span>) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a214bb6292a1e28f1e2097529b89fcd2a">hash_root</a>,</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a69f530a3a5ae02a0bb977610791a4ebc">hash_links</a>,   (<span class="keywordtype">long</span>) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a1f7547833bea84dfaf15a6726c49fa9f">hash_link_root</a>));</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <a class="code" href="../../d6/dda/m__string_8h.html#ab3be5dcbbf1244672c14662b20f88b61">bzero</a>((<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>*) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#afc91103c4a90a69b7e37e708398b3a82">changed_blocks</a>,</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="keyword">sizeof</span>(keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#afc91103c4a90a69b7e37e708398b3a82">changed_blocks</a>[0]) * <a class="code" href="../../de/dc2/keycache_8h.html#a966117cd6dafc9d365a76aa1b3ee9a16">CHANGED_BLOCKS_HASH</a>);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="../../d6/dda/m__string_8h.html#ab3be5dcbbf1244672c14662b20f88b61">bzero</a>((<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>*) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a6b08e79e1efa06fdce15f26d5a68aacf">file_blocks</a>,</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      <span class="keyword">sizeof</span>(keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a6b08e79e1efa06fdce15f26d5a68aacf">file_blocks</a>[0]) * <a class="code" href="../../de/dc2/keycache_8h.html#a966117cd6dafc9d365a76aa1b3ee9a16">CHANGED_BLOCKS_HASH</a>);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  }</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="comment">/* key_buffer_size is specified too small. Disable the cache. */</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ae8a9712fee09d718d4b75e6cd3425a43">can_be_used</a>= 0;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a53fccf40f036616da23983f571bacb5c">blocks</a>= keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a> &gt; 0 ? keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a> : 0;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>((<span class="keywordtype">int</span>) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a>);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;err:</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <a class="code" href="../../d3/dc6/minigzip_8c.html#aee763da2c1c9da197307bad1d009513d">error</a>= <a class="code" href="../../da/da8/my__pthread_8h.html#ab607b8ccc65b942b3d56aa2aa2e507eb">my_errno</a>;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a>= 0;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a53fccf40f036616da23983f571bacb5c">blocks</a>=  0;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keywordflow">if</span> (keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#abfa3854a1818c0073587b2c91656d253">block_mem</a>)</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <a class="code" href="../../db/da9/my__sys_8h.html#aba32e671624503b488323bcbd0454bef">my_large_free</a>((<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>*) keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#abfa3854a1818c0073587b2c91656d253">block_mem</a>);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#abfa3854a1818c0073587b2c91656d253">block_mem</a>= <a class="code" href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a>;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  }</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keywordflow">if</span> (keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#afbf35ec0d3013bd960d554a5baadbee6">block_root</a>)</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  {</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <a class="code" href="../../db/da9/my__sys_8h.html#a3a3ddffcaadb60b7715c9889f8c56afb">my_free</a>(keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#afbf35ec0d3013bd960d554a5baadbee6">block_root</a>);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#afbf35ec0d3013bd960d554a5baadbee6">block_root</a>= <a class="code" href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <a class="code" href="../../da/da8/my__pthread_8h.html#ab607b8ccc65b942b3d56aa2aa2e507eb">my_errno</a>= <a class="code" href="../../d3/dc6/minigzip_8c.html#aee763da2c1c9da197307bad1d009513d">error</a>;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ae8a9712fee09d718d4b75e6cd3425a43">can_be_used</a>= 0;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(0);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;}</div>
<div class="ttc" id="agroup___thread__instrumentation_html_gaf4fc58e68eb34057e9954944a34824c1"><div class="ttname"><a href="../../de/d55/group___thread__instrumentation.html#gaf4fc58e68eb34057e9954944a34824c1">mysql_mutex_init</a></div><div class="ttdeci">#define mysql_mutex_init(K, M, A)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da5/mysql__thread_8h_source.html#l00246">mysql_thread.h:246</a></div></div>
<div class="ttc" id="akeycache_8h_html_a966117cd6dafc9d365a76aa1b3ee9a16"><div class="ttname"><a href="../../de/dc2/keycache_8h.html#a966117cd6dafc9d365a76aa1b3ee9a16">CHANGED_BLOCKS_HASH</a></div><div class="ttdeci">#define CHANGED_BLOCKS_HASH</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00040">keycache.h:40</a></div></div>
<div class="ttc" id="am__string_8h_html_ab3be5dcbbf1244672c14662b20f88b61"><div class="ttname"><a href="../../d6/dda/m__string_8h.html#ab3be5dcbbf1244672c14662b20f88b61">bzero</a></div><div class="ttdeci">#define bzero(A, B)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dda/m__string_8h_source.html#l00063">m_string.h:63</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a1d4c7082211af7b0a0d2e1594785aa3e"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a1d4c7082211af7b0a0d2e1594785aa3e">KEYCACHE_DEBUG_OPEN</a></div><div class="ttdeci">#define KEYCACHE_DEBUG_OPEN</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00267">mf_keycache.c:267</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a27848979817f779cd73b4a58b6fcccaf"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a27848979817f779cd73b4a58b6fcccaf">next_power</a></div><div class="ttdeci">static uint next_power(uint value)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00335">mf_keycache.c:335</a></div></div>
<div class="ttc" id="aminigzip_8c_html_aee763da2c1c9da197307bad1d009513d"><div class="ttname"><a href="../../d3/dc6/minigzip_8c.html#aee763da2c1c9da197307bad1d009513d">error</a></div><div class="ttdeci">void error(char *msg) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dc6/minigzip_8c_source.html#l00156">minigzip.c:156</a></div></div>
<div class="ttc" id="amy__dbug_8h_html_af5d75f213550ec27715b65d9bdfa45ec"><div class="ttname"><a href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a></div><div class="ttdeci">#define DBUG_ASSERT(A)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d74/my__dbug_8h_source.html#l00096">my_dbug.h:96</a></div></div>
<div class="ttc" id="amy__global_8h_html_a4765fea979c5ff199c51806810fe18a4"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#a4765fea979c5ff199c51806810fe18a4">ALIGN_SIZE</a></div><div class="ttdeci">#define ALIGN_SIZE(A)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00839">my_global.h:839</a></div></div>
<div class="ttc" id="amy__global_8h_html_ab3b3804e3bf2734c0f4f1c72f30df1bd"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a></div><div class="ttdeci">#define MYF(v)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00995">my_global.h:995</a></div></div>
<div class="ttc" id="amy__pthread_8h_html_a7ac1faca6820fee0cb790ee7a7e68fea"><div class="ttname"><a href="../../da/da8/my__pthread_8h.html#a7ac1faca6820fee0cb790ee7a7e68fea">MY_MUTEX_INIT_FAST</a></div><div class="ttdeci">#define MY_MUTEX_INIT_FAST</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da8/my__pthread_8h_source.html#l00792">my_pthread.h:792</a></div></div>
<div class="ttc" id="amy__pthread_8h_html_ab607b8ccc65b942b3d56aa2aa2e507eb"><div class="ttname"><a href="../../da/da8/my__pthread_8h.html#ab607b8ccc65b942b3d56aa2aa2e507eb">my_errno</a></div><div class="ttdeci">#define my_errno</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da8/my__pthread_8h_source.html#l00862">my_pthread.h:862</a></div></div>
<div class="ttc" id="amy__sys_8h_html_a19ebf963aef6b242322e15e01811972e"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#a19ebf963aef6b242322e15e01811972e">my_error</a></div><div class="ttdeci">void my_error(int nr, myf MyFlags,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc6/my__error_8c_source.html#l00071">my_error.c:71</a></div></div>
<div class="ttc" id="amy__sys_8h_html_a8f7b30ff5d0e10610637aa30c3e0048b"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#a8f7b30ff5d0e10610637aa30c3e0048b">my_malloc</a></div><div class="ttdeci">void * my_malloc(size_t Size, myf MyFlags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7c/my__malloc_8c_source.html#l00028">my_malloc.c:28</a></div></div>
<div class="ttc" id="amy__sys_8h_html_aeddd90998bb0136c794fc7ba7e54adb5"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#aeddd90998bb0136c794fc7ba7e54adb5">my_large_malloc</a></div><div class="ttdeci">#define my_large_malloc(A, B)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/da9/my__sys_8h_source.html#l00178">my_sys.h:178</a></div></div>
<div class="ttc" id="amysys__err_8h_html_ac6ce260c4e07352e8294c636515fb5a1"><div class="ttname"><a href="../../d3/dcf/mysys__err_8h.html#ac6ce260c4e07352e8294c636515fb5a1">EE_OUTOFMEMORY</a></div><div class="ttdeci">#define EE_OUTOFMEMORY</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dcf/mysys__err_8h_source.html#l00041">mysys_err.h:41</a></div></div>
<div class="ttc" id="anamespace_g3_d_html_a69a355f92fa3aab4f301667be00cd3eb"><div class="ttname"><a href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">G3D::length</a></div><div class="ttdeci">float length(float v)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d0b/vector_math_8h_source.html#l00208">vectorMath.h:208</a></div></div>
<div class="ttc" id="astructst__block__link_html"><div class="ttname"><a href="../../df/d94/structst__block__link.html">st_block_link</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00203">mf_keycache.c:204</a></div></div>
<div class="ttc" id="astructst__hash__link_html"><div class="ttname"><a href="../../df/d23/structst__hash__link.html">st_hash_link</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00173">mf_keycache.c:174</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a01c4fedeb76ae5e06f29f7d1eeba7583"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a01c4fedeb76ae5e06f29f7d1eeba7583">st_key_cache::hash_links_used</a></div><div class="ttdeci">int hash_links_used</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00060">keycache.h:60</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a03be2b9cb9f4d32f9f7e051561f44f6e"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a03be2b9cb9f4d32f9f7e051561f44f6e">st_key_cache::blocks_available</a></div><div class="ttdeci">long blocks_available</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00067">keycache.h:67</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a0aba6e5828e9f03609870adee8d794d1"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a0aba6e5828e9f03609870adee8d794d1">st_key_cache::used_ins</a></div><div class="ttdeci">BLOCK_LINK * used_ins</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00075">keycache.h:75</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a0fd6f4a7b37644e6593ec2109ae6a6d1"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a0fd6f4a7b37644e6593ec2109ae6a6d1">st_key_cache::used_last</a></div><div class="ttdeci">BLOCK_LINK * used_last</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00074">keycache.h:74</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a195a3307538d819f13b9e91a025b4a8f"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a195a3307538d819f13b9e91a025b4a8f">st_key_cache::cnt_for_resize_op</a></div><div class="ttdeci">ulong cnt_for_resize_op</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00066">keycache.h:66</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a1f7547833bea84dfaf15a6726c49fa9f"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a1f7547833bea84dfaf15a6726c49fa9f">st_key_cache::hash_link_root</a></div><div class="ttdeci">HASH_LINK * hash_link_root</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00069">keycache.h:69</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a214bb6292a1e28f1e2097529b89fcd2a"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a214bb6292a1e28f1e2097529b89fcd2a">st_key_cache::hash_root</a></div><div class="ttdeci">HASH_LINK ** hash_root</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00068">keycache.h:68</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a45604227ffc828dfcfd01f51cdf8201f"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a45604227ffc828dfcfd01f51cdf8201f">st_key_cache::in_resize</a></div><div class="ttdeci">my_bool in_resize</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00050">keycache.h:50</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a53fccf40f036616da23983f571bacb5c"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a53fccf40f036616da23983f571bacb5c">st_key_cache::blocks</a></div><div class="ttdeci">int blocks</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00105">keycache.h:105</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a65a0f39109ebd8cea95c413231d9b5c8"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a65a0f39109ebd8cea95c413231d9b5c8">st_key_cache::resize_in_flush</a></div><div class="ttdeci">my_bool resize_in_flush</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00051">keycache.h:51</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a69f530a3a5ae02a0bb977610791a4ebc"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a69f530a3a5ae02a0bb977610791a4ebc">st_key_cache::hash_links</a></div><div class="ttdeci">int hash_links</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00059">keycache.h:59</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a6a006dd56ebd3b5e4ae9a485799881c5"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a6a006dd56ebd3b5e4ae9a485799881c5">st_key_cache::in_init</a></div><div class="ttdeci">my_bool in_init</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00106">keycache.h:106</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a6b08e79e1efa06fdce15f26d5a68aacf"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a6b08e79e1efa06fdce15f26d5a68aacf">st_key_cache::file_blocks</a></div><div class="ttdeci">BLOCK_LINK * file_blocks[CHANGED_BLOCKS_HASH]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00086">keycache.h:86</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a6d94ce3a7dd45735a3791f499fac1b48"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a6d94ce3a7dd45735a3791f499fac1b48">st_key_cache::keycache_time</a></div><div class="ttdeci">ulonglong keycache_time</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00057">keycache.h:57</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a70c8ed6c22a38a7cc7825d45043d7ced"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a70c8ed6c22a38a7cc7825d45043d7ced">st_key_cache::waiting_for_hash_link</a></div><div class="ttdeci">KEYCACHE_WQUEUE waiting_for_hash_link</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00083">keycache.h:83</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a73ec6aff3cdadaa94423c34117335d38"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a73ec6aff3cdadaa94423c34117335d38">st_key_cache::hash_entries</a></div><div class="ttdeci">uint hash_entries</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00058">keycache.h:58</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a8a83a6143b60800f36c9e4ec01b1e0c7"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a8a83a6143b60800f36c9e4ec01b1e0c7">st_key_cache::key_cache_mem_size</a></div><div class="ttdeci">size_t key_cache_mem_size</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00053">keycache.h:53</a></div></div>
<div class="ttc" id="astructst__key__cache_html_a8c3951279d9f519a03b3f5f58e287f77"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#a8c3951279d9f519a03b3f5f58e287f77">st_key_cache::free_block_list</a></div><div class="ttdeci">BLOCK_LINK * free_block_list</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00071">keycache.h:71</a></div></div>
<div class="ttc" id="astructst__key__cache_html_aa8b767d9e296d3aba7c4adcd489e85d1"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#aa8b767d9e296d3aba7c4adcd489e85d1">st_key_cache::free_hash_list</a></div><div class="ttdeci">HASH_LINK * free_hash_list</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00070">keycache.h:70</a></div></div>
<div class="ttc" id="astructst__key__cache_html_ab1c68aadca5cfa66a26b6a6c5f01581f"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#ab1c68aadca5cfa66a26b6a6c5f01581f">st_key_cache::resize_queue</a></div><div class="ttdeci">KEYCACHE_WQUEUE resize_queue</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00077">keycache.h:77</a></div></div>
<div class="ttc" id="astructst__key__cache_html_ab3dd090ab676f8dbffb26e6417871a26"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#ab3dd090ab676f8dbffb26e6417871a26">st_key_cache::warm_blocks</a></div><div class="ttdeci">ulong warm_blocks</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00065">keycache.h:65</a></div></div>
<div class="ttc" id="astructst__key__cache_html_ae3c67ed105880d4caf9f1664140a21b8"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#ae3c67ed105880d4caf9f1664140a21b8">st_key_cache::waiting_for_resize_cnt</a></div><div class="ttdeci">KEYCACHE_WQUEUE waiting_for_resize_cnt</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00082">keycache.h:82</a></div></div>
<div class="ttc" id="astructst__key__cache_html_af799030c4672e0745d41fcd1237c0cfc"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#af799030c4672e0745d41fcd1237c0cfc">st_key_cache::key_cache_block_size</a></div><div class="ttdeci">uint key_cache_block_size</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00054">keycache.h:54</a></div></div>
<div class="ttc" id="astructst__key__cache_html_afc91103c4a90a69b7e37e708398b3a82"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#afc91103c4a90a69b7e37e708398b3a82">st_key_cache::changed_blocks</a></div><div class="ttdeci">BLOCK_LINK * changed_blocks[CHANGED_BLOCKS_HASH]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00085">keycache.h:85</a></div></div>
<div class="ttc" id="astructst__key__cache_html_afdb802b84e665d8365ebb1593647e4e2"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html#afdb802b84e665d8365ebb1593647e4e2">st_key_cache::waiting_for_block</a></div><div class="ttdeci">KEYCACHE_WQUEUE waiting_for_block</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00084">keycache.h:84</a></div></div>
<div class="ttc" id="astructst__keycache__wqueue_html_a27c0709f688c35d2d8dda33b3d5afbc5"><div class="ttname"><a href="../../d6/d3e/structst__keycache__wqueue.html#a27c0709f688c35d2d8dda33b3d5afbc5">st_keycache_wqueue::last_thread</a></div><div class="ttdeci">struct st_my_thread_var * last_thread</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00037">keycache.h:37</a></div></div>
<div class="ttc" id="athr__lock_8c_html_a8b5173357adb02a86c027316e0acdfa0"><div class="ttname"><a href="../../d1/d09/thr__lock_8c.html#a8b5173357adb02a86c027316e0acdfa0">MAX_THREADS</a></div><div class="ttdeci">#define MAX_THREADS</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d09/thr__lock_8c_source.html#l00086">thr_lock.c:86</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../de/dc2/keycache_8h_source.html#l00056">st_key_cache::age_threshold</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l00839">ALIGN_SIZE</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00073">st_key_cache::block_mem</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00072">st_key_cache::block_root</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00105">st_key_cache::blocks</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00067">st_key_cache::blocks_available</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00064">st_key_cache::blocks_changed</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00063">st_key_cache::blocks_unused</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00062">st_key_cache::blocks_used</a>, <a class="el" href="../../d6/dda/m__string_8h_source.html#l00063">bzero</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00076">st_key_cache::cache_lock</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00052">st_key_cache::can_be_used</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00085">st_key_cache::changed_blocks</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00040">CHANGED_BLOCKS_HASH</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00066">st_key_cache::cnt_for_resize_op</a>, <a class="el" href="../../d0/d74/my__dbug_8h_source.html#l00096">DBUG_ASSERT</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00143">DBUG_PRINT</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00138">DBUG_RETURN</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00061">st_key_cache::disk_blocks</a>, <a class="el" href="../../d3/dcf/mysys__err_8h_source.html#l00041">EE_OUTOFMEMORY</a>, <a class="el" href="../../d3/dc6/minigzip_8c_source.html#l00156">error()</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00086">st_key_cache::file_blocks</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00071">st_key_cache::free_block_list</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00070">st_key_cache::free_hash_list</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00099">st_key_cache::global_blocks_changed</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00102">st_key_cache::global_cache_r_requests</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00103">st_key_cache::global_cache_read</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00100">st_key_cache::global_cache_w_requests</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00101">st_key_cache::global_cache_write</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00058">st_key_cache::hash_entries</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00069">st_key_cache::hash_link_root</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00059">st_key_cache::hash_links</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00060">st_key_cache::hash_links_used</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00068">st_key_cache::hash_root</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00106">st_key_cache::in_init</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00050">st_key_cache::in_resize</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00054">st_key_cache::key_cache_block_size</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00049">st_key_cache::key_cache_inited</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00053">st_key_cache::key_cache_mem_size</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00267">KEYCACHE_DEBUG_OPEN</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00057">st_key_cache::keycache_time</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00037">st_keycache_wqueue::last_thread</a>, <a class="el" href="../../d3/d0b/vector_math_8h_source.html#l00208">G3D::length()</a>, <a class="el" href="../../d1/d09/thr__lock_8c_source.html#l00086">MAX_THREADS</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00055">st_key_cache::min_warm_blocks</a>, <a class="el" href="../../da/da8/my__pthread_8h_source.html#l00862">my_errno</a>, <a class="el" href="../../d4/dc6/my__error_8c_source.html#l00071">my_error()</a>, <a class="el" href="../../d0/d7c/my__malloc_8c_source.html#l00124">my_free()</a>, <a class="el" href="../../db/da9/my__sys_8h_source.html#l00179">my_large_free</a>, <a class="el" href="../../db/da9/my__sys_8h_source.html#l00178">my_large_malloc</a>, <a class="el" href="../../d0/d7c/my__malloc_8c_source.html#l00028">my_malloc()</a>, <a class="el" href="../../da/da8/my__pthread_8h_source.html#l00792">MY_MUTEX_INIT_FAST</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l00995">MYF</a>, <a class="el" href="../../da/da5/mysql__thread_8h_source.html#l00246">mysql_mutex_init</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00335">next_power()</a>, <a class="el" href="../../d9/d33/jemalloc__internal_8h_source.html#l00624">NULL</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00051">st_key_cache::resize_in_flush</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00077">st_key_cache::resize_queue</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00075">st_key_cache::used_ins</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00074">st_key_cache::used_last</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00084">st_key_cache::waiting_for_block</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00083">st_key_cache::waiting_for_hash_link</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00082">st_key_cache::waiting_for_resize_cnt</a>, and <a class="el" href="../../de/dc2/keycache_8h_source.html#l00065">st_key_cache::warm_blocks</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00559">resize_key_cache()</a>.</p>

</div>
</div>
<a id="aa6743f1ab031dc202cea8b9ea346d5de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6743f1ab031dc202cea8b9ea346d5de">&#9670;&nbsp;</a></span>key_cache_insert()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int key_cache_insert </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *&#160;</td>
          <td class="paramname"><em>keycache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#ad34d82818831a94a892fcc41a95aa286">File</a>&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#acc0910d1e534654a09fa48ac0f37b610">my_off_t</a>&#160;</td>
          <td class="paramname"><em>filepos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>buff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l02731">2731</a> of file <a class="el" href="../../d3/d26/mf__keycache_8c_source.html">mf_keycache.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;{</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="../../d3/dc6/minigzip_8c.html#aee763da2c1c9da197307bad1d009513d">error</a>= 0;</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;key_cache_insert&quot;</span>);</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;enter&quot;</span>, (<span class="stringliteral">&quot;fd: %u  pos: %lu  length: %u&quot;</span>,</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;               (<a class="code" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>) <a class="code" href="../../d4/d71/namespacempq.html#a4d9e28a606ab362cda8f825daad0fb49">file</a>,(<a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) filepos, <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>));</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160; </div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;  <span class="keywordflow">if</span> (keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a6b4ca9496f3778ff1fec02fe943e5ce7">key_cache_inited</a>)</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;  {</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;    <span class="comment">/* Key cache is used */</span></div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a5baef0dcbf233902f75830ce890d9ba6">reg1</a> <a class="code" href="../../df/d94/structst__block__link.html">BLOCK_LINK</a> *<a class="code" href="../../d4/d21/argon2_2argon2_2core_8h.html#a3bc85c944ae1cc783105da0f15ee6adc">block</a>;</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> read_length;</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> offset;</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;    <span class="keywordtype">int</span> page_st;</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> locked_and_incremented= <a class="code" href="../../d8/dec/mpq-internal_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160; </div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;<span class="comment">      When the keycache is once initialized, we use the cache_lock to</span></div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;<span class="comment">      reliably distinguish the cases of normal operation, resizing, and</span></div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;<span class="comment">      disabled cache. We always increment and decrement</span></div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;<span class="comment">      &#39;cnt_for_resize_op&#39; so that a resizer can wait for pending I/O.</span></div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;    <a class="code" href="../../d3/d26/mf__keycache_8c.html#a0ba239caffe5972f2aaffa36f1bf1d9e">keycache_pthread_mutex_lock</a>(&amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">cache_lock</a>);</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;<span class="comment">      We do not load index data into a disabled cache nor into an</span></div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;<span class="comment">      ongoing resize.</span></div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    <span class="keywordflow">if</span> (!keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ae8a9712fee09d718d4b75e6cd3425a43">can_be_used</a> || keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a45604227ffc828dfcfd01f51cdf8201f">in_resize</a>)</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;    <span class="keywordflow">goto</span> no_key_cache;</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;    <span class="comment">/* Register the pseudo I/O for the next resize. */</span></div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;    <a class="code" href="../../d3/d26/mf__keycache_8c.html#aeb81aa221bac3bdf5a164716c193acb8">inc_counter_for_resize_op</a>(keycache);</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    locked_and_incremented= <a class="code" href="../../d8/dec/mpq-internal_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;    <span class="comment">/* Loaded data may not always be aligned to cache blocks. */</span></div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;    offset= (<a class="code" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>) (filepos % keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#af799030c4672e0745d41fcd1237c0cfc">key_cache_block_size</a>);</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;    <span class="comment">/* Load data in key_cache_block_size increments. */</span></div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;    <span class="keywordflow">do</span></div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;    {</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;      <span class="comment">/* Cache could be disabled or resizing in a later iteration. */</span></div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;      <span class="keywordflow">if</span> (!keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ae8a9712fee09d718d4b75e6cd3425a43">can_be_used</a> || keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a45604227ffc828dfcfd01f51cdf8201f">in_resize</a>)</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;    <span class="keywordflow">goto</span> no_key_cache;</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;      <span class="comment">/* Start loading at the beginning of the cache block. */</span></div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;      filepos-= offset;</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;      <span class="comment">/* Do not load beyond the end of the cache block. */</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;      read_length= <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>;</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;      <a class="code" href="../../d9/df6/my__global_8h.html#aadeec961a0e84bb1fa3cded11703cf2f">set_if_smaller</a>(read_length, keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#af799030c4672e0745d41fcd1237c0cfc">key_cache_block_size</a>-offset);</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;      <a class="code" href="../../d3/d26/mf__keycache_8c.html#af6fe690814baaa77dfb7aeeb38db1514">KEYCACHE_DBUG_ASSERT</a>(read_length &gt; 0);</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160; </div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;      <span class="comment">/* The block has been read by the caller already. */</span></div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;      keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a15e6b58b18f34975d9ab3887ef374d04">global_cache_read</a>++;</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;      <span class="comment">/* Request the cache block that matches file/pos. */</span></div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;      keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a7644055eb236db90a60a248f8371a80c">global_cache_r_requests</a>++;</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;      <a class="code" href="../../de/d36/structblock__.html">block</a>= <a class="code" href="../../d3/d26/mf__keycache_8c.html#a2582062ee1df91c979a85804340b5293">find_key_block</a>(keycache, <a class="code" href="../../d4/d71/namespacempq.html#a4d9e28a606ab362cda8f825daad0fb49">file</a>, filepos, level, 0, &amp;page_st);</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../de/d36/structblock__.html">block</a>)</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;      {</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;<span class="comment">          This happens only for requests submitted during key cache</span></div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;<span class="comment">          resize. The block is not in the cache and shall not go in.</span></div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;<span class="comment">          Stop loading index data.</span></div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;        <span class="keywordflow">goto</span> no_key_cache;</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;      }</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;      <span class="keywordflow">if</span> (!(<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;status &amp; <a class="code" href="../../d3/d26/mf__keycache_8c.html#acf93030008a45e54fad4650439a746a1">BLOCK_ERROR</a>))</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;      {</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;        <span class="keywordflow">if</span> ((page_st == <a class="code" href="../../d3/d26/mf__keycache_8c.html#a863339f26989157ca7f3bb1728b02270">PAGE_WAIT_TO_BE_READ</a>) ||</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;            ((page_st == <a class="code" href="../../d3/d26/mf__keycache_8c.html#a5e79984cb49ca8181cd2b7f508974398">PAGE_TO_BE_READ</a>) &amp;&amp;</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;             (offset || (read_length &lt; keycache-&gt;key_cache_block_size))))</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;        {</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;          <span class="comment">/*</span></div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;<span class="comment">            Either</span></div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;<span class="comment">            this is a secondary request for a block to be read into the</span></div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;<span class="comment">            cache. The block is in eviction. It is not yet assigned to</span></div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;<span class="comment">            the requested file block (It does not point to the right</span></div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;<span class="comment">            hash_link). So we cannot call remove_reader() on the block.</span></div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;<span class="comment">            And we cannot access the hash_link directly here. We need to</span></div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;<span class="comment">            wait until the assignment is complete. read_block() executes</span></div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;<span class="comment">            the correct wait when called with primary == FALSE.</span></div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;<span class="comment">            Or</span></div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;<span class="comment">            this is a primary request for a block to be read into the</span></div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;<span class="comment">            cache and the supplied data does not fill the whole block.</span></div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;<span class="comment">            This function is called on behalf of a LOAD INDEX INTO CACHE</span></div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;<span class="comment">            statement, which is a read-only task and allows other</span></div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;<span class="comment">            readers. It is possible that a parallel running reader tries</span></div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;<span class="comment">            to access this block. If it needs more data than has been</span></div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;<span class="comment">            supplied here, it would report an error. To be sure that we</span></div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;<span class="comment">            have all data in the block that is available in the file, we</span></div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;<span class="comment">            read the block ourselves.</span></div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;<span class="comment">            Though reading again what the caller did read already is an</span></div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="comment">            expensive operation, we need to do this for correctness.</span></div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="comment">          */</span></div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;          <a class="code" href="../../d3/d26/mf__keycache_8c.html#a4b51acba27048b5d3242f8ff0bb76a50">read_block</a>(keycache, <a class="code" href="../../de/d36/structblock__.html">block</a>, keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#af799030c4672e0745d41fcd1237c0cfc">key_cache_block_size</a>,</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;                     read_length + offset, (page_st == <a class="code" href="../../d3/d26/mf__keycache_8c.html#a5e79984cb49ca8181cd2b7f508974398">PAGE_TO_BE_READ</a>));</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;          <span class="comment">/*</span></div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;<span class="comment">            A secondary request must now have the block assigned to the</span></div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;<span class="comment">            requested file block. It does not hurt to check it for</span></div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;<span class="comment">            primary requests too.</span></div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;<span class="comment">          */</span></div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;          <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ae8a9712fee09d718d4b75e6cd3425a43">can_be_used</a>);</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;          <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;hash_link-&gt;file == <a class="code" href="../../d4/d71/namespacempq.html#a4d9e28a606ab362cda8f825daad0fb49">file</a>);</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;          <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;hash_link-&gt;diskpos == filepos);</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;          <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;status &amp; (<a class="code" href="../../d3/d26/mf__keycache_8c.html#aba302488a09b899c3966444d921c3c66">BLOCK_READ</a> | <a class="code" href="../../d3/d26/mf__keycache_8c.html#a9ab99a418a31634c3db3e0276cb0cd4b">BLOCK_IN_USE</a>));</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;        }</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (page_st == <a class="code" href="../../d3/d26/mf__keycache_8c.html#a5e79984cb49ca8181cd2b7f508974398">PAGE_TO_BE_READ</a>)</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;        {</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;          <span class="comment">/*</span></div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;<span class="comment">            This is a new block in the cache. If we come here, we have</span></div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;<span class="comment">            data for the whole block.</span></div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;<span class="comment">          */</span></div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;          <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;hash_link-&gt;requests);</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;          <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;status &amp; <a class="code" href="../../d3/d26/mf__keycache_8c.html#a9ab99a418a31634c3db3e0276cb0cd4b">BLOCK_IN_USE</a>);</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;          <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>((page_st == <a class="code" href="../../d3/d26/mf__keycache_8c.html#a5e79984cb49ca8181cd2b7f508974398">PAGE_TO_BE_READ</a>) ||</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;                      (<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;status &amp; <a class="code" href="../../d3/d26/mf__keycache_8c.html#aba302488a09b899c3966444d921c3c66">BLOCK_READ</a>));</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160; </div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;<span class="preprocessor">#if !defined(SERIALIZED_READ_FROM_CACHE)</span></div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;          <a class="code" href="../../d3/d26/mf__keycache_8c.html#ae4716d2ef9f38b2e33369931c83a1c27">keycache_pthread_mutex_unlock</a>(&amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">cache_lock</a>);</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;          <span class="comment">/*</span></div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;<span class="comment">            Here other threads may step in and register as secondary readers.</span></div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;<span class="comment">            They will register in block-&gt;wqueue[COND_FOR_REQUESTED].</span></div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;<span class="comment">          */</span></div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160; </div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;          <span class="comment">/* Copy data from buff */</span></div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;          <a class="code" href="../../d6/dda/m__string_8h.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a>(<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;buffer+offset, buff, (<span class="keywordtype">size_t</span>) read_length);</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160; </div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;<span class="preprocessor">#if !defined(SERIALIZED_READ_FROM_CACHE)</span></div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;          <a class="code" href="../../d3/d26/mf__keycache_8c.html#a0ba239caffe5972f2aaffa36f1bf1d9e">keycache_pthread_mutex_lock</a>(&amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">cache_lock</a>);</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;          <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;status &amp; <a class="code" href="../../d3/d26/mf__keycache_8c.html#a9ab99a418a31634c3db3e0276cb0cd4b">BLOCK_IN_USE</a>);</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;          <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>((page_st == <a class="code" href="../../d3/d26/mf__keycache_8c.html#a5e79984cb49ca8181cd2b7f508974398">PAGE_TO_BE_READ</a>) ||</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;                      (<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;status &amp; <a class="code" href="../../d3/d26/mf__keycache_8c.html#aba302488a09b899c3966444d921c3c66">BLOCK_READ</a>));</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;          <span class="comment">/*</span></div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;<span class="comment">            After the data is in the buffer, we can declare the block</span></div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;<span class="comment">            valid. Now other threads do not need to register as</span></div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;<span class="comment">            secondary readers any more. They can immediately access the</span></div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;<span class="comment">            block.</span></div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;<span class="comment">          */</span></div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;          <a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;status|= <a class="code" href="../../d3/d26/mf__keycache_8c.html#aba302488a09b899c3966444d921c3c66">BLOCK_READ</a>;</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;          <a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;length= read_length+offset;</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;          <span class="comment">/*</span></div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;<span class="comment">            Do not set block-&gt;offset here. If this block is marked</span></div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;<span class="comment">            BLOCK_CHANGED later, we want to flush only the modified part. So</span></div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;<span class="comment">            only a writer may set block-&gt;offset down from</span></div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;<span class="comment">            keycache-&gt;key_cache_block_size.</span></div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;<span class="comment">          */</span></div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;          <a class="code" href="../../d3/d26/mf__keycache_8c.html#aa06cb301b5a09875ec53ec4ec60b2902">KEYCACHE_DBUG_PRINT</a>(<span class="stringliteral">&quot;key_cache_insert&quot;</span>,</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;                              (<span class="stringliteral">&quot;primary request: new page in cache&quot;</span>));</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;          <span class="comment">/* Signal all pending requests. */</span></div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;          <a class="code" href="../../d3/d26/mf__keycache_8c.html#a8d1962faf8bcd8d3bf01d56cedfc744b">release_whole_queue</a>(&amp;<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;wqueue[<a class="code" href="../../d3/d26/mf__keycache_8c.html#a5e18faaba6916c5591566101544fda8d">COND_FOR_REQUESTED</a>]);</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;        }</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;        {</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;          <span class="comment">/*</span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;<span class="comment">            page_st == PAGE_READ. The block is in the buffer. All data</span></div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;<span class="comment">            must already be present. Blocks are always read with all</span></div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;<span class="comment">            data available on file. Assert that the block does not have</span></div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;<span class="comment">            less contents than the preloader supplies. If the caller has</span></div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;<span class="comment">            data beyond block-&gt;length, it means that a file write has</span></div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;<span class="comment">            been done while this block was in cache and not extended</span></div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;<span class="comment">            with the new data. If the condition is met, we can simply</span></div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;<span class="comment">            ignore the block.</span></div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;<span class="comment">          */</span></div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;          <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>((page_st == <a class="code" href="../../d3/d26/mf__keycache_8c.html#a23218b51de2f748d10cd8a6db98d8eb5">PAGE_READ</a>) &amp;&amp;</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;                      (read_length + offset &lt;= block-&gt;<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>));</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;        }</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160; </div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;<span class="comment">          A secondary request must now have the block assigned to the</span></div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;<span class="comment">          requested file block. It does not hurt to check it for primary</span></div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;<span class="comment">          requests too.</span></div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;        <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;hash_link-&gt;file == <a class="code" href="../../d4/d71/namespacempq.html#a4d9e28a606ab362cda8f825daad0fb49">file</a>);</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;        <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;hash_link-&gt;diskpos == filepos);</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;        <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;status &amp; (<a class="code" href="../../d3/d26/mf__keycache_8c.html#aba302488a09b899c3966444d921c3c66">BLOCK_READ</a> | <a class="code" href="../../d3/d26/mf__keycache_8c.html#a9ab99a418a31634c3db3e0276cb0cd4b">BLOCK_IN_USE</a>));</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;      } <span class="comment">/* end of if (!(block-&gt;status &amp; BLOCK_ERROR)) */</span></div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160; </div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;      <a class="code" href="../../d3/d26/mf__keycache_8c.html#ab89f1b5417f528525c7b997a99dd8979">remove_reader</a>(<a class="code" href="../../de/d36/structblock__.html">block</a>);</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160; </div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;      <span class="comment">/* Error injection for coverage testing. */</span></div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;      <a class="code" href="../../d0/d74/my__dbug_8h.html#a1f2d1168faa35ce15f1b058a5fe9c630">DBUG_EXECUTE_IF</a>(<span class="stringliteral">&quot;key_cache_insert_block_error&quot;</span>,</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;                      <a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;status|= <a class="code" href="../../d3/d26/mf__keycache_8c.html#acf93030008a45e54fad4650439a746a1">BLOCK_ERROR</a>; <a class="code" href="../../db/da9/my__sys_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>=EIO;);</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160; </div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;      <span class="comment">/* Do not link erroneous blocks into the LRU ring, but free them. */</span></div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;      <span class="keywordflow">if</span> (!(<a class="code" href="../../de/d36/structblock__.html">block</a>-&gt;status &amp; <a class="code" href="../../d3/d26/mf__keycache_8c.html#acf93030008a45e54fad4650439a746a1">BLOCK_ERROR</a>))</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;      {</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;<span class="comment">          Link the block into the LRU ring if it&#39;s the last submitted</span></div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;<span class="comment">          request for the block. This enables eviction for the block.</span></div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;        <a class="code" href="../../d3/d26/mf__keycache_8c.html#afc7c473a02292b7b5c4a1ddce0f373a9">unreg_request</a>(keycache, <a class="code" href="../../de/d36/structblock__.html">block</a>, 1);</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;      }</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;      {</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;        <a class="code" href="../../d3/d26/mf__keycache_8c.html#a94cdc3c884e8122823b31ae04fecc887">free_block</a>(keycache, <a class="code" href="../../de/d36/structblock__.html">block</a>);</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;        <a class="code" href="../../d3/dc6/minigzip_8c.html#aee763da2c1c9da197307bad1d009513d">error</a>= 1;</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;      }</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160; </div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;      buff+= read_length;</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;      filepos+= read_length+offset;</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;      offset= 0;</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160; </div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;    } <span class="keywordflow">while</span> ((<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>-= read_length));</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160; </div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;  no_key_cache:</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;    <span class="keywordflow">if</span> (locked_and_incremented)</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;      <a class="code" href="../../d3/d26/mf__keycache_8c.html#a86be03ac31d3436059c39ee7447d220a">dec_counter_for_resize_op</a>(keycache);</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;    <a class="code" href="../../d3/d26/mf__keycache_8c.html#ae4716d2ef9f38b2e33369931c83a1c27">keycache_pthread_mutex_unlock</a>(&amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">cache_lock</a>);</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;  }</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(<a class="code" href="../../d3/dc6/minigzip_8c.html#aee763da2c1c9da197307bad1d009513d">error</a>);</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;}</div>
<div class="ttc" id="aargon2_2argon2_2core_8h_html_a3bc85c944ae1cc783105da0f15ee6adc"><div class="ttname"><a href="../../d4/d21/argon2_2argon2_2core_8h.html#a3bc85c944ae1cc783105da0f15ee6adc">block</a></div><div class="ttdeci">struct block_ block</div></div>
<div class="ttc" id="am__string_8h_html_aed653b4838032a2c5ce8960421c8cfd7"><div class="ttname"><a href="../../d6/dda/m__string_8h.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a></div><div class="ttdeci">#define memcpy(d, s, n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dda/m__string_8h_source.html#l00050">m_string.h:50</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a23218b51de2f748d10cd8a6db98d8eb5"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a23218b51de2f748d10cd8a6db98d8eb5">PAGE_READ</a></div><div class="ttdeci">#define PAGE_READ</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00195">mf_keycache.c:195</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a2582062ee1df91c979a85804340b5293"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a2582062ee1df91c979a85804340b5293">find_key_block</a></div><div class="ttdeci">static BLOCK_LINK * find_key_block(KEY_CACHE *keycache, File file, my_off_t filepos, int init_hits_left, int wrmode, int *page_st)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l01629">mf_keycache.c:1629</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a4b51acba27048b5d3242f8ff0bb76a50"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a4b51acba27048b5d3242f8ff0bb76a50">read_block</a></div><div class="ttdeci">static void read_block(KEY_CACHE *keycache, BLOCK_LINK *block, uint read_length, uint min_length, my_bool primary)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l02382">mf_keycache.c:2382</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a5e18faaba6916c5591566101544fda8d"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a5e18faaba6916c5591566101544fda8d">COND_FOR_REQUESTED</a></div><div class="ttdeci">#define COND_FOR_REQUESTED</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00159">mf_keycache.c:159</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a5e79984cb49ca8181cd2b7f508974398"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a5e79984cb49ca8181cd2b7f508974398">PAGE_TO_BE_READ</a></div><div class="ttdeci">#define PAGE_TO_BE_READ</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00196">mf_keycache.c:196</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a863339f26989157ca7f3bb1728b02270"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a863339f26989157ca7f3bb1728b02270">PAGE_WAIT_TO_BE_READ</a></div><div class="ttdeci">#define PAGE_WAIT_TO_BE_READ</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00197">mf_keycache.c:197</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a8d1962faf8bcd8d3bf01d56cedfc744b"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a8d1962faf8bcd8d3bf01d56cedfc744b">release_whole_queue</a></div><div class="ttdeci">static void release_whole_queue(KEYCACHE_WQUEUE *wqueue)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00922">mf_keycache.c:922</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a94cdc3c884e8122823b31ae04fecc887"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a94cdc3c884e8122823b31ae04fecc887">free_block</a></div><div class="ttdeci">static void free_block(KEY_CACHE *keycache, BLOCK_LINK *block)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l03318">mf_keycache.c:3318</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a9ab99a418a31634c3db3e0276cb0cd4b"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a9ab99a418a31634c3db3e0276cb0cd4b">BLOCK_IN_USE</a></div><div class="ttdeci">#define BLOCK_IN_USE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00189">mf_keycache.c:189</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_aa06cb301b5a09875ec53ec4ec60b2902"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#aa06cb301b5a09875ec53ec4ec60b2902">KEYCACHE_DBUG_PRINT</a></div><div class="ttdeci">#define KEYCACHE_DBUG_PRINT(l, m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00280">mf_keycache.c:280</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_ab89f1b5417f528525c7b997a99dd8979"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#ab89f1b5417f528525c7b997a99dd8979">remove_reader</a></div><div class="ttdeci">static void remove_reader(BLOCK_LINK *block)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l01395">mf_keycache.c:1395</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_aba302488a09b899c3966444d921c3c66"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#aba302488a09b899c3966444d921c3c66">BLOCK_READ</a></div><div class="ttdeci">#define BLOCK_READ</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00184">mf_keycache.c:184</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_acf93030008a45e54fad4650439a746a1"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#acf93030008a45e54fad4650439a746a1">BLOCK_ERROR</a></div><div class="ttdeci">#define BLOCK_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00183">mf_keycache.c:183</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_af6fe690814baaa77dfb7aeeb38db1514"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#af6fe690814baaa77dfb7aeeb38db1514">KEYCACHE_DBUG_ASSERT</a></div><div class="ttdeci">#define KEYCACHE_DBUG_ASSERT(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00281">mf_keycache.c:281</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_afc7c473a02292b7b5c4a1ddce0f373a9"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#afc7c473a02292b7b5c4a1ddce0f373a9">unreg_request</a></div><div class="ttdeci">static void unreg_request(KEY_CACHE *keycache, BLOCK_LINK *block, int at_end)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l01328">mf_keycache.c:1328</a></div></div>
<div class="ttc" id="ampq-internal_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="../../d8/dec/mpq-internal_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dec/mpq-internal_8h_source.html#l00062">mpq-internal.h:62</a></div></div>
<div class="ttc" id="ampq-internal_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="../../d8/dec/mpq-internal_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dec/mpq-internal_8h_source.html#l00059">mpq-internal.h:59</a></div></div>
<div class="ttc" id="amy__dbug_8h_html_a1f2d1168faa35ce15f1b058a5fe9c630"><div class="ttname"><a href="../../d0/d74/my__dbug_8h.html#a1f2d1168faa35ce15f1b058a5fe9c630">DBUG_EXECUTE_IF</a></div><div class="ttdeci">#define DBUG_EXECUTE_IF(keyword, a1)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d74/my__dbug_8h_source.html#l00076">my_dbug.h:76</a></div></div>
<div class="ttc" id="amy__global_8h_html_a5baef0dcbf233902f75830ce890d9ba6"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#a5baef0dcbf233902f75830ce890d9ba6">reg1</a></div><div class="ttdeci">#define reg1</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l01018">my_global.h:1018</a></div></div>
<div class="ttc" id="amy__global_8h_html_a74cd599039dcf29c6e6d342cf4efd0a8"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a></div><div class="ttdeci">char my_bool</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00992">my_global.h:992</a></div></div>
<div class="ttc" id="amy__global_8h_html_a91ad9478d81a7aaf2593e8d9c3d06a14"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a></div><div class="ttdeci">unsigned int uint</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00475">my_global.h:475</a></div></div>
<div class="ttc" id="amy__global_8h_html_aadeec961a0e84bb1fa3cded11703cf2f"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#aadeec961a0e84bb1fa3cded11703cf2f">set_if_smaller</a></div><div class="ttdeci">#define set_if_smaller(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00482">my_global.h:482</a></div></div>
<div class="ttc" id="amy__sys_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="astructblock___html"><div class="ttname"><a href="../../de/d36/structblock__.html">block_</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d21/argon2_2argon2_2core_8h_source.html#l00052">core.h:52</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00183">BLOCK_ERROR</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00189">BLOCK_IN_USE</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00184">BLOCK_READ</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00076">st_key_cache::cache_lock</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00052">st_key_cache::can_be_used</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00159">COND_FOR_REQUESTED</a>, <a class="el" href="../../d0/d74/my__dbug_8h_source.html#l00096">DBUG_ASSERT</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d0/d74/my__dbug_8h_source.html#l00076">DBUG_EXECUTE_IF</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00143">DBUG_PRINT</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00138">DBUG_RETURN</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00671">dec_counter_for_resize_op()</a>, <a class="el" href="../../db/da9/my__sys_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../d3/dc6/minigzip_8c_source.html#l00156">error()</a>, <a class="el" href="../../d8/dec/mpq-internal_8h_source.html#l00059">FALSE</a>, <a class="el" href="../../d6/d3e/mpq_8py_source.html#l00283">mpq::file</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l01629">find_key_block()</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l03318">free_block()</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00102">st_key_cache::global_cache_r_requests</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00103">st_key_cache::global_cache_read</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00050">st_key_cache::in_resize</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00661">inc_counter_for_resize_op()</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00054">st_key_cache::key_cache_block_size</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00049">st_key_cache::key_cache_inited</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00281">KEYCACHE_DBUG_ASSERT</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00280">KEYCACHE_DBUG_PRINT</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00320">keycache_pthread_mutex_lock</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00321">keycache_pthread_mutex_unlock</a>, <a class="el" href="../../d3/d0b/vector_math_8h_source.html#l00208">G3D::length()</a>, <a class="el" href="../../d6/dda/m__string_8h_source.html#l00050">memcpy</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00195">PAGE_READ</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00196">PAGE_TO_BE_READ</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00197">PAGE_WAIT_TO_BE_READ</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l02382">read_block()</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l01018">reg1</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00922">release_whole_queue()</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l01395">remove_reader()</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l00482">set_if_smaller</a>, <a class="el" href="../../d8/dec/mpq-internal_8h_source.html#l00062">TRUE</a>, and <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l01328">unreg_request()</a>.</p>

</div>
</div>
<a id="abd6f0770cfff1e54d9a7db0ef3e4e577"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd6f0770cfff1e54d9a7db0ef3e4e577">&#9670;&nbsp;</a></span>key_cache_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>* key_cache_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *&#160;</td>
          <td class="paramname"><em>keycache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#ad34d82818831a94a892fcc41a95aa286">File</a>&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#acc0910d1e534654a09fa48ac0f37b610">my_off_t</a>&#160;</td>
          <td class="paramname"><em>filepos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>buff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>block_length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>return_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a536057178c79150aca0461dc479ff3af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a536057178c79150aca0461dc479ff3af">&#9670;&nbsp;</a></span>key_cache_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int key_cache_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *&#160;</td>
          <td class="paramname"><em>keycache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#ad34d82818831a94a892fcc41a95aa286">File</a>&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#acc0910d1e534654a09fa48ac0f37b610">my_off_t</a>&#160;</td>
          <td class="paramname"><em>filepos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>buff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>block_length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>force_write</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="adf9d3149e967d331fb0ba005c0742684"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf9d3149e967d331fb0ba005c0742684">&#9670;&nbsp;</a></span>multi_key_cache_change()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void multi_key_cache_change </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *&#160;</td>
          <td class="paramname"><em>old_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *&#160;</td>
          <td class="paramname"><em>new_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00357">357</a> of file <a class="el" href="../../de/d52/mf__keycaches_8c_source.html">mf_keycaches.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;{</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <a class="code" href="../../de/d52/mf__keycaches_8c.html#a8e6693b1249f5bb6fb688e76dc0a8e58">safe_hash_change</a>(&amp;<a class="code" href="../../de/d52/mf__keycaches_8c.html#ac8099299fb2c0a801f361a92c08d0aa2">key_cache_hash</a>, (<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>*) old_data, (<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>*) new_data);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;}</div>
<div class="ttc" id="amf__keycaches_8c_html_a8e6693b1249f5bb6fb688e76dc0a8e58"><div class="ttname"><a href="../../de/d52/mf__keycaches_8c.html#a8e6693b1249f5bb6fb688e76dc0a8e58">safe_hash_change</a></div><div class="ttdeci">static void safe_hash_change(SAFE_HASH *hash, uchar *old_data, uchar *new_data)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d52/mf__keycaches_8c_source.html#l00262">mf_keycaches.c:262</a></div></div>
<div class="ttc" id="amf__keycaches_8c_html_ac8099299fb2c0a801f361a92c08d0aa2"><div class="ttname"><a href="../../de/d52/mf__keycaches_8c.html#ac8099299fb2c0a801f361a92c08d0aa2">key_cache_hash</a></div><div class="ttdeci">static SAFE_HASH key_cache_hash</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d52/mf__keycaches_8c_source.html#l00295">mf_keycaches.c:295</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00295">key_cache_hash</a>, and <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00262">safe_hash_change()</a>.</p>

</div>
</div>
<a id="a21d3d81541b09ac8f23d19694546b8b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21d3d81541b09ac8f23d19694546b8b8">&#9670;&nbsp;</a></span>multi_key_cache_search()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a>* multi_key_cache_search </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00326">326</a> of file <a class="el" href="../../de/d52/mf__keycaches_8c_source.html">mf_keycaches.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;{</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="../../de/d52/mf__keycaches_8c.html#ac8099299fb2c0a801f361a92c08d0aa2">key_cache_hash</a>.<a class="code" href="../../d1/de7/structst__safe__hash__with__default.html#a7e19df4f88d4ab975b8a3d3aedb7d56b">hash</a>.<a class="code" href="../../d9/d2e/structst__hash.html#a1fb964af71713225bb481ce728fba710">records</a>)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../de/dc2/keycache_8h.html#aee6c9bee171d49aee38513123eab9b06">dflt_key_cache</a>;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="../../d7/dcc/structst__key__cache.html">KEY_CACHE</a>*) <a class="code" href="../../de/d52/mf__keycaches_8c.html#ab6cb18b443fb52d38fa131e8a7aca2f3">safe_hash_search</a>(&amp;<a class="code" href="../../de/d52/mf__keycaches_8c.html#ac8099299fb2c0a801f361a92c08d0aa2">key_cache_hash</a>, key, <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;}</div>
<div class="ttc" id="akeycache_8h_html_aee6c9bee171d49aee38513123eab9b06"><div class="ttname"><a href="../../de/dc2/keycache_8h.html#aee6c9bee171d49aee38513123eab9b06">dflt_key_cache</a></div><div class="ttdeci">KEY_CACHE * dflt_key_cache</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00110">keycache.h:110</a></div></div>
<div class="ttc" id="amf__keycaches_8c_html_ab6cb18b443fb52d38fa131e8a7aca2f3"><div class="ttname"><a href="../../de/d52/mf__keycaches_8c.html#ab6cb18b443fb52d38fa131e8a7aca2f3">safe_hash_search</a></div><div class="ttdeci">static uchar * safe_hash_search(SAFE_HASH *hash, const uchar *key, uint length)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d52/mf__keycaches_8c_source.html#l00148">mf_keycaches.c:148</a></div></div>
<div class="ttc" id="astructst__hash_html_a1fb964af71713225bb481ce728fba710"><div class="ttname"><a href="../../d9/d2e/structst__hash.html#a1fb964af71713225bb481ce728fba710">st_hash::records</a></div><div class="ttdeci">ulong records</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d11/mysqllite_2include_2internal_2hash_8h_source.html#l00055">hash.h:55</a></div></div>
<div class="ttc" id="astructst__key__cache_html"><div class="ttname"><a href="../../d7/dcc/structst__key__cache.html">st_key_cache</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc2/keycache_8h_source.html#l00047">keycache.h:48</a></div></div>
<div class="ttc" id="astructst__safe__hash__with__default_html_a7e19df4f88d4ab975b8a3d3aedb7d56b"><div class="ttname"><a href="../../d1/de7/structst__safe__hash__with__default.html#a7e19df4f88d4ab975b8a3d3aedb7d56b">st_safe_hash_with_default::hash</a></div><div class="ttdeci">HASH hash</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d52/mf__keycaches_8c_source.html#l00057">mf_keycaches.c:57</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../de/dc2/keycache_8h_source.html#l00110">dflt_key_cache</a>, <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00057">st_safe_hash_with_default::hash</a>, <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00295">key_cache_hash</a>, <a class="el" href="../../d3/d0b/vector_math_8h_source.html#l00208">G3D::length()</a>, <a class="el" href="../../d8/d11/mysqllite_2include_2internal_2hash_8h_source.html#l00055">st_hash::records</a>, and <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00148">safe_hash_search()</a>.</p>

</div>
</div>
<a id="abd2882a700e7e0006a4607b0321a1c56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd2882a700e7e0006a4607b0321a1c56">&#9670;&nbsp;</a></span>multi_key_cache_set()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> multi_key_cache_set </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d95/zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *&#160;</td>
          <td class="paramname"><em>key_cache</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00350">350</a> of file <a class="el" href="../../de/d52/mf__keycaches_8c_source.html">mf_keycaches.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;{</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../de/d52/mf__keycaches_8c.html#a806035ee67c58db95bda01185d307504">safe_hash_set</a>(&amp;<a class="code" href="../../de/d52/mf__keycaches_8c.html#ac8099299fb2c0a801f361a92c08d0aa2">key_cache_hash</a>, key, <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>, (<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>*) key_cache);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;}</div>
<div class="ttc" id="amf__keycaches_8c_html_a806035ee67c58db95bda01185d307504"><div class="ttname"><a href="../../de/d52/mf__keycaches_8c.html#a806035ee67c58db95bda01185d307504">safe_hash_set</a></div><div class="ttdeci">static my_bool safe_hash_set(SAFE_HASH *hash, const uchar *key, uint length, uchar *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d52/mf__keycaches_8c_source.html#l00184">mf_keycaches.c:184</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00295">key_cache_hash</a>, <a class="el" href="../../d3/d0b/vector_math_8h_source.html#l00208">G3D::length()</a>, and <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00184">safe_hash_set()</a>.</p>

</div>
</div>
<a id="a6e343c6239058b68e9578bcd049f3fc3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e343c6239058b68e9578bcd049f3fc3">&#9670;&nbsp;</a></span>multi_keycache_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void multi_keycache_free </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00304">304</a> of file <a class="el" href="../../de/d52/mf__keycaches_8c_source.html">mf_keycaches.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;{</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <a class="code" href="../../de/d52/mf__keycaches_8c.html#a12e797cd81ecbd8e7222e6bb1ba37a33">safe_hash_free</a>(&amp;<a class="code" href="../../de/d52/mf__keycaches_8c.html#ac8099299fb2c0a801f361a92c08d0aa2">key_cache_hash</a>);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;}</div>
<div class="ttc" id="amf__keycaches_8c_html_a12e797cd81ecbd8e7222e6bb1ba37a33"><div class="ttname"><a href="../../de/d52/mf__keycaches_8c.html#a12e797cd81ecbd8e7222e6bb1ba37a33">safe_hash_free</a></div><div class="ttdeci">static void safe_hash_free(SAFE_HASH *hash)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d52/mf__keycaches_8c_source.html#l00130">mf_keycaches.c:130</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00295">key_cache_hash</a>, and <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00130">safe_hash_free()</a>.</p>

</div>
</div>
<a id="a36f52fe93501e225e7093db427d388d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36f52fe93501e225e7093db427d388d2">&#9670;&nbsp;</a></span>multi_keycache_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> multi_keycache_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00298">298</a> of file <a class="el" href="../../de/d52/mf__keycaches_8c_source.html">mf_keycaches.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;{</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../de/d52/mf__keycaches_8c.html#a51d9b3ce40fa74c304c3d26d138ce478">safe_hash_init</a>(&amp;<a class="code" href="../../de/d52/mf__keycaches_8c.html#ac8099299fb2c0a801f361a92c08d0aa2">key_cache_hash</a>, 16, (<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>*) <a class="code" href="../../de/dc2/keycache_8h.html#aee6c9bee171d49aee38513123eab9b06">dflt_key_cache</a>);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;}</div>
<div class="ttc" id="amf__keycaches_8c_html_a51d9b3ce40fa74c304c3d26d138ce478"><div class="ttname"><a href="../../de/d52/mf__keycaches_8c.html#a51d9b3ce40fa74c304c3d26d138ce478">safe_hash_init</a></div><div class="ttdeci">static my_bool safe_hash_init(SAFE_HASH *hash, uint elements, uchar *default_value)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d52/mf__keycaches_8c_source.html#l00105">mf_keycaches.c:105</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../de/dc2/keycache_8h_source.html#l00110">dflt_key_cache</a>, <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00295">key_cache_hash</a>, and <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00105">safe_hash_init()</a>.</p>

</div>
</div>
<a id="aeec97efa27786d6ee8a54c5a4652c6e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeec97efa27786d6ee8a54c5a4652c6e6">&#9670;&nbsp;</a></span>reset_key_cache_counters()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int reset_key_cache_counters </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d95/zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *&#160;</td>
          <td class="paramname"><em>key_cache</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8d6892bc7cb4a979cbc23e89a22b386e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d6892bc7cb4a979cbc23e89a22b386e">&#9670;&nbsp;</a></span>resize_key_cache()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int resize_key_cache </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> *&#160;</td>
          <td class="paramname"><em>keycache</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>key_cache_block_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>use_mem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>division_limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>age_threshold</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00559">559</a> of file <a class="el" href="../../d3/d26/mf__keycache_8c_source.html">mf_keycache.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;{</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="keywordtype">int</span> blocks;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;resize_key_cache&quot;</span>);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="keywordflow">if</span> (!keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a6b4ca9496f3778ff1fec02fe943e5ce7">key_cache_inited</a>)</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a>);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160; </div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keywordflow">if</span>(key_cache_block_size == keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#af799030c4672e0745d41fcd1237c0cfc">key_cache_block_size</a> &amp;&amp;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;     use_mem == keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a8a83a6143b60800f36c9e4ec01b1e0c7">key_cache_mem_size</a>)</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <a class="code" href="../../d3/d26/mf__keycache_8c.html#a108f066be8ee492a53e3e6cca587fd28">change_key_cache_param</a>(keycache, division_limit, age_threshold);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a205ccdd3a670b3769a371b0f4b78ecd3">disk_blocks</a>);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <a class="code" href="../../d3/d26/mf__keycache_8c.html#a0ba239caffe5972f2aaffa36f1bf1d9e">keycache_pthread_mutex_lock</a>(&amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">cache_lock</a>);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160; </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">    We may need to wait for another thread which is doing a resize</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">    already. This cannot happen in the MySQL server though. It allows</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">    one resizer only. In set_var.cc keycache-&gt;in_init is used to block</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">    multiple attempts.</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="keywordflow">while</span> (keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a45604227ffc828dfcfd01f51cdf8201f">in_resize</a>)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="comment">/* purecov: begin inspected */</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <a class="code" href="../../d3/d26/mf__keycache_8c.html#a455c6a5e2f480b8d8b67392ba9f61d67">wait_on_queue</a>(&amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ab1c68aadca5cfa66a26b6a6c5f01581f">resize_queue</a>, &amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">cache_lock</a>);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="comment">/* purecov: end */</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  }</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160; </div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">    Mark the operation in progress. This blocks other threads from doing</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">    a resize in parallel. It prohibits new blocks to enter the cache.</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">    Read/write requests can bypass the cache during the flush phase.</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a45604227ffc828dfcfd01f51cdf8201f">in_resize</a>= 1;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="comment">/* Need to flush only if keycache is enabled. */</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keywordflow">if</span> (keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ae8a9712fee09d718d4b75e6cd3425a43">can_be_used</a>)</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="comment">/* Start the flush phase. */</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a65a0f39109ebd8cea95c413231d9b5c8">resize_in_flush</a>= 1;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d3/d26/mf__keycache_8c.html#a5e9e1708936ac404c45527d26958ae16">flush_all_key_blocks</a>(keycache))</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="comment">/* TODO: if this happens, we should write a warning in the log file ! */</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a65a0f39109ebd8cea95c413231d9b5c8">resize_in_flush</a>= 0;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      blocks= 0;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ae8a9712fee09d718d4b75e6cd3425a43">can_be_used</a>= 0;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dd/d0e/tools_2mmaps__generator_2_path_generator_8cpp.html#a32e7545f3a98690aeb284a4eb66f272d">finish</a>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(<a class="code" href="../../d3/d26/mf__keycache_8c.html#ae2a0dda2a2b90dff2a89dd93c15149d2">cache_empty</a>(keycache));</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="comment">/* End the flush phase. */</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a65a0f39109ebd8cea95c413231d9b5c8">resize_in_flush</a>= 0;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment">    Some direct read/write operations (bypassing the cache) may still be</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">    unfinished. Wait until they are done. If the key cache can be used,</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">    direct I/O is done in increments of key_cache_block_size. That is,</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">    every block is checked if it is in the cache. We need to wait for</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">    pending I/O before re-initializing the cache, because we may change</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">    the block size. Otherwise they could check for blocks at file</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">    positions where the new block division has none. We do also want to</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">    wait for I/O done when (if) the cache was disabled. It must not</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">    run in parallel with normal cache operation.</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keywordflow">while</span> (keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a195a3307538d819f13b9e91a025b4a8f">cnt_for_resize_op</a>)</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <a class="code" href="../../d3/d26/mf__keycache_8c.html#a455c6a5e2f480b8d8b67392ba9f61d67">wait_on_queue</a>(&amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ae3c67ed105880d4caf9f1664140a21b8">waiting_for_resize_cnt</a>, &amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">cache_lock</a>);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">    Free old cache structures, allocate new structures, and initialize</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">    them. Note that the cache_lock mutex and the resize_queue are left</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">    untouched. We do not lose the cache_lock and will release it only at</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">    the end of this function.</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <a class="code" href="../../d3/d26/mf__keycache_8c.html#a8ee68b09652c680c421c3caa4c02a476">end_key_cache</a>(keycache, 0);           <span class="comment">/* Don&#39;t free mutex */</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="comment">/* The following will work even if use_mem is 0 */</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  blocks= <a class="code" href="../../d3/d26/mf__keycache_8c.html#ad0fc8526a7a2b14f31b9df818414a224">init_key_cache</a>(keycache, key_cache_block_size, use_mem,</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;             division_limit, age_threshold);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<a class="code" href="../../dd/d0e/tools_2mmaps__generator_2_path_generator_8cpp.html#a32e7545f3a98690aeb284a4eb66f272d">finish</a>:</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">    Mark the resize finished. This allows other threads to start a</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">    resize or to request new cache blocks.</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#a45604227ffc828dfcfd01f51cdf8201f">in_resize</a>= 0;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="comment">/* Signal waiting threads. */</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <a class="code" href="../../d3/d26/mf__keycache_8c.html#a8d1962faf8bcd8d3bf01d56cedfc744b">release_whole_queue</a>(&amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ab1c68aadca5cfa66a26b6a6c5f01581f">resize_queue</a>);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160; </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <a class="code" href="../../d3/d26/mf__keycache_8c.html#ae4716d2ef9f38b2e33369931c83a1c27">keycache_pthread_mutex_unlock</a>(&amp;keycache-&gt;<a class="code" href="../../d7/dcc/structst__key__cache.html#ad5a09f20e50aa7eb71414882ff7e5ba3">cache_lock</a>);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(blocks);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;}</div>
<div class="ttc" id="amf__keycache_8c_html_a108f066be8ee492a53e3e6cca587fd28"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a108f066be8ee492a53e3e6cca587fd28">change_key_cache_param</a></div><div class="ttdeci">void change_key_cache_param(KEY_CACHE *keycache, uint division_limit, uint age_threshold)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00695">mf_keycache.c:695</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a455c6a5e2f480b8d8b67392ba9f61d67"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a455c6a5e2f480b8d8b67392ba9f61d67">wait_on_queue</a></div><div class="ttdeci">static void wait_on_queue(KEYCACHE_WQUEUE *wqueue, mysql_mutex_t *mutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00875">mf_keycache.c:875</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a5e9e1708936ac404c45527d26958ae16"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a5e9e1708936ac404c45527d26958ae16">flush_all_key_blocks</a></div><div class="ttdeci">static int flush_all_key_blocks(KEY_CACHE *keycache)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l04090">mf_keycache.c:4090</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_a8ee68b09652c680c421c3caa4c02a476"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#a8ee68b09652c680c421c3caa4c02a476">end_key_cache</a></div><div class="ttdeci">void end_key_cache(KEY_CACHE *keycache, my_bool cleanup)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00724">mf_keycache.c:724</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_ad0fc8526a7a2b14f31b9df818414a224"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#ad0fc8526a7a2b14f31b9df818414a224">init_key_cache</a></div><div class="ttdeci">int init_key_cache(KEY_CACHE *keycache, uint key_cache_block_size, size_t use_mem, uint division_limit, uint age_threshold)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l00366">mf_keycache.c:366</a></div></div>
<div class="ttc" id="amf__keycache_8c_html_ae2a0dda2a2b90dff2a89dd93c15149d2"><div class="ttname"><a href="../../d3/d26/mf__keycache_8c.html#ae2a0dda2a2b90dff2a89dd93c15149d2">cache_empty</a></div><div class="ttdeci">static int cache_empty(KEY_CACHE *keycache)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d26/mf__keycache_8c_source.html#l04486">mf_keycache.c:4486</a></div></div>
<div class="ttc" id="atools_2mmaps__generator_2_path_generator_8cpp_html_a32e7545f3a98690aeb284a4eb66f272d"><div class="ttname"><a href="../../dd/d0e/tools_2mmaps__generator_2_path_generator_8cpp.html#a32e7545f3a98690aeb284a4eb66f272d">finish</a></div><div class="ttdeci">int finish(const char *message, int returnValue)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d0e/tools_2mmaps__generator_2_path_generator_8cpp_source.html#l00234">PathGenerator.cpp:234</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l04486">cache_empty()</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00076">st_key_cache::cache_lock</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00052">st_key_cache::can_be_used</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00695">change_key_cache_param()</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00066">st_key_cache::cnt_for_resize_op</a>, <a class="el" href="../../d0/d74/my__dbug_8h_source.html#l00096">DBUG_ASSERT</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00138">DBUG_RETURN</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00061">st_key_cache::disk_blocks</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00724">end_key_cache()</a>, <a class="el" href="../../dd/d0e/tools_2mmaps__generator_2_path_generator_8cpp_source.html#l00234">finish()</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l04090">flush_all_key_blocks()</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00050">st_key_cache::in_resize</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00366">init_key_cache()</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00054">st_key_cache::key_cache_block_size</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00049">st_key_cache::key_cache_inited</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00053">st_key_cache::key_cache_mem_size</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00320">keycache_pthread_mutex_lock</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00321">keycache_pthread_mutex_unlock</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00922">release_whole_queue()</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00051">st_key_cache::resize_in_flush</a>, <a class="el" href="../../de/dc2/keycache_8h_source.html#l00077">st_key_cache::resize_queue</a>, <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00875">wait_on_queue()</a>, and <a class="el" href="../../de/dc2/keycache_8h_source.html#l00082">st_key_cache::waiting_for_resize_cnt</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aee6c9bee171d49aee38513123eab9b06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee6c9bee171d49aee38513123eab9b06">&#9670;&nbsp;</a></span>dflt_key_cache</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> * dflt_key_cache</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/dc2/keycache_8h_source.html#l00110">110</a> of file <a class="el" href="../../de/dc2/keycache_8h_source.html">keycache.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00326">multi_key_cache_search()</a>, and <a class="el" href="../../de/d52/mf__keycaches_8c_source.html#l00298">multi_keycache_init()</a>.</p>

</div>
</div>
<a id="a4fc715bfb4b31e5ea371b4613f246d42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fc715bfb4b31e5ea371b4613f246d42">&#9670;&nbsp;</a></span>dflt_key_cache_var</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/dc2/keycache_8h.html#aab63d266ea0e613e21b0e22fa35d76b0">KEY_CACHE</a> dflt_key_cache_var</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d3/d26/mf__keycache_8c_source.html#l00222">222</a> of file <a class="el" href="../../d3/d26/mf__keycache_8c_source.html">mf_keycache.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
