<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Azerotcore-wotlk: deps/mysqllite/sql/net_serv.cc File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Azerotcore-wotlk
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_94a36784afa54c0b50996002372b429e.html">deps</a></li><li class="navelem"><a class="el" href="../../dir_c19b06727b8b6746540d83e2aa4b49f4.html">mysqllite</a></li><li class="navelem"><a class="el" href="../../dir_ba830f5b6461560f18bdf4afd0f96669.html">sql</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">net_serv.cc File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="../../d9/df6/my__global_8h_source.html">my_global.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="../../de/d53/mysql_8h_source.html">mysql.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="../../d6/df0/mysql__com_8h_source.html">mysql_com.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="../../d1/d40/mysqld__error_8h_source.html">mysqld_error.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="../../db/da9/my__sys_8h_source.html">my_sys.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="../../d6/dda/m__string_8h_source.html">m_string.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="../../d5/d2b/my__net_8h_source.html">my_net.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="../../d2/dd9/violite_8h_source.html">violite.h</a>&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../db/dd4/probes__mysql_8h_source.html">probes_mysql.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d85/thr__alarm_8h_source.html">thr_alarm.h</a>&quot;</code><br />
</div>
<p><a href="../../dc/d7b/net__serv_8cc_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a948dbc16381be4c874fe28f72f1eb140"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#a948dbc16381be4c874fe28f72f1eb140">NO_ALARM</a></td></tr>
<tr class="separator:a948dbc16381be4c874fe28f72f1eb140"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c2a83af4828918a253037299127d334"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#a2c2a83af4828918a253037299127d334">DONT_USE_THR_ALARM</a></td></tr>
<tr class="separator:a2c2a83af4828918a253037299127d334"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b872400e7ae3e61fc811a6dee4023b2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#a5b872400e7ae3e61fc811a6dee4023b2">update_statistics</a>(A)</td></tr>
<tr class="separator:a5b872400e7ae3e61fc811a6dee4023b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb18611755c8b5d7e12fceeee266f082"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#afb18611755c8b5d7e12fceeee266f082">thd_increment_bytes_sent</a>(N)</td></tr>
<tr class="separator:afb18611755c8b5d7e12fceeee266f082"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac01e941811fb73bcb8d4971672e40e3f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#ac01e941811fb73bcb8d4971672e40e3f">TEST_BLOCKING</a>&#160;&#160;&#160;8</td></tr>
<tr class="separator:ac01e941811fb73bcb8d4971672e40e3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a973c680573b37fc359fc68d0707da355"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a>&#160;&#160;&#160;(256L*256L*256L-1)</td></tr>
<tr class="separator:a973c680573b37fc359fc68d0707da355"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeadd6416cec78f06ac6aa7692df62ff3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#aeadd6416cec78f06ac6aa7692df62ff3">NET_DATA_IS_READY_CAN_RETURN_MINUS_ONE</a></td></tr>
<tr class="separator:aeadd6416cec78f06ac6aa7692df62ff3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad35f9f2580bfbba65f69666ac4e081fd"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#ad35f9f2580bfbba65f69666ac4e081fd">net_write_buff</a> (<a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *net, <a class="el" href="../../de/d95/zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *packet, <a class="el" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> len)</td></tr>
<tr class="separator:ad35f9f2580bfbba65f69666ac4e081fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fc6e3b92b7d8742b8ff93526b919063"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#a8fc6e3b92b7d8742b8ff93526b919063">my_net_init</a> (<a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *net, <a class="el" href="../../d6/df0/mysql__com_8h.html#a398c428bc2e077b9c404e6b81b813c5c">Vio</a> *vio)</td></tr>
<tr class="separator:a8fc6e3b92b7d8742b8ff93526b919063"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab71978513c49175a28c7ef3334a82250"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#ab71978513c49175a28c7ef3334a82250">net_end</a> (<a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *net)</td></tr>
<tr class="separator:ab71978513c49175a28c7ef3334a82250"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1804171d7de40b147aff8de101cabe4d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#a1804171d7de40b147aff8de101cabe4d">net_realloc</a> (<a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *net, size_t length)</td></tr>
<tr class="separator:a1804171d7de40b147aff8de101cabe4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c6096fa4f4d5f183c31e6f512d4fd93"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#a2c6096fa4f4d5f183c31e6f512d4fd93">net_data_is_ready</a> (<a class="el" href="../../d9/df6/my__global_8h.html#aed973571b4b7eb2facd8c39e8b500bb6">my_socket</a> sd)</td></tr>
<tr class="separator:a2c6096fa4f4d5f183c31e6f512d4fd93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd602000264b4930066da5007c8195fb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#abd602000264b4930066da5007c8195fb">net_clear</a> (<a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *net, <a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> clear_buffer)</td></tr>
<tr class="separator:abd602000264b4930066da5007c8195fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b25274dbacc2f6d54ce7efffe6c4d4b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#a8b25274dbacc2f6d54ce7efffe6c4d4b">net_flush</a> (<a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *net)</td></tr>
<tr class="separator:a8b25274dbacc2f6d54ce7efffe6c4d4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae75e6bc59f4837011c9daf6aa4242de"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#aae75e6bc59f4837011c9daf6aa4242de">my_net_write</a> (<a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *net, <a class="el" href="../../de/d95/zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *packet, size_t len)</td></tr>
<tr class="separator:aae75e6bc59f4837011c9daf6aa4242de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b0d71007bd87af2b7dcf334afd13579"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#a9b0d71007bd87af2b7dcf334afd13579">net_write_command</a> (<a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *net, <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> command, <a class="el" href="../../de/d95/zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *header, size_t head_len, <a class="el" href="../../de/d95/zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *packet, size_t len)</td></tr>
<tr class="separator:a9b0d71007bd87af2b7dcf334afd13579"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab6d3c706ccc04a192b65d195b97e047"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#aab6d3c706ccc04a192b65d195b97e047">net_real_write</a> (<a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *net, <a class="el" href="../../de/d95/zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *packet, size_t len)</td></tr>
<tr class="separator:aab6d3c706ccc04a192b65d195b97e047"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a740f98fca02653ee59b50834bf18177c"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#a740f98fca02653ee59b50834bf18177c">my_real_read</a> (<a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *net, size_t *complen)</td></tr>
<tr class="separator:a740f98fca02653ee59b50834bf18177c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95459c0280e24b9aacd761d0cc6ad749"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#a95459c0280e24b9aacd761d0cc6ad749">my_net_read</a> (<a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *net)</td></tr>
<tr class="separator:a95459c0280e24b9aacd761d0cc6ad749"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a813a0a36437c4c7f62b50fbb86617220"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#a813a0a36437c4c7f62b50fbb86617220">my_net_set_read_timeout</a> (<a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *net, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> timeout)</td></tr>
<tr class="separator:a813a0a36437c4c7f62b50fbb86617220"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2256fff5962624fac7e47f8aec12402c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d7b/net__serv_8cc.html#a2256fff5962624fac7e47f8aec12402c">my_net_set_write_timeout</a> (<a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *net, <a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> timeout)</td></tr>
<tr class="separator:a2256fff5962624fac7e47f8aec12402c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file is the net layer API for the <a class="el" href="../../d7/d02/namespace_my_s_q_l.html">MySQL</a> client/server protocol.</p>
<p>Write and read of logical packets to/from socket.</p>
<p>Writes are cached into net_buffer_length big packets. Read packets are reallocated dynamicly when reading big packets. Each logical packet has the following pre-info: 3 byte length &amp; 1 byte package-number.</p>
<p>This file needs to be written in C as it's used by the libmysql client as a C file. </p>

<p class="definition">Definition in file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a2c2a83af4828918a253037299127d334"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c2a83af4828918a253037299127d334">&#9670;&nbsp;</a></span>DONT_USE_THR_ALARM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DONT_USE_THR_ALARM</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00075">75</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>

</div>
</div>
<a id="a973c680573b37fc359fc68d0707da355"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a973c680573b37fc359fc68d0707da355">&#9670;&nbsp;</a></span>MAX_PACKET_LENGTH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_PACKET_LENGTH&#160;&#160;&#160;(256L*256L*256L-1)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00104">104</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>

</div>
</div>
<a id="aeadd6416cec78f06ac6aa7692df62ff3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeadd6416cec78f06ac6aa7692df62ff3">&#9670;&nbsp;</a></span>NET_DATA_IS_READY_CAN_RETURN_MINUS_ONE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NET_DATA_IS_READY_CAN_RETURN_MINUS_ONE</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a948dbc16381be4c874fe28f72f1eb140"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a948dbc16381be4c874fe28f72f1eb140">&#9670;&nbsp;</a></span>NO_ALARM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NO_ALARM</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00067">67</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>

</div>
</div>
<a id="ac01e941811fb73bcb8d4971672e40e3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac01e941811fb73bcb8d4971672e40e3f">&#9670;&nbsp;</a></span>TEST_BLOCKING</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TEST_BLOCKING&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00103">103</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>

</div>
</div>
<a id="afb18611755c8b5d7e12fceeee266f082"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afb18611755c8b5d7e12fceeee266f082">&#9670;&nbsp;</a></span>thd_increment_bytes_sent</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define thd_increment_bytes_sent</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">N</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00100">100</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>

</div>
</div>
<a id="a5b872400e7ae3e61fc811a6dee4023b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b872400e7ae3e61fc811a6dee4023b2">&#9670;&nbsp;</a></span>update_statistics</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define update_statistics</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">A</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00099">99</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a8fc6e3b92b7d8742b8ff93526b919063"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8fc6e3b92b7d8742b8ff93526b919063">&#9670;&nbsp;</a></span>my_net_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> my_net_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/df0/mysql__com_8h.html#a398c428bc2e077b9c404e6b81b813c5c">Vio</a> *&#160;</td>
          <td class="paramname"><em>vio</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Init with packet info. </p>

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00111">111</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;{</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;my_net_init&quot;</span>);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a> = vio;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <a class="code" href="../../d6/df0/mysql__com_8h.html#ad2977ebbc90bd5522d55e4f5b9fb58d6">my_net_local_init</a>(net);           <span class="comment">/* Set some limits */</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordflow">if</span> (!(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>=(<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>*) <a class="code" href="../../db/da9/my__sys_8h.html#a8f7b30ff5d0e10610637aa30c3e0048b">my_malloc</a>((<span class="keywordtype">size_t</span>) net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aa992b03f110362b7281ad288326d29e8">max_packet</a>+</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                     <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a> + <a class="code" href="../../d6/df0/mysql__com_8h.html#a96b9fe0154bb8a7608f8a2708992ab3e">COMP_HEADER_SIZE</a>,</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                     <a class="code" href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a>(<a class="code" href="../../db/da9/my__sys_8h.html#a95e2a52417433d23f6b8825c52ee9197">MY_WME</a>))))</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(1);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ab8bc042e4c3feef2117642cee822dc65">buff_end</a>=net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>+net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aa992b03f110362b7281ad288326d29e8">max_packet</a>;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af25692866530d247001f5c189ffca8f6">error</a>=0; net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3ce1808fa2c992e291de3012c29c6857">return_status</a>=0;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee20cf636fc25c58b9da8c9aeabc33a9">pkt_nr</a>=net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee8117a193c6eaf0166b6d140fdc7c8e">compress_pkt_nr</a>=0;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">write_pos</a>=net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af65adc7b04ff56e008c6f8ca89cc12c2">read_pos</a> = net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a076ac7884d3874905c0c95b6518228fc">last_error</a>[0]=0;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ae72db65cba31233b606eacd0a0da5769">compress</a>=0; net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af097f7a98db2436221b2633daf1e6cba">reading_or_writing</a>=0;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a> = net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a99914ead05fefebd1b5033aac14f57c4">remain_in_buf</a>=0;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ad32d83e52fbb9bde714a4e91ddd4cca7">last_errno</a>=0;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af405b9e71e576024dde5601684393417">unused</a>= 0;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor">#if defined(MYSQL_SERVER) &amp;&amp; !defined(EMBEDDED_LIBRARY)</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  net-&gt;skip_big_packet= <a class="code" href="../../d8/dec/mpq-internal_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">if</span> (vio != 0)                 <span class="comment">/* If real connection */</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aec6de4e9b1fccc6ae611ef83cf06e689">fd</a>  = <a class="code" href="../../d2/dd9/violite_8h.html#aac3916742b0041a6bcc6b6913363580a">vio_fd</a>(vio);         <span class="comment">/* For perl DBI/DBD */</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#if defined(MYSQL_SERVER) &amp;&amp; !defined(__WIN__)</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">if</span> (!(test_flags &amp; <a class="code" href="../../dc/d7b/net__serv_8cc.html#ac01e941811fb73bcb8d4971672e40e3f">TEST_BLOCKING</a>))</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <a class="code" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> old_mode;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <a class="code" href="../../d2/dd9/violite_8h.html#a596127c4837248ffc807b60df342b84e">vio_blocking</a>(vio, <a class="code" href="../../d8/dec/mpq-internal_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, &amp;old_mode);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="../../d2/dd9/violite_8h.html#a999da325abfbbc7a7284bc49eddcf69c">vio_fastsend</a>(vio);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(0);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div>
<div class="ttc" id="adbug__long_8h_html_a56a51e0edb39d13c83021fd4e7bdc9e9"><div class="ttname"><a href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a></div><div class="ttdeci">#define DBUG_ENTER(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d35/dbug__long_8h_source.html#l00131">dbug_long.h:131</a></div></div>
<div class="ttc" id="adbug__long_8h_html_af63d1bddf8957387d14fe70b8db22b96"><div class="ttname"><a href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a></div><div class="ttdeci">#define DBUG_RETURN(a1)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d35/dbug__long_8h_source.html#l00138">dbug_long.h:138</a></div></div>
<div class="ttc" id="ampq-internal_8h_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="../../d8/dec/mpq-internal_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dec/mpq-internal_8h_source.html#l00059">mpq-internal.h:59</a></div></div>
<div class="ttc" id="amy__global_8h_html_a65f85814a8290f9797005d3b28e7e5fc"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a></div><div class="ttdeci">unsigned char uchar</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00874">my_global.h:874</a></div></div>
<div class="ttc" id="amy__global_8h_html_a74cd599039dcf29c6e6d342cf4efd0a8"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a></div><div class="ttdeci">char my_bool</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00992">my_global.h:992</a></div></div>
<div class="ttc" id="amy__global_8h_html_ab3b3804e3bf2734c0f4f1c72f30df1bd"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a></div><div class="ttdeci">#define MYF(v)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00995">my_global.h:995</a></div></div>
<div class="ttc" id="amy__sys_8h_html_a8f7b30ff5d0e10610637aa30c3e0048b"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#a8f7b30ff5d0e10610637aa30c3e0048b">my_malloc</a></div><div class="ttdeci">void * my_malloc(size_t Size, myf MyFlags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7c/my__malloc_8c_source.html#l00028">my_malloc.c:28</a></div></div>
<div class="ttc" id="amy__sys_8h_html_a95e2a52417433d23f6b8825c52ee9197"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#a95e2a52417433d23f6b8825c52ee9197">MY_WME</a></div><div class="ttdeci">#define MY_WME</div><div class="ttdef"><b>Definition:</b> <a href="../../db/da9/my__sys_8h_source.html#l00073">my_sys.h:73</a></div></div>
<div class="ttc" id="amysql__com_8h_html_a96b9fe0154bb8a7608f8a2708992ab3e"><div class="ttname"><a href="../../d6/df0/mysql__com_8h.html#a96b9fe0154bb8a7608f8a2708992ab3e">COMP_HEADER_SIZE</a></div><div class="ttdeci">#define COMP_HEADER_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00511">mysql_com.h:511</a></div></div>
<div class="ttc" id="amysql__com_8h_html_ad2977ebbc90bd5522d55e4f5b9fb58d6"><div class="ttname"><a href="../../d6/df0/mysql__com_8h.html#ad2977ebbc90bd5522d55e4f5b9fb58d6">my_net_local_init</a></div><div class="ttdeci">void my_net_local_init(NET *net)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d0a/libmysql_8c_source.html#l01108">libmysql.c:1108</a></div></div>
<div class="ttc" id="amysql__com_8h_html_ae6564c0f9410928921c747542d2b53f5"><div class="ttname"><a href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a></div><div class="ttdeci">#define NET_HEADER_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00510">mysql_com.h:510</a></div></div>
<div class="ttc" id="anet__serv_8cc_html_ac01e941811fb73bcb8d4971672e40e3f"><div class="ttname"><a href="../../dc/d7b/net__serv_8cc.html#ac01e941811fb73bcb8d4971672e40e3f">TEST_BLOCKING</a></div><div class="ttdeci">#define TEST_BLOCKING</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7b/net__serv_8cc_source.html#l00103">net_serv.cc:103</a></div></div>
<div class="ttc" id="astructst__net_html_a04dd4cfb0c11319b3ced573c160d75d5"><div class="ttname"><a href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">st_net::vio</a></div><div class="ttdeci">Vio * vio</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00283">mysql_com.h:283</a></div></div>
<div class="ttc" id="astructst__net_html_a076ac7884d3874905c0c95b6518228fc"><div class="ttname"><a href="../../de/d2d/structst__net.html#a076ac7884d3874905c0c95b6518228fc">st_net::last_error</a></div><div class="ttdeci">char last_error[MYSQL_ERRMSG_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00317">mysql_com.h:317</a></div></div>
<div class="ttc" id="astructst__net_html_a3acff748ebe3823c50d6c77d09281c79"><div class="ttname"><a href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">st_net::buff</a></div><div class="ttdeci">unsigned char * buff</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00284">mysql_com.h:284</a></div></div>
<div class="ttc" id="astructst__net_html_a3ce1808fa2c992e291de3012c29c6857"><div class="ttname"><a href="../../de/d2d/structst__net.html#a3ce1808fa2c992e291de3012c29c6857">st_net::return_status</a></div><div class="ttdeci">unsigned int * return_status</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00296">mysql_com.h:296</a></div></div>
<div class="ttc" id="astructst__net_html_a99914ead05fefebd1b5033aac14f57c4"><div class="ttname"><a href="../../de/d2d/structst__net.html#a99914ead05fefebd1b5033aac14f57c4">st_net::remain_in_buf</a></div><div class="ttdeci">unsigned long remain_in_buf</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00291">mysql_com.h:291</a></div></div>
<div class="ttc" id="astructst__net_html_aa992b03f110362b7281ad288326d29e8"><div class="ttname"><a href="../../de/d2d/structst__net.html#aa992b03f110362b7281ad288326d29e8">st_net::max_packet</a></div><div class="ttdeci">unsigned long max_packet</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00292">mysql_com.h:292</a></div></div>
<div class="ttc" id="astructst__net_html_ab8bc042e4c3feef2117642cee822dc65"><div class="ttname"><a href="../../de/d2d/structst__net.html#ab8bc042e4c3feef2117642cee822dc65">st_net::buff_end</a></div><div class="ttdeci">unsigned char * buff_end</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00284">mysql_com.h:284</a></div></div>
<div class="ttc" id="astructst__net_html_ac77e87598c188a301184a305b2766c9c"><div class="ttname"><a href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">st_net::where_b</a></div><div class="ttdeci">unsigned long where_b</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00291">mysql_com.h:291</a></div></div>
<div class="ttc" id="astructst__net_html_ad32d83e52fbb9bde714a4e91ddd4cca7"><div class="ttname"><a href="../../de/d2d/structst__net.html#ad32d83e52fbb9bde714a4e91ddd4cca7">st_net::last_errno</a></div><div class="ttdeci">unsigned int last_errno</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00312">mysql_com.h:312</a></div></div>
<div class="ttc" id="astructst__net_html_ae72db65cba31233b606eacd0a0da5769"><div class="ttname"><a href="../../de/d2d/structst__net.html#ae72db65cba31233b606eacd0a0da5769">st_net::compress</a></div><div class="ttdeci">my_bool compress</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00301">mysql_com.h:301</a></div></div>
<div class="ttc" id="astructst__net_html_aec6de4e9b1fccc6ae611ef83cf06e689"><div class="ttname"><a href="../../de/d2d/structst__net.html#aec6de4e9b1fccc6ae611ef83cf06e689">st_net::fd</a></div><div class="ttdeci">my_socket fd</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00285">mysql_com.h:285</a></div></div>
<div class="ttc" id="astructst__net_html_aee20cf636fc25c58b9da8c9aeabc33a9"><div class="ttname"><a href="../../de/d2d/structst__net.html#aee20cf636fc25c58b9da8c9aeabc33a9">st_net::pkt_nr</a></div><div class="ttdeci">unsigned int pkt_nr</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00293">mysql_com.h:293</a></div></div>
<div class="ttc" id="astructst__net_html_aee8117a193c6eaf0166b6d140fdc7c8e"><div class="ttname"><a href="../../de/d2d/structst__net.html#aee8117a193c6eaf0166b6d140fdc7c8e">st_net::compress_pkt_nr</a></div><div class="ttdeci">unsigned int compress_pkt_nr</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00293">mysql_com.h:293</a></div></div>
<div class="ttc" id="astructst__net_html_af097f7a98db2436221b2633daf1e6cba"><div class="ttname"><a href="../../de/d2d/structst__net.html#af097f7a98db2436221b2633daf1e6cba">st_net::reading_or_writing</a></div><div class="ttdeci">unsigned char reading_or_writing</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00297">mysql_com.h:297</a></div></div>
<div class="ttc" id="astructst__net_html_af160b75bc1ab06bd72a88ba7417f826e"><div class="ttname"><a href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">st_net::write_pos</a></div><div class="ttdeci">unsigned char * write_pos</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00284">mysql_com.h:284</a></div></div>
<div class="ttc" id="astructst__net_html_af25692866530d247001f5c189ffca8f6"><div class="ttname"><a href="../../de/d2d/structst__net.html#af25692866530d247001f5c189ffca8f6">st_net::error</a></div><div class="ttdeci">unsigned char error</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00313">mysql_com.h:313</a></div></div>
<div class="ttc" id="astructst__net_html_af405b9e71e576024dde5601684393417"><div class="ttname"><a href="../../de/d2d/structst__net.html#af405b9e71e576024dde5601684393417">st_net::unused</a></div><div class="ttdeci">unsigned char * unused</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00311">mysql_com.h:311</a></div></div>
<div class="ttc" id="astructst__net_html_af65adc7b04ff56e008c6f8ca89cc12c2"><div class="ttname"><a href="../../de/d2d/structst__net.html#af65adc7b04ff56e008c6f8ca89cc12c2">st_net::read_pos</a></div><div class="ttdeci">unsigned char * read_pos</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00284">mysql_com.h:284</a></div></div>
<div class="ttc" id="aviolite_8h_html_a596127c4837248ffc807b60df342b84e"><div class="ttname"><a href="../../d2/dd9/violite_8h.html#a596127c4837248ffc807b60df342b84e">vio_blocking</a></div><div class="ttdeci">#define vio_blocking(vio, set_blocking_mode, old_mode)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd9/violite_8h_source.html#l00161">violite.h:161</a></div></div>
<div class="ttc" id="aviolite_8h_html_a999da325abfbbc7a7284bc49eddcf69c"><div class="ttname"><a href="../../d2/dd9/violite_8h.html#a999da325abfbbc7a7284bc49eddcf69c">vio_fastsend</a></div><div class="ttdeci">#define vio_fastsend(vio)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd9/violite_8h_source.html#l00164">violite.h:164</a></div></div>
<div class="ttc" id="aviolite_8h_html_aac3916742b0041a6bcc6b6913363580a"><div class="ttname"><a href="../../d2/dd9/violite_8h.html#aac3916742b0041a6bcc6b6913363580a">vio_fd</a></div><div class="ttdeci">my_socket vio_fd(Vio *vio)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d4e/viosocket_8c_source.html#l00311">viosocket.c:311</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::buff</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::buff_end</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00511">COMP_HEADER_SIZE</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00301">st_net::compress</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00293">st_net::compress_pkt_nr</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00138">DBUG_RETURN</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00313">st_net::error</a>, <a class="el" href="../../d8/dec/mpq-internal_8h_source.html#l00059">FALSE</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00285">st_net::fd</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00312">st_net::last_errno</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00317">st_net::last_error</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00292">st_net::max_packet</a>, <a class="el" href="../../d0/d7c/my__malloc_8c_source.html#l00028">my_malloc()</a>, <a class="el" href="../../d5/d0a/libmysql_8c_source.html#l01108">my_net_local_init()</a>, <a class="el" href="../../db/da9/my__sys_8h_source.html#l00073">MY_WME</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l00995">MYF</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00510">NET_HEADER_SIZE</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00293">st_net::pkt_nr</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::read_pos</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00297">st_net::reading_or_writing</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00291">st_net::remain_in_buf</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00296">st_net::return_status</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00103">TEST_BLOCKING</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00311">st_net::unused</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00283">st_net::vio</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00161">vio_blocking</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00164">vio_fastsend</a>, <a class="el" href="../../d6/d4e/viosocket_8c_source.html#l00311">vio_fd()</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00291">st_net::where_b</a>, and <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::write_pos</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d93/client_8c_source.html#l02908">CLI_MYSQL_REAL_CONNECT()</a>.</p>

</div>
</div>
<a id="a95459c0280e24b9aacd761d0cc6ad749"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95459c0280e24b9aacd761d0cc6ad749">&#9670;&nbsp;</a></span>my_net_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> my_net_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read a packet from the client/server and return it without the internal package header.</p>
<p>If the packet is the first packet of a multi-packet packet (which is indicated by the length of the packet = 0xffffff) then all sub packets are read and concatenated.</p>
<p>If the packet was compressed, its uncompressed and the length of the uncompressed packet is returned.</p>
<dl class="section return"><dt>Returns</dt><dd>The function returns the length of the found packet or packet_error. net-&gt;read_pos points to the read data. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l01018">1018</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;{</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <span class="keywordtype">size_t</span> len, complen;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160; </div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  <a class="code" href="../../db/dbc/probes__mysql__nodtrace_8h.html#a5c1adb693886278214ba1b222a90637a">MYSQL_NET_READ_START</a>();</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160; </div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="preprocessor">#ifdef HAVE_COMPRESS</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  <span class="keywordflow">if</span> (!net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ae72db65cba31233b606eacd0a0da5769">compress</a>)</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  {</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    len = <a class="code" href="../../dc/d7b/net__serv_8cc.html#a740f98fca02653ee59b50834bf18177c">my_real_read</a>(net,&amp;complen);</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keywordflow">if</span> (len == <a class="code" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a>)</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    {</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      <span class="comment">/* First packet of a multi-packet.  Concatenate the packets */</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> save_pos = net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a>;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <span class="keywordtype">size_t</span> total_length= 0;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      <span class="keywordflow">do</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      {</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a> += len;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    total_length += len;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    len = <a class="code" href="../../dc/d7b/net__serv_8cc.html#a740f98fca02653ee59b50834bf18177c">my_real_read</a>(net,&amp;complen);</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      } <span class="keywordflow">while</span> (len == <a class="code" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a>);</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      <span class="keywordflow">if</span> (len != <a class="code" href="../../d6/df0/mysql__com_8h.html#a08253bf6eaa0178369f3ee1055b914a0">packet_error</a>)</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    len+= total_length;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a> = save_pos;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    }</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af65adc7b04ff56e008c6f8ca89cc12c2">read_pos</a> = net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a> + net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a>;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="keywordflow">if</span> (len != <a class="code" href="../../d6/df0/mysql__com_8h.html#a08253bf6eaa0178369f3ee1055b914a0">packet_error</a>)</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af65adc7b04ff56e008c6f8ca89cc12c2">read_pos</a>[len]=0;     <span class="comment">/* Safeguard for mysql_use_result */</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <a class="code" href="../../db/dbc/probes__mysql__nodtrace_8h.html#a8ce03b1cbb4e5212b3cebed0bb6e4202">MYSQL_NET_READ_DONE</a>(0, len);</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="keywordflow">return</span> len;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="preprocessor">#ifdef HAVE_COMPRESS</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  }</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  {</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <span class="comment">/* We are using the compressed protocol */</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160; </div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> buf_length;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> start_of_packet;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> first_packet_offset;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> read_length, multi_byte_packet=0;</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160; </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="keywordflow">if</span> (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a99914ead05fefebd1b5033aac14f57c4">remain_in_buf</a>)</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    {</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;      buf_length= net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a4c85ad00063e8dc380d73c61b8556c3a">buf_length</a>;      <span class="comment">/* Data left in old packet */</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      first_packet_offset= start_of_packet= (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a4c85ad00063e8dc380d73c61b8556c3a">buf_length</a> -</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                         net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a99914ead05fefebd1b5033aac14f57c4">remain_in_buf</a>);</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <span class="comment">/* Restore the character that was overwritten by the end 0 */</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>[start_of_packet]= net-&gt;<a class="code" href="../../de/d2d/structst__net.html#abf68d4ab7d94a60f5b367e137db8b897">save_char</a>;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    }</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    {</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      <span class="comment">/* reuse buffer, as there is nothing in it that we need */</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      buf_length= start_of_packet= first_packet_offset= 0;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    }</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="keywordflow">for</span> (;;)</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      <a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> packet_len;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160; </div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      <span class="keywordflow">if</span> (buf_length - start_of_packet &gt;= <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>)</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      {</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    read_length = <a class="code" href="../../d9/df6/my__global_8h.html#aedc96aeb04ad09b859442aadfc729cc2">uint3korr</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>+start_of_packet);</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordflow">if</span> (!read_length)</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    { </div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <span class="comment">/* End of multi-byte packet */</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      start_of_packet += <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    }</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordflow">if</span> (read_length + <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a> &lt;= buf_length - start_of_packet)</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    {</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      <span class="keywordflow">if</span> (multi_byte_packet)</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      {</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="comment">/* Remove packet header for second packet */</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <a class="code" href="../../d6/dda/m__string_8h.html#ac3cb9e44f3dff4c913b18456669a3002">memmove</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a> + first_packet_offset + start_of_packet,</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a> + first_packet_offset + start_of_packet +</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>,</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            buf_length - start_of_packet);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        start_of_packet += read_length;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        buf_length -= <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        start_of_packet+= read_length + <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160; </div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      <span class="keywordflow">if</span> (read_length != <a class="code" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a>) <span class="comment">/* last package */</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      {</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        multi_byte_packet= 0;       <span class="comment">/* No last zero len packet */</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      }</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      multi_byte_packet= <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      <span class="comment">/* Move data down to read next data packet after current one */</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      <span class="keywordflow">if</span> (first_packet_offset)</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      {</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        <a class="code" href="../../d6/dda/m__string_8h.html#ac3cb9e44f3dff4c913b18456669a3002">memmove</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>,net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>+first_packet_offset,</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            buf_length-first_packet_offset);</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        buf_length-=first_packet_offset;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        start_of_packet -= first_packet_offset;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        first_packet_offset=0;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      }</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    }</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      }</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;      <span class="comment">/* Move data down to read next data packet after current one */</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      <span class="keywordflow">if</span> (first_packet_offset)</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      {</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <a class="code" href="../../d6/dda/m__string_8h.html#ac3cb9e44f3dff4c913b18456669a3002">memmove</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>,net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>+first_packet_offset,</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        buf_length-first_packet_offset);</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    buf_length-=first_packet_offset;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    start_of_packet -= first_packet_offset;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    first_packet_offset=0;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      }</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160; </div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a>=buf_length;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      <span class="keywordflow">if</span> ((packet_len = <a class="code" href="../../dc/d7b/net__serv_8cc.html#a740f98fca02653ee59b50834bf18177c">my_real_read</a>(net,&amp;complen)) == <a class="code" href="../../d6/df0/mysql__com_8h.html#a08253bf6eaa0178369f3ee1055b914a0">packet_error</a>)</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      {</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        <a class="code" href="../../db/dbc/probes__mysql__nodtrace_8h.html#a8ce03b1cbb4e5212b3cebed0bb6e4202">MYSQL_NET_READ_DONE</a>(1, 0);</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d6/df0/mysql__com_8h.html#a08253bf6eaa0178369f3ee1055b914a0">packet_error</a>;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      }</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/da9/my__sys_8h.html#af5bab45f7f50721411d765ba83a39267">my_uncompress</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a> + net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a>, packet_len,</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;            &amp;complen))</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      {</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af25692866530d247001f5c189ffca8f6">error</a>= 2;          <span class="comment">/* caller will close socket */</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ad32d83e52fbb9bde714a4e91ddd4cca7">last_errno</a>= <a class="code" href="../../d1/d40/mysqld__error_8h.html#a2588d6444b517e9b01bf3d3cb58b591c">ER_NET_UNCOMPRESS_ERROR</a>;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="preprocessor">#ifdef MYSQL_SERVER</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <a class="code" href="../../db/da9/my__sys_8h.html#a19ebf963aef6b242322e15e01811972e">my_error</a>(<a class="code" href="../../d1/d40/mysqld__error_8h.html#a2588d6444b517e9b01bf3d3cb58b591c">ER_NET_UNCOMPRESS_ERROR</a>, <a class="code" href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a>(0));</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        <a class="code" href="../../db/dbc/probes__mysql__nodtrace_8h.html#a8ce03b1cbb4e5212b3cebed0bb6e4202">MYSQL_NET_READ_DONE</a>(1, 0);</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d6/df0/mysql__com_8h.html#a08253bf6eaa0178369f3ee1055b914a0">packet_error</a>;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      }</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      buf_length+= complen;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    }</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160; </div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af65adc7b04ff56e008c6f8ca89cc12c2">read_pos</a>=      net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>+ first_packet_offset + <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a4c85ad00063e8dc380d73c61b8556c3a">buf_length</a>=    buf_length;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a99914ead05fefebd1b5033aac14f57c4">remain_in_buf</a>= (<a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) (buf_length - start_of_packet);</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    len = ((<a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) (start_of_packet - first_packet_offset) - <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a> -</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;           multi_byte_packet);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#abf68d4ab7d94a60f5b367e137db8b897">save_char</a>= net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af65adc7b04ff56e008c6f8ca89cc12c2">read_pos</a>[len]; <span class="comment">/* Must be saved */</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af65adc7b04ff56e008c6f8ca89cc12c2">read_pos</a>[len]=0;       <span class="comment">/* Safeguard for mysql_use_result */</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  }</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_COMPRESS */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <a class="code" href="../../db/dbc/probes__mysql__nodtrace_8h.html#a8ce03b1cbb4e5212b3cebed0bb6e4202">MYSQL_NET_READ_DONE</a>(0, len);</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <span class="keywordflow">return</span> len;</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;}</div>
<div class="ttc" id="am__string_8h_html_ac3cb9e44f3dff4c913b18456669a3002"><div class="ttname"><a href="../../d6/dda/m__string_8h.html#ac3cb9e44f3dff4c913b18456669a3002">memmove</a></div><div class="ttdeci">#define memmove(d, s, n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dda/m__string_8h_source.html#l00052">m_string.h:52</a></div></div>
<div class="ttc" id="amy__global_8h_html_a718b4eb2652c286f4d42dc18a8e71a1a"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a></div><div class="ttdeci">unsigned long ulong</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00908">my_global.h:908</a></div></div>
<div class="ttc" id="amy__global_8h_html_a91ad9478d81a7aaf2593e8d9c3d06a14"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a></div><div class="ttdeci">unsigned int uint</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00475">my_global.h:475</a></div></div>
<div class="ttc" id="amy__global_8h_html_aedc96aeb04ad09b859442aadfc729cc2"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#aedc96aeb04ad09b859442aadfc729cc2">uint3korr</a></div><div class="ttdeci">#define uint3korr(A)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l01150">my_global.h:1150</a></div></div>
<div class="ttc" id="amy__sys_8h_html_a19ebf963aef6b242322e15e01811972e"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#a19ebf963aef6b242322e15e01811972e">my_error</a></div><div class="ttdeci">void my_error(int nr, myf MyFlags,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc6/my__error_8c_source.html#l00071">my_error.c:71</a></div></div>
<div class="ttc" id="amy__sys_8h_html_af5bab45f7f50721411d765ba83a39267"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#af5bab45f7f50721411d765ba83a39267">my_uncompress</a></div><div class="ttdeci">my_bool my_uncompress(uchar *, size_t, size_t *)</div></div>
<div class="ttc" id="amysql__com_8h_html_a08253bf6eaa0178369f3ee1055b914a0"><div class="ttname"><a href="../../d6/df0/mysql__com_8h.html#a08253bf6eaa0178369f3ee1055b914a0">packet_error</a></div><div class="ttdeci">#define packet_error</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00334">mysql_com.h:334</a></div></div>
<div class="ttc" id="amysqld__error_8h_html_a2588d6444b517e9b01bf3d3cb58b591c"><div class="ttname"><a href="../../d1/d40/mysqld__error_8h.html#a2588d6444b517e9b01bf3d3cb58b591c">ER_NET_UNCOMPRESS_ERROR</a></div><div class="ttdeci">#define ER_NET_UNCOMPRESS_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d40/mysqld__error_8h_source.html#l00161">mysqld_error.h:161</a></div></div>
<div class="ttc" id="anet__serv_8cc_html_a740f98fca02653ee59b50834bf18177c"><div class="ttname"><a href="../../dc/d7b/net__serv_8cc.html#a740f98fca02653ee59b50834bf18177c">my_real_read</a></div><div class="ttdeci">static ulong my_real_read(NET *net, size_t *complen)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7b/net__serv_8cc_source.html#l00801">net_serv.cc:801</a></div></div>
<div class="ttc" id="anet__serv_8cc_html_a973c680573b37fc359fc68d0707da355"><div class="ttname"><a href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a></div><div class="ttdeci">#define MAX_PACKET_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7b/net__serv_8cc_source.html#l00104">net_serv.cc:104</a></div></div>
<div class="ttc" id="aprobes__mysql__nodtrace_8h_html_a5c1adb693886278214ba1b222a90637a"><div class="ttname"><a href="../../db/dbc/probes__mysql__nodtrace_8h.html#a5c1adb693886278214ba1b222a90637a">MYSQL_NET_READ_START</a></div><div class="ttdeci">#define MYSQL_NET_READ_START()</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbc/probes__mysql__nodtrace_8h_source.html#l00100">probes_mysql_nodtrace.h:100</a></div></div>
<div class="ttc" id="aprobes__mysql__nodtrace_8h_html_a8ce03b1cbb4e5212b3cebed0bb6e4202"><div class="ttname"><a href="../../db/dbc/probes__mysql__nodtrace_8h.html#a8ce03b1cbb4e5212b3cebed0bb6e4202">MYSQL_NET_READ_DONE</a></div><div class="ttdeci">#define MYSQL_NET_READ_DONE(arg0, arg1)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbc/probes__mysql__nodtrace_8h_source.html#l00102">probes_mysql_nodtrace.h:102</a></div></div>
<div class="ttc" id="astructst__net_html_a4c85ad00063e8dc380d73c61b8556c3a"><div class="ttname"><a href="../../de/d2d/structst__net.html#a4c85ad00063e8dc380d73c61b8556c3a">st_net::buf_length</a></div><div class="ttdeci">unsigned long buf_length</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00291">mysql_com.h:291</a></div></div>
<div class="ttc" id="astructst__net_html_abf68d4ab7d94a60f5b367e137db8b897"><div class="ttname"><a href="../../de/d2d/structst__net.html#abf68d4ab7d94a60f5b367e137db8b897">st_net::save_char</a></div><div class="ttdeci">char save_char</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00298">mysql_com.h:298</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00291">st_net::buf_length</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::buff</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00301">st_net::compress</a>, <a class="el" href="../../d1/d40/mysqld__error_8h_source.html#l00161">ER_NET_UNCOMPRESS_ERROR</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00313">st_net::error</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00312">st_net::last_errno</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00104">MAX_PACKET_LENGTH</a>, <a class="el" href="../../d6/dda/m__string_8h_source.html#l00052">memmove</a>, <a class="el" href="../../d4/dc6/my__error_8c_source.html#l00071">my_error()</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00801">my_real_read()</a>, <a class="el" href="../../db/da9/my__sys_8h.html#af5bab45f7f50721411d765ba83a39267">my_uncompress()</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l00995">MYF</a>, <a class="el" href="../../db/dbc/probes__mysql__nodtrace_8h_source.html#l00102">MYSQL_NET_READ_DONE</a>, <a class="el" href="../../db/dbc/probes__mysql__nodtrace_8h_source.html#l00100">MYSQL_NET_READ_START</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00510">NET_HEADER_SIZE</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00334">packet_error</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::read_pos</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00291">st_net::remain_in_buf</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00298">st_net::save_char</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l01150">uint3korr</a>, and <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00291">st_net::where_b</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d93/client_8c_source.html#l00729">cli_safe_read()</a>.</p>

</div>
</div>
<a id="a813a0a36437c4c7f62b50fbb86617220"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a813a0a36437c4c7f62b50fbb86617220">&#9670;&nbsp;</a></span>my_net_set_read_timeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void my_net_set_read_timeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l01163">1163</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;{</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;my_net_set_read_timeout&quot;</span>);</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;enter&quot;</span>, (<span class="stringliteral">&quot;timeout: %d&quot;</span>, timeout));</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a498927f121414f913f35585dbfa2d4b3">read_timeout</a>= timeout;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="preprocessor">#ifdef NO_ALARM</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <span class="keywordflow">if</span> (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>)</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <a class="code" href="../../d2/dd9/violite_8h.html#a7268e264d2c424b5a3e75bc44de97f25">vio_timeout</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>, 0, timeout);</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a2d990f1c0bd095fcbac9c6596274be55">DBUG_VOID_RETURN</a>;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;}</div>
<div class="ttc" id="adbug__long_8h_html_a2d990f1c0bd095fcbac9c6596274be55"><div class="ttname"><a href="../../d1/d35/dbug__long_8h.html#a2d990f1c0bd095fcbac9c6596274be55">DBUG_VOID_RETURN</a></div><div class="ttdeci">#define DBUG_VOID_RETURN</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d35/dbug__long_8h_source.html#l00140">dbug_long.h:140</a></div></div>
<div class="ttc" id="adbug__long_8h_html_a3770d2ff545ed3e4b714d20014e663df"><div class="ttname"><a href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a></div><div class="ttdeci">#define DBUG_PRINT(keyword, arglist)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d35/dbug__long_8h_source.html#l00143">dbug_long.h:143</a></div></div>
<div class="ttc" id="astructst__net_html_a498927f121414f913f35585dbfa2d4b3"><div class="ttname"><a href="../../de/d2d/structst__net.html#a498927f121414f913f35585dbfa2d4b3">st_net::read_timeout</a></div><div class="ttdeci">unsigned int read_timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00294">mysql_com.h:294</a></div></div>
<div class="ttc" id="aviolite_8h_html_a7268e264d2c424b5a3e75bc44de97f25"><div class="ttname"><a href="../../d2/dd9/violite_8h.html#a7268e264d2c424b5a3e75bc44de97f25">vio_timeout</a></div><div class="ttdeci">#define vio_timeout(vio, which, seconds)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd9/violite_8h_source.html#l00170">violite.h:170</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00143">DBUG_PRINT</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00140">DBUG_VOID_RETURN</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00294">st_net::read_timeout</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00283">st_net::vio</a>, and <a class="el" href="../../d2/dd9/violite_8h_source.html#l00170">vio_timeout</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d93/client_8c_source.html#l02908">CLI_MYSQL_REAL_CONNECT()</a>, and <a class="el" href="../../d5/d0a/libmysql_8c_source.html#l01108">my_net_local_init()</a>.</p>

</div>
</div>
<a id="a2256fff5962624fac7e47f8aec12402c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2256fff5962624fac7e47f8aec12402c">&#9670;&nbsp;</a></span>my_net_set_write_timeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void my_net_set_write_timeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l01176">1176</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;{</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;my_net_set_write_timeout&quot;</span>);</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;enter&quot;</span>, (<span class="stringliteral">&quot;timeout: %d&quot;</span>, timeout));</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a178724b62ac9b041f5e21b1b9897b694">write_timeout</a>= timeout;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="preprocessor">#ifdef NO_ALARM</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;  <span class="keywordflow">if</span> (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>)</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <a class="code" href="../../d2/dd9/violite_8h.html#a7268e264d2c424b5a3e75bc44de97f25">vio_timeout</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>, 1, timeout);</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a2d990f1c0bd095fcbac9c6596274be55">DBUG_VOID_RETURN</a>;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;}</div>
<div class="ttc" id="astructst__net_html_a178724b62ac9b041f5e21b1b9897b694"><div class="ttname"><a href="../../de/d2d/structst__net.html#a178724b62ac9b041f5e21b1b9897b694">st_net::write_timeout</a></div><div class="ttdeci">unsigned int write_timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00294">mysql_com.h:294</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00143">DBUG_PRINT</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00140">DBUG_VOID_RETURN</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00283">st_net::vio</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00170">vio_timeout</a>, and <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00294">st_net::write_timeout</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d93/client_8c_source.html#l02908">CLI_MYSQL_REAL_CONNECT()</a>, and <a class="el" href="../../d5/d0a/libmysql_8c_source.html#l01108">my_net_local_init()</a>.</p>

</div>
</div>
<a id="aae75e6bc59f4837011c9daf6aa4242de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae75e6bc59f4837011c9daf6aa4242de">&#9670;&nbsp;</a></span>my_net_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> my_net_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/d95/zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write a logical packet with packet header.</p>
<p>Format: Packet length (3 bytes), packet number(1 byte) When compression is used a 3 byte compression length is added</p>
<dl class="section note"><dt>Note</dt><dd>If compression is used the original package is modified! </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00363">363</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;{</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> buff[<a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>];</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordtype">int</span> rc;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../dd/de0/deps_2jemalloc_2include_2jemalloc_2internal_2util_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(!net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>)) <span class="comment">/* nowhere to write */</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <a class="code" href="../../db/dbc/probes__mysql__nodtrace_8h.html#a44edec30d2fc862246fc5cd930260a84">MYSQL_NET_WRITE_START</a>(len);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">    Big packets are handled by splitting them in packets of MAX_PACKET_LENGTH</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">    length. The last packet is always a packet that is &lt; MAX_PACKET_LENGTH.</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">    (The last packet may even have a length of 0)</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="keywordflow">while</span> (len &gt;= <a class="code" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a>)</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  {</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> z_size = <a class="code" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a604b63506b0857bf76b616883aeb1099">int3store</a>(buff, z_size);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    buff[3]= (<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>) net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee20cf636fc25c58b9da8c9aeabc33a9">pkt_nr</a>++;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <a class="code" href="../../dd/d68/_c_make_lists_8txt.html#a0b5da418382bdd0db6dff439e2863979">if</a> (<a class="code" href="../../dc/d7b/net__serv_8cc.html#ad35f9f2580bfbba65f69666ac4e081fd">net_write_buff</a>(net, buff, <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>) ||</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <a class="code" href="../../dc/d7b/net__serv_8cc.html#ad35f9f2580bfbba65f69666ac4e081fd">net_write_buff</a>(net, packet, z_size))</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <a class="code" href="../../db/dbc/probes__mysql__nodtrace_8h.html#ac33a63f9118b5a389e2028afaf30e981">MYSQL_NET_WRITE_DONE</a>(1);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    packet += z_size;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    len-=     z_size;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  }</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="comment">/* Write last packet */</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a604b63506b0857bf76b616883aeb1099">int3store</a>(buff,len);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  buff[3]= (<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>) net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee20cf636fc25c58b9da8c9aeabc33a9">pkt_nr</a>++;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <a class="code" href="../../dd/d68/_c_make_lists_8txt.html#a0b5da418382bdd0db6dff439e2863979">if</a> (<a class="code" href="../../dc/d7b/net__serv_8cc.html#ad35f9f2580bfbba65f69666ac4e081fd">net_write_buff</a>(net, buff, <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>))</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <a class="code" href="../../db/dbc/probes__mysql__nodtrace_8h.html#ac33a63f9118b5a389e2028afaf30e981">MYSQL_NET_WRITE_DONE</a>(1);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  }</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="preprocessor">#ifndef DEBUG_DATA_PACKETS</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a986ff5ad8d1d935c5d8b0df13b6965a5">DBUG_DUMP</a>(<span class="stringliteral">&quot;packet_header&quot;</span>, buff, <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  rc= <a class="code" href="../../d9/df6/my__global_8h.html#aa6cd438f0d8653fd1e4d22046b0cb662">test</a>(<a class="code" href="../../dc/d7b/net__serv_8cc.html#ad35f9f2580bfbba65f69666ac4e081fd">net_write_buff</a>(net,packet,len));</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <a class="code" href="../../db/dbc/probes__mysql__nodtrace_8h.html#ac33a63f9118b5a389e2028afaf30e981">MYSQL_NET_WRITE_DONE</a>(rc);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <span class="keywordflow">return</span> rc;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;}</div>
<div class="ttc" id="a_c_make_lists_8txt_html_a0b5da418382bdd0db6dff439e2863979"><div class="ttname"><a href="../../dd/d68/_c_make_lists_8txt.html#a0b5da418382bdd0db6dff439e2863979">if</a></div><div class="ttdeci">NAME if(&quot;;${DISABLED_AC_MODULES};&quot; MATCHES &quot;;${MODULENAME};&quot;) continue() endif() if(EXISTS &quot;$</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d68/_c_make_lists_8txt_source.html#l00068">CMakeLists.txt:68</a></div></div>
<div class="ttc" id="adbug__long_8h_html_a986ff5ad8d1d935c5d8b0df13b6965a5"><div class="ttname"><a href="../../d1/d35/dbug__long_8h.html#a986ff5ad8d1d935c5d8b0df13b6965a5">DBUG_DUMP</a></div><div class="ttdeci">#define DBUG_DUMP(keyword, a1, a2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d35/dbug__long_8h_source.html#l00159">dbug_long.h:159</a></div></div>
<div class="ttc" id="adeps_2jemalloc_2include_2jemalloc_2internal_2util_8h_html_ac6c45889010c1bd68631771b64f18101"><div class="ttname"><a href="../../dd/de0/deps_2jemalloc_2include_2jemalloc_2internal_2util_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a></div><div class="ttdeci">#define unlikely(x)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/de0/deps_2jemalloc_2include_2jemalloc_2internal_2util_8h_source.html#l00036">util.h:36</a></div></div>
<div class="ttc" id="amy__global_8h_html_a604b63506b0857bf76b616883aeb1099"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#a604b63506b0857bf76b616883aeb1099">int3store</a></div><div class="ttdeci">#define int3store(T, A)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l01181">my_global.h:1181</a></div></div>
<div class="ttc" id="amy__global_8h_html_aa6cd438f0d8653fd1e4d22046b0cb662"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#aa6cd438f0d8653fd1e4d22046b0cb662">test</a></div><div class="ttdeci">#define test(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00480">my_global.h:480</a></div></div>
<div class="ttc" id="anet__serv_8cc_html_ad35f9f2580bfbba65f69666ac4e081fd"><div class="ttname"><a href="../../dc/d7b/net__serv_8cc.html#ad35f9f2580bfbba65f69666ac4e081fd">net_write_buff</a></div><div class="ttdeci">static my_bool net_write_buff(NET *net, const uchar *packet, ulong len)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7b/net__serv_8cc_source.html#l00510">net_serv.cc:510</a></div></div>
<div class="ttc" id="aprobes__mysql__nodtrace_8h_html_a44edec30d2fc862246fc5cd930260a84"><div class="ttname"><a href="../../db/dbc/probes__mysql__nodtrace_8h.html#a44edec30d2fc862246fc5cd930260a84">MYSQL_NET_WRITE_START</a></div><div class="ttdeci">#define MYSQL_NET_WRITE_START(arg0)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbc/probes__mysql__nodtrace_8h_source.html#l00104">probes_mysql_nodtrace.h:104</a></div></div>
<div class="ttc" id="aprobes__mysql__nodtrace_8h_html_ac33a63f9118b5a389e2028afaf30e981"><div class="ttname"><a href="../../db/dbc/probes__mysql__nodtrace_8h.html#ac33a63f9118b5a389e2028afaf30e981">MYSQL_NET_WRITE_DONE</a></div><div class="ttdeci">#define MYSQL_NET_WRITE_DONE(arg0)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbc/probes__mysql__nodtrace_8h_source.html#l00106">probes_mysql_nodtrace.h:106</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00159">DBUG_DUMP</a>, <a class="el" href="../../dd/d68/_c_make_lists_8txt_source.html#l00068">if()</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l01181">int3store</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00104">MAX_PACKET_LENGTH</a>, <a class="el" href="../../db/dbc/probes__mysql__nodtrace_8h_source.html#l00106">MYSQL_NET_WRITE_DONE</a>, <a class="el" href="../../db/dbc/probes__mysql__nodtrace_8h_source.html#l00104">MYSQL_NET_WRITE_START</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00510">NET_HEADER_SIZE</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00510">net_write_buff()</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00293">st_net::pkt_nr</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l00480">test</a>, <a class="el" href="../../dd/de0/deps_2jemalloc_2include_2jemalloc_2internal_2util_8h_source.html#l00036">unlikely</a>, and <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00283">st_net::vio</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d93/client_8c_source.html#l02655">client_mpvio_write_packet()</a>, <a class="el" href="../../d5/d0a/libmysql_8c_source.html#l00443">handle_local_infile()</a>, and <a class="el" href="../../dd/d93/client_8c_source.html#l02425">send_client_reply_packet()</a>.</p>

</div>
</div>
<a id="a740f98fca02653ee59b50834bf18177c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a740f98fca02653ee59b50834bf18177c">&#9670;&nbsp;</a></span>my_real_read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> my_real_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>complen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Reads one packet to net-&gt;buff + net-&gt;where_b. Long packets are handled by <a class="el" href="../../dc/d7b/net__serv_8cc.html#a95459c0280e24b9aacd761d0cc6ad749">my_net_read()</a>. This function reallocates the net-&gt;buff buffer if necessary.</p>
<dl class="section return"><dt>Returns</dt><dd>Returns length of packet. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00801">801</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;{</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *<a class="code" href="../../db/d36/base64_8c.html#a5e75484d7880fa39b31f27c3d7058936">pos</a>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> i,retry_count=0;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> len=<a class="code" href="../../d6/df0/mysql__com_8h.html#a08253bf6eaa0178369f3ee1055b914a0">packet_error</a>;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <a class="code" href="../../d5/d85/thr__alarm_8h.html#a0f3d9ec5fc0aa4359ca24674a579ef22">thr_alarm_t</a> alarmed;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="preprocessor">#ifndef NO_ALARM</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <a class="code" href="../../d4/d3f/structst__alarm.html">ALARM</a> alarm_buff;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> net_blocking=<a class="code" href="../../d2/dd9/violite_8h.html#a15bf5ee18a6133eb651693809d1f94a1">vio_is_blocking</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <a class="code" href="../../db/d35/_define_8h.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> remain= (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ae72db65cba31233b606eacd0a0da5769">compress</a> ? <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>+<a class="code" href="../../d6/df0/mysql__com_8h.html#a96b9fe0154bb8a7608f8a2708992ab3e">COMP_HEADER_SIZE</a> :</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;          <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  *complen = 0;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160; </div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af097f7a98db2436221b2633daf1e6cba">reading_or_writing</a>=1;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <a class="code" href="../../d5/d85/thr__alarm_8h.html#a41ddbe2759bc9d1d6c107674bcb88e25">thr_alarm_init</a>(&amp;alarmed);</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="preprocessor">#ifndef NO_ALARM</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="keywordflow">if</span> (net_blocking)</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <a class="code" href="../../d5/d85/thr__alarm_8h.html#adbed654dbd2397ea54cc01c3ea919a4f">thr_alarm</a>(&amp;alarmed,net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a498927f121414f913f35585dbfa2d4b3">read_timeout</a>,&amp;alarm_buff);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  <span class="comment">/* Read timeout is set in my_net_set_read_timeout */</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* NO_ALARM */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160; </div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <a class="code" href="../../db/d36/base64_8c.html#a5e75484d7880fa39b31f27c3d7058936">pos</a> = net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a> + net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a>;     <span class="comment">/* net-&gt;packet -4 */</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordflow">for</span> (i=0 ; i &lt; 2 ; i++)</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    {</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      <span class="keywordflow">while</span> (remain &gt; 0)</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      {</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="comment">/* First read is done with non blocking mode */</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <span class="keywordflow">if</span> ((<span class="keywordtype">long</span>) (<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>= <a class="code" href="../../d2/dd9/violite_8h.html#ad246ea579154afe07d5ad34a9f465745">vio_read</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>, <a class="code" href="../../db/d36/base64_8c.html#a5e75484d7880fa39b31f27c3d7058936">pos</a>, remain)) &lt;= 0L)</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        {</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;          <a class="code" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> interrupted = <a class="code" href="../../d2/dd9/violite_8h.html#a55a066cae80a21e7d85963fbde80df73">vio_should_retry</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>);</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;info&quot;</span>,(<span class="stringliteral">&quot;vio_read returned %ld  errno: %d&quot;</span>,</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                 (<span class="keywordtype">long</span>) <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>, <a class="code" href="../../d2/dd9/violite_8h.html#a07905c60f1763b59da8f2d7b3dad4922">vio_errno</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>)));</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="preprocessor">#if !defined(__WIN__) || defined(MYSQL_SERVER)</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      <span class="comment">/*</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment">        We got an error that there was no data on the socket. We now set up</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">        an alarm to not &#39;read forever&#39;, change the socket to non blocking</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">        mode and try again</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">      */</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <span class="keywordflow">if</span> ((interrupted || <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a> == 0) &amp;&amp; !<a class="code" href="../../d5/d85/thr__alarm_8h.html#a551404263c6127823adcc2ee3b0dd5e9">thr_alarm_in_use</a>(&amp;alarmed))</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      {</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d85/thr__alarm_8h.html#adbed654dbd2397ea54cc01c3ea919a4f">thr_alarm</a>(&amp;alarmed,net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a498927f121414f913f35585dbfa2d4b3">read_timeout</a>,&amp;alarm_buff)) <span class="comment">/* Don&#39;t wait too long */</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;          <a class="code" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> old_mode;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;          <span class="keywordflow">while</span> (<a class="code" href="../../d2/dd9/violite_8h.html#a596127c4837248ffc807b60df342b84e">vio_blocking</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>, <a class="code" href="../../d8/dec/mpq-internal_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, &amp;old_mode) &lt; 0)</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;          {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd9/violite_8h.html#a55a066cae80a21e7d85963fbde80df73">vio_should_retry</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>) &amp;&amp;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            retry_count++ &lt; net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a0365f5779e0d4a8052dbd26a04196b5b">retry_count</a>)</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;error&quot;</span>,</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;               (<span class="stringliteral">&quot;fcntl returned error %d, aborting thread&quot;</span>,</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                <a class="code" href="../../d2/dd9/violite_8h.html#a07905c60f1763b59da8f2d7b3dad4922">vio_errno</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>)));</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="preprocessor">#ifdef EXTRA_DEBUG</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <a class="code" href="../../d3/d6b/printf_8h.html#a9f315126362cae9675de1642105e631e">fprintf</a>(stderr,</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            <span class="stringliteral">&quot;%s: read: fcntl returned error %d, aborting thread\n&quot;</span>,</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            <a class="code" href="../../db/da9/my__sys_8h.html#a98dde45574f5cf90dc6a9a4a5090f47a">my_progname</a>,<a class="code" href="../../d2/dd9/violite_8h.html#a07905c60f1763b59da8f2d7b3dad4922">vio_errno</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>));</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* EXTRA_DEBUG */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        len= <a class="code" href="../../d6/df0/mysql__com_8h.html#a08253bf6eaa0178369f3ee1055b914a0">packet_error</a>;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af25692866530d247001f5c189ffca8f6">error</a>= 2;                 <span class="comment">/* Close socket */</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ad32d83e52fbb9bde714a4e91ddd4cca7">last_errno</a>= <a class="code" href="../../d1/d40/mysqld__error_8h.html#a921ec3d0c9c7bc371ef2d12bf656d72b">ER_NET_FCNTL_ERROR</a>;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="preprocessor">#ifdef MYSQL_SERVER</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <a class="code" href="../../db/da9/my__sys_8h.html#a19ebf963aef6b242322e15e01811972e">my_error</a>(<a class="code" href="../../d1/d40/mysqld__error_8h.html#a921ec3d0c9c7bc371ef2d12bf656d72b">ER_NET_FCNTL_ERROR</a>, <a class="code" href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a>(0));</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <span class="keywordflow">goto</span> end;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;          }</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;          retry_count=0;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        }</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      }</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* (!defined(__WIN__) || defined(MYSQL_SERVER) */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d85/thr__alarm_8h.html#a551404263c6127823adcc2ee3b0dd5e9">thr_alarm_in_use</a>(&amp;alarmed) &amp;&amp; !<a class="code" href="../../d5/d85/thr__alarm_8h.html#a5bfc1020351ad4186df2c4bb98cfbac9">thr_got_alarm</a>(&amp;alarmed) &amp;&amp;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;          interrupted)</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      {                 <span class="comment">/* Probably in MIT threads */</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        <span class="keywordflow">if</span> (retry_count++ &lt; net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a0365f5779e0d4a8052dbd26a04196b5b">retry_count</a>)</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="preprocessor">#ifdef EXTRA_DEBUG</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        <a class="code" href="../../d3/d6b/printf_8h.html#a9f315126362cae9675de1642105e631e">fprintf</a>(stderr, <span class="stringliteral">&quot;%s: read looped with error %d, aborting thread\n&quot;</span>,</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;            <a class="code" href="../../db/da9/my__sys_8h.html#a98dde45574f5cf90dc6a9a4a5090f47a">my_progname</a>,<a class="code" href="../../d2/dd9/violite_8h.html#a07905c60f1763b59da8f2d7b3dad4922">vio_errno</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>));</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* EXTRA_DEBUG */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="preprocessor">#if defined(THREAD_SAFE_CLIENT) &amp;&amp; !defined(MYSQL_SERVER)</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd9/violite_8h.html#a07905c60f1763b59da8f2d7b3dad4922">vio_errno</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>) == <a class="code" href="../../d9/df6/my__global_8h.html#a973befee10a0b80c3dffcf3b616b8a40">SOCKET_EINTR</a>)</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;warning&quot;</span>,(<span class="stringliteral">&quot;Interrupted read. Retrying...&quot;</span>));</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;error&quot;</span>,(<span class="stringliteral">&quot;Couldn&#39;t read packet: remain: %u  errno: %d  length: %ld&quot;</span>,</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                  remain, <a class="code" href="../../d2/dd9/violite_8h.html#a07905c60f1763b59da8f2d7b3dad4922">vio_errno</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>), (<span class="keywordtype">long</span>) <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>));</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      len= <a class="code" href="../../d6/df0/mysql__com_8h.html#a08253bf6eaa0178369f3ee1055b914a0">packet_error</a>;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af25692866530d247001f5c189ffca8f6">error</a>= 2;                <span class="comment">/* Close socket */</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;          net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ad32d83e52fbb9bde714a4e91ddd4cca7">last_errno</a>= (<a class="code" href="../../d2/dd9/violite_8h.html#a1088917abfda0ffa6456775b41b86875">vio_was_interrupted</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>) ?</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                                   <a class="code" href="../../d1/d40/mysqld__error_8h.html#a4ced0fa6489e98bb47360fc36d9d2272">ER_NET_READ_INTERRUPTED</a> :</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                                   <a class="code" href="../../d1/d40/mysqld__error_8h.html#ae22292a367193d5d12a3827cd016d821">ER_NET_READ_ERROR</a>);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="preprocessor">#ifdef MYSQL_SERVER</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;          <a class="code" href="../../db/da9/my__sys_8h.html#a19ebf963aef6b242322e15e01811972e">my_error</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ad32d83e52fbb9bde714a4e91ddd4cca7">last_errno</a>, <a class="code" href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a>(0));</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <span class="keywordflow">goto</span> end;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    }</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    remain -= (<a class="code" href="../../df/de2/namespace_g3_d.html#ae911b90657d7162d47997c702af655a8">uint32</a>) <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <a class="code" href="../../db/d36/base64_8c.html#a5e75484d7880fa39b31f27c3d7058936">pos</a>+= <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <a class="code" href="../../dc/d7b/net__serv_8cc.html#a5b872400e7ae3e61fc811a6dee4023b2">update_statistics</a>(<a class="code" href="../../db/da9/my__sys_8h.html#a381d070d3521f29b3fbc6c4454d724bd">thd_increment_bytes_received</a>(<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>));</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      }</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      <span class="keywordflow">if</span> (i == 0)</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      {                 <span class="comment">/* First parts is packet length */</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> helping;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <a class="code" href="../../d1/d35/dbug__long_8h.html#a986ff5ad8d1d935c5d8b0df13b6965a5">DBUG_DUMP</a>(<span class="stringliteral">&quot;packet_header&quot;</span>, net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>+net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a>,</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                  <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>);</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <span class="keywordflow">if</span> (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>[net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a> + 3] != (<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>) net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee20cf636fc25c58b9da8c9aeabc33a9">pkt_nr</a>)</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    {</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <span class="keywordflow">if</span> (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>[net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a>] != (<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>) 255)</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      {</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;error&quot;</span>,</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;               (<span class="stringliteral">&quot;Packets out of order (Found: %d, expected %u)&quot;</span>,</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            (<span class="keywordtype">int</span>) net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>[net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a> + 3],</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee20cf636fc25c58b9da8c9aeabc33a9">pkt_nr</a>));</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            <span class="comment">/* </span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">              We don&#39;t make noise server side, since the client is expected</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">              to break the protocol for e.g. --send LOAD DATA .. LOCAL where</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">              the server expects the client to send a file, but the client</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment">              may reply with a new command instead.</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">            */</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="preprocessor">#if defined (EXTRA_DEBUG) &amp;&amp; !defined (MYSQL_SERVER)</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            fflush(stdout);</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <a class="code" href="../../d3/d6b/printf_8h.html#a9f315126362cae9675de1642105e631e">fprintf</a>(stderr,<span class="stringliteral">&quot;Error: Packets out of order (Found: %d, expected %d)\n&quot;</span>,</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            (<span class="keywordtype">int</span>) net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>[net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a> + 3],</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            (<a class="code" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a>) (<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>) net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee20cf636fc25c58b9da8c9aeabc33a9">pkt_nr</a>);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            fflush(stderr);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;            <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(0);</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      }</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      len= <a class="code" href="../../d6/df0/mysql__com_8h.html#a08253bf6eaa0178369f3ee1055b914a0">packet_error</a>;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;          <span class="comment">/* Not a NET error on the client. XXX: why? */</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="preprocessor">#ifdef MYSQL_SERVER</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      <a class="code" href="../../db/da9/my__sys_8h.html#a19ebf963aef6b242322e15e01811972e">my_error</a>(<a class="code" href="../../d1/d40/mysqld__error_8h.html#a2121f638bdaaf5573872f4735d9a49ca">ER_NET_PACKETS_OUT_OF_ORDER</a>, <a class="code" href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a>(0));</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <span class="keywordflow">goto</span> end;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    }</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee8117a193c6eaf0166b6d140fdc7c8e">compress_pkt_nr</a>= ++net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee20cf636fc25c58b9da8c9aeabc33a9">pkt_nr</a>;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="preprocessor">#ifdef HAVE_COMPRESS</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keywordflow">if</span> (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ae72db65cba31233b606eacd0a0da5769">compress</a>)</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    {</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;          <span class="comment">/*</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="comment">            The following uint3korr() may read 4 bytes, so make sure we don&#39;t</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment">            read unallocated or uninitialized memory. The right-hand expression</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment">            must match the size of the buffer allocated in net_realloc().</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment">          */</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;          <a class="code" href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a> + <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a> + <span class="keyword">sizeof</span>(<a class="code" href="../../db/d35/_define_8h.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>) &lt;=</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                      net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aa992b03f110362b7281ad288326d29e8">max_packet</a> + <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a> + <a class="code" href="../../d6/df0/mysql__com_8h.html#a96b9fe0154bb8a7608f8a2708992ab3e">COMP_HEADER_SIZE</a> + 1);</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      <span class="comment">/*</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="comment">        If the packet is compressed then complen &gt; 0 and contains the</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">        number of bytes in the uncompressed packet</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">      */</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      *complen=<a class="code" href="../../d9/df6/my__global_8h.html#aedc96aeb04ad09b859442aadfc729cc2">uint3korr</a>(&amp;(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>[net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a> + <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>]));</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    }</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160; </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    len=<a class="code" href="../../d9/df6/my__global_8h.html#aedc96aeb04ad09b859442aadfc729cc2">uint3korr</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>+net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a>);</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordflow">if</span> (!len)               <span class="comment">/* End of big multi-packet */</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      <span class="keywordflow">goto</span> end;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    helping = <a class="code" href="../../d9/df6/my__global_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(len,*complen) + net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a>;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="comment">/* The necessary size of net-&gt;buff */</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="keywordflow">if</span> (helping &gt;= net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aa992b03f110362b7281ad288326d29e8">max_packet</a>)</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    {</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dc/d7b/net__serv_8cc.html#a1804171d7de40b147aff8de101cabe4d">net_realloc</a>(net,helping))</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="preprocessor">#if defined(MYSQL_SERVER) &amp;&amp; !defined(NO_ALARM)</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <span class="keywordflow">if</span> (!net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ae72db65cba31233b606eacd0a0da5769">compress</a> &amp;&amp;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                net-&gt;skip_big_packet &amp;&amp;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        !my_net_skip_rest(net, (<a class="code" href="../../db/d35/_define_8h.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>) len, &amp;alarmed, &amp;alarm_buff))</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;          net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af25692866530d247001f5c189ffca8f6">error</a>= 3;        <span class="comment">/* Successfully skiped packet */</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        len= <a class="code" href="../../d6/df0/mysql__com_8h.html#a08253bf6eaa0178369f3ee1055b914a0">packet_error</a>;          <span class="comment">/* Return error and close connection */</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        <span class="keywordflow">goto</span> end;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      }</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    }</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <a class="code" href="../../db/d36/base64_8c.html#a5e75484d7880fa39b31f27c3d7058936">pos</a>=net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a> + net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a>;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    remain = (<a class="code" href="../../df/de2/namespace_g3_d.html#ae911b90657d7162d47997c702af655a8">uint32</a>) len;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      }</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    }</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;end:</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/d85/thr__alarm_8h.html#a551404263c6127823adcc2ee3b0dd5e9">thr_alarm_in_use</a>(&amp;alarmed))</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  {</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> old_mode;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <a class="code" href="../../d5/d85/thr__alarm_8h.html#a150d7f0eb4aeea6341facd6d931475b7">thr_end_alarm</a>(&amp;alarmed);</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <a class="code" href="../../d2/dd9/violite_8h.html#a596127c4837248ffc807b60df342b84e">vio_blocking</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>, net_blocking, &amp;old_mode);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  }</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af097f7a98db2436221b2633daf1e6cba">reading_or_writing</a>=0;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="preprocessor">#ifdef DEBUG_DATA_PACKETS</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="keywordflow">if</span> (len != <a class="code" href="../../d6/df0/mysql__com_8h.html#a08253bf6eaa0178369f3ee1055b914a0">packet_error</a>)</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#a986ff5ad8d1d935c5d8b0df13b6965a5">DBUG_DUMP</a>(<span class="stringliteral">&quot;data&quot;</span>, net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>+net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ac77e87598c188a301184a305b2766c9c">where_b</a>, len);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="keywordflow">return</span>(len);</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;}</div>
<div class="ttc" id="a_define_8h_html_a22f78cc9780bf32aff91ae17c3101c8d"><div class="ttname"><a href="../../db/d35/_define_8h.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a></div><div class="ttdeci">std::uint32_t uint32</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/_define_8h_source.html#l00114">Define.h:114</a></div></div>
<div class="ttc" id="abase64_8c_html_a5e75484d7880fa39b31f27c3d7058936"><div class="ttname"><a href="../../db/d36/base64_8c.html#a5e75484d7880fa39b31f27c3d7058936">pos</a></div><div class="ttdeci">static uint pos(unsigned char c)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d36/base64_8c_source.html#l00104">base64.c:104</a></div></div>
<div class="ttc" id="ampq-internal_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="../../d8/dec/mpq-internal_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dec/mpq-internal_8h_source.html#l00062">mpq-internal.h:62</a></div></div>
<div class="ttc" id="amy__dbug_8h_html_af5d75f213550ec27715b65d9bdfa45ec"><div class="ttname"><a href="../../d0/d74/my__dbug_8h.html#af5d75f213550ec27715b65d9bdfa45ec">DBUG_ASSERT</a></div><div class="ttdeci">#define DBUG_ASSERT(A)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d74/my__dbug_8h_source.html#l00096">my_dbug.h:96</a></div></div>
<div class="ttc" id="amy__global_8h_html_a973befee10a0b80c3dffcf3b616b8a40"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#a973befee10a0b80c3dffcf3b616b8a40">SOCKET_EINTR</a></div><div class="ttdeci">#define SOCKET_EINTR</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00982">my_global.h:982</a></div></div>
<div class="ttc" id="amy__global_8h_html_affe776513b24d84b39af8ab0930fef7f"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a></div><div class="ttdeci">#define max(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l01386">my_global.h:1386</a></div></div>
<div class="ttc" id="amy__sys_8h_html_a381d070d3521f29b3fbc6c4454d724bd"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#a381d070d3521f29b3fbc6c4454d724bd">thd_increment_bytes_received</a></div><div class="ttdeci">void thd_increment_bytes_received(ulong length)</div></div>
<div class="ttc" id="amy__sys_8h_html_a98dde45574f5cf90dc6a9a4a5090f47a"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#a98dde45574f5cf90dc6a9a4a5090f47a">my_progname</a></div><div class="ttdeci">const char * my_progname</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d89/my__static_8c_source.html#l00029">my_static.c:29</a></div></div>
<div class="ttc" id="amysqld__error_8h_html_a2121f638bdaaf5573872f4735d9a49ca"><div class="ttname"><a href="../../d1/d40/mysqld__error_8h.html#a2121f638bdaaf5573872f4735d9a49ca">ER_NET_PACKETS_OUT_OF_ORDER</a></div><div class="ttdeci">#define ER_NET_PACKETS_OUT_OF_ORDER</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d40/mysqld__error_8h_source.html#l00160">mysqld_error.h:160</a></div></div>
<div class="ttc" id="amysqld__error_8h_html_a4ced0fa6489e98bb47360fc36d9d2272"><div class="ttname"><a href="../../d1/d40/mysqld__error_8h.html#a4ced0fa6489e98bb47360fc36d9d2272">ER_NET_READ_INTERRUPTED</a></div><div class="ttdeci">#define ER_NET_READ_INTERRUPTED</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d40/mysqld__error_8h_source.html#l00163">mysqld_error.h:163</a></div></div>
<div class="ttc" id="amysqld__error_8h_html_a921ec3d0c9c7bc371ef2d12bf656d72b"><div class="ttname"><a href="../../d1/d40/mysqld__error_8h.html#a921ec3d0c9c7bc371ef2d12bf656d72b">ER_NET_FCNTL_ERROR</a></div><div class="ttdeci">#define ER_NET_FCNTL_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d40/mysqld__error_8h_source.html#l00159">mysqld_error.h:159</a></div></div>
<div class="ttc" id="amysqld__error_8h_html_ae22292a367193d5d12a3827cd016d821"><div class="ttname"><a href="../../d1/d40/mysqld__error_8h.html#ae22292a367193d5d12a3827cd016d821">ER_NET_READ_ERROR</a></div><div class="ttdeci">#define ER_NET_READ_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d40/mysqld__error_8h_source.html#l00162">mysqld_error.h:162</a></div></div>
<div class="ttc" id="anamespace_g3_d_html_a69a355f92fa3aab4f301667be00cd3eb"><div class="ttname"><a href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">G3D::length</a></div><div class="ttdeci">float length(float v)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d0b/vector_math_8h_source.html#l00208">vectorMath.h:208</a></div></div>
<div class="ttc" id="anamespace_g3_d_html_ae911b90657d7162d47997c702af655a8"><div class="ttname"><a href="../../df/de2/namespace_g3_d.html#ae911b90657d7162d47997c702af655a8">G3D::uint32</a></div><div class="ttdeci">uint32_t uint32</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dfa/g3dmath_8h_source.html#l00168">g3dmath.h:168</a></div></div>
<div class="ttc" id="anet__serv_8cc_html_a1804171d7de40b147aff8de101cabe4d"><div class="ttname"><a href="../../dc/d7b/net__serv_8cc.html#a1804171d7de40b147aff8de101cabe4d">net_realloc</a></div><div class="ttdeci">my_bool net_realloc(NET *net, size_t length)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7b/net__serv_8cc_source.html#l00160">net_serv.cc:160</a></div></div>
<div class="ttc" id="anet__serv_8cc_html_a5b872400e7ae3e61fc811a6dee4023b2"><div class="ttname"><a href="../../dc/d7b/net__serv_8cc.html#a5b872400e7ae3e61fc811a6dee4023b2">update_statistics</a></div><div class="ttdeci">#define update_statistics(A)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7b/net__serv_8cc_source.html#l00099">net_serv.cc:99</a></div></div>
<div class="ttc" id="aprintf_8h_html_a9f315126362cae9675de1642105e631e"><div class="ttname"><a href="../../d3/d6b/printf_8h.html#a9f315126362cae9675de1642105e631e">fprintf</a></div><div class="ttdeci">auto fprintf(std::FILE *f, const S &amp;fmt, const T &amp;... args) -&gt; int</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d6b/printf_8h_source.html#l00602">printf.h:602</a></div></div>
<div class="ttc" id="astructst__alarm_html"><div class="ttname"><a href="../../d4/d3f/structst__alarm.html">st_alarm</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d85/thr__alarm_8h_source.html#l00080">thr_alarm.h:80</a></div></div>
<div class="ttc" id="astructst__net_html_a0365f5779e0d4a8052dbd26a04196b5b"><div class="ttname"><a href="../../de/d2d/structst__net.html#a0365f5779e0d4a8052dbd26a04196b5b">st_net::retry_count</a></div><div class="ttdeci">unsigned int retry_count</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00294">mysql_com.h:294</a></div></div>
<div class="ttc" id="athr__alarm_8h_html_a0f3d9ec5fc0aa4359ca24674a579ef22"><div class="ttname"><a href="../../d5/d85/thr__alarm_8h.html#a0f3d9ec5fc0aa4359ca24674a579ef22">thr_alarm_t</a></div><div class="ttdeci">thr_alarm_entry * thr_alarm_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d85/thr__alarm_8h_source.html#l00078">thr_alarm.h:78</a></div></div>
<div class="ttc" id="athr__alarm_8h_html_a150d7f0eb4aeea6341facd6d931475b7"><div class="ttname"><a href="../../d5/d85/thr__alarm_8h.html#a150d7f0eb4aeea6341facd6d931475b7">thr_end_alarm</a></div><div class="ttdeci">void thr_end_alarm(thr_alarm_t *alarmed)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/ddb/thr__alarm_8c_source.html#l00244">thr_alarm.c:244</a></div></div>
<div class="ttc" id="athr__alarm_8h_html_a41ddbe2759bc9d1d6c107674bcb88e25"><div class="ttname"><a href="../../d5/d85/thr__alarm_8h.html#a41ddbe2759bc9d1d6c107674bcb88e25">thr_alarm_init</a></div><div class="ttdeci">#define thr_alarm_init(A)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d85/thr__alarm_8h_source.html#l00091">thr_alarm.h:91</a></div></div>
<div class="ttc" id="athr__alarm_8h_html_a551404263c6127823adcc2ee3b0dd5e9"><div class="ttname"><a href="../../d5/d85/thr__alarm_8h.html#a551404263c6127823adcc2ee3b0dd5e9">thr_alarm_in_use</a></div><div class="ttdeci">#define thr_alarm_in_use(A)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d85/thr__alarm_8h_source.html#l00092">thr_alarm.h:92</a></div></div>
<div class="ttc" id="athr__alarm_8h_html_a5bfc1020351ad4186df2c4bb98cfbac9"><div class="ttname"><a href="../../d5/d85/thr__alarm_8h.html#a5bfc1020351ad4186df2c4bb98cfbac9">thr_got_alarm</a></div><div class="ttdeci">#define thr_got_alarm(thr_alarm)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d85/thr__alarm_8h_source.html#l00074">thr_alarm.h:74</a></div></div>
<div class="ttc" id="athr__alarm_8h_html_adbed654dbd2397ea54cc01c3ea919a4f"><div class="ttname"><a href="../../d5/d85/thr__alarm_8h.html#adbed654dbd2397ea54cc01c3ea919a4f">thr_alarm</a></div><div class="ttdeci">my_bool thr_alarm(thr_alarm_t *alarmed, uint sec, ALARM *buff)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/ddb/thr__alarm_8c_source.html#l00152">thr_alarm.c:152</a></div></div>
<div class="ttc" id="aviolite_8h_html_a07905c60f1763b59da8f2d7b3dad4922"><div class="ttname"><a href="../../d2/dd9/violite_8h.html#a07905c60f1763b59da8f2d7b3dad4922">vio_errno</a></div><div class="ttdeci">#define vio_errno(vio)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd9/violite_8h_source.html#l00158">violite.h:158</a></div></div>
<div class="ttc" id="aviolite_8h_html_a1088917abfda0ffa6456775b41b86875"><div class="ttname"><a href="../../d2/dd9/violite_8h.html#a1088917abfda0ffa6456775b41b86875">vio_was_interrupted</a></div><div class="ttdeci">#define vio_was_interrupted(vio)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd9/violite_8h_source.html#l00167">violite.h:167</a></div></div>
<div class="ttc" id="aviolite_8h_html_a15bf5ee18a6133eb651693809d1f94a1"><div class="ttname"><a href="../../d2/dd9/violite_8h.html#a15bf5ee18a6133eb651693809d1f94a1">vio_is_blocking</a></div><div class="ttdeci">#define vio_is_blocking(vio)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd9/violite_8h_source.html#l00163">violite.h:163</a></div></div>
<div class="ttc" id="aviolite_8h_html_a55a066cae80a21e7d85963fbde80df73"><div class="ttname"><a href="../../d2/dd9/violite_8h.html#a55a066cae80a21e7d85963fbde80df73">vio_should_retry</a></div><div class="ttdeci">#define vio_should_retry(vio)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd9/violite_8h_source.html#l00166">violite.h:166</a></div></div>
<div class="ttc" id="aviolite_8h_html_ad246ea579154afe07d5ad34a9f465745"><div class="ttname"><a href="../../d2/dd9/violite_8h.html#ad246ea579154afe07d5ad34a9f465745">vio_read</a></div><div class="ttdeci">#define vio_read(vio, buf, size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd9/violite_8h_source.html#l00159">violite.h:159</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::buff</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00511">COMP_HEADER_SIZE</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00301">st_net::compress</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00293">st_net::compress_pkt_nr</a>, <a class="el" href="../../d0/d74/my__dbug_8h_source.html#l00096">DBUG_ASSERT</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00159">DBUG_DUMP</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00143">DBUG_PRINT</a>, <a class="el" href="../../d1/d40/mysqld__error_8h_source.html#l00159">ER_NET_FCNTL_ERROR</a>, <a class="el" href="../../d1/d40/mysqld__error_8h_source.html#l00160">ER_NET_PACKETS_OUT_OF_ORDER</a>, <a class="el" href="../../d1/d40/mysqld__error_8h_source.html#l00162">ER_NET_READ_ERROR</a>, <a class="el" href="../../d1/d40/mysqld__error_8h_source.html#l00163">ER_NET_READ_INTERRUPTED</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00313">st_net::error</a>, <a class="el" href="../../d3/d6b/printf_8h_source.html#l00602">fprintf()</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00312">st_net::last_errno</a>, <a class="el" href="../../d3/d0b/vector_math_8h_source.html#l00208">G3D::length()</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l01386">max</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00292">st_net::max_packet</a>, <a class="el" href="../../d4/dc6/my__error_8c_source.html#l00071">my_error()</a>, <a class="el" href="../../db/d89/my__static_8c_source.html#l00029">my_progname</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l00995">MYF</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00510">NET_HEADER_SIZE</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00160">net_realloc()</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00334">packet_error</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00293">st_net::pkt_nr</a>, <a class="el" href="../../db/d36/base64_8c_source.html#l00104">pos()</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00294">st_net::read_timeout</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00297">st_net::reading_or_writing</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00294">st_net::retry_count</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l00982">SOCKET_EINTR</a>, <a class="el" href="../../db/da9/my__sys_8h.html#a381d070d3521f29b3fbc6c4454d724bd">thd_increment_bytes_received()</a>, <a class="el" href="../../d6/ddb/thr__alarm_8c_source.html#l00152">thr_alarm()</a>, <a class="el" href="../../d5/d85/thr__alarm_8h_source.html#l00092">thr_alarm_in_use</a>, <a class="el" href="../../d5/d85/thr__alarm_8h_source.html#l00091">thr_alarm_init</a>, <a class="el" href="../../d6/ddb/thr__alarm_8c_source.html#l00244">thr_end_alarm()</a>, <a class="el" href="../../d5/d85/thr__alarm_8h_source.html#l00074">thr_got_alarm</a>, <a class="el" href="../../d8/dec/mpq-internal_8h_source.html#l00062">TRUE</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l01150">uint3korr</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00099">update_statistics</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00283">st_net::vio</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00161">vio_blocking</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00158">vio_errno</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00163">vio_is_blocking</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00159">vio_read</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00166">vio_should_retry</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00167">vio_was_interrupted</a>, and <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00291">st_net::where_b</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l01018">my_net_read()</a>.</p>

</div>
</div>
<a id="abd602000264b4930066da5007c8195fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd602000264b4930066da5007c8195fb">&#9670;&nbsp;</a></span>net_clear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void net_clear </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a>&#160;</td>
          <td class="paramname"><em>clear_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove unwanted characters from connection and check if disconnected.</p>
<p>Read from socket until there is nothing more to read. Discard what is read.</p>
<p>If there is anything when to read 'net_clear' is called this normally indicates an error in the protocol.</p>
<p>When connection is properly closed (for TCP it means with a FIN packet), then select() considers a socket "ready to read", in the sense that there's EOF to read, but <a class="el" href="../../d7/dff/hooks_8h.html#a68dc4fd7189d34e2052e25ada13f89e0">read()</a> returns 0.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">net</td><td>NET handler </td></tr>
    <tr><td class="paramname">clear_buffer</td><td>if &lt;&gt; 0, then clear all data from comm buff </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00274">274</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;{</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="preprocessor">#if !defined(EMBEDDED_LIBRARY)</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="../../d5/d71/fmt_2include_2fmt_2core_8h.html#a501bb1bb2f0cc5706178ed237958e73b">count</a>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keywordtype">int</span> ready;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;net_clear&quot;</span>);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="preprocessor">#if !defined(EMBEDDED_LIBRARY)</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordflow">if</span> (clear_buffer)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">while</span> ((ready= <a class="code" href="../../dc/d7b/net__serv_8cc.html#a2c6096fa4f4d5f183c31e6f512d4fd93">net_data_is_ready</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>-&gt;<a class="code" href="../../df/d29/structst__vio.html#af2208261c74e8ef4f28d691cab7b54cf">sd</a>)) &gt; 0)</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="comment">/* The socket is ready */</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keywordflow">if</span> ((<span class="keywordtype">long</span>) (<a class="code" href="../../d5/d71/fmt_2include_2fmt_2core_8h.html#a501bb1bb2f0cc5706178ed237958e73b">count</a>= <a class="code" href="../../d2/dd9/violite_8h.html#ad246ea579154afe07d5ad34a9f465745">vio_read</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>, net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>,</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                                  (<span class="keywordtype">size_t</span>) net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aa992b03f110362b7281ad288326d29e8">max_packet</a>)) &gt; 0)</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;info&quot;</span>,(<span class="stringliteral">&quot;skipped %ld bytes from file: %s&quot;</span>,</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                           (<span class="keywordtype">long</span>) <a class="code" href="../../d5/d71/fmt_2include_2fmt_2core_8h.html#a501bb1bb2f0cc5706178ed237958e73b">count</a>, <a class="code" href="../../d2/dd9/violite_8h.html#ab6d8347e106e64fdfcffdf0447e7e4d1">vio_description</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>)));</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="preprocessor">#if defined(EXTRA_DEBUG)</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <a class="code" href="../../d3/d6b/printf_8h.html#a9f315126362cae9675de1642105e631e">fprintf</a>(stderr,<span class="stringliteral">&quot;Note: net_clear() skipped %ld bytes from file: %s\n&quot;</span>,</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                (<span class="keywordtype">long</span>) <a class="code" href="../../d5/d71/fmt_2include_2fmt_2core_8h.html#a501bb1bb2f0cc5706178ed237958e73b">count</a>, <a class="code" href="../../d2/dd9/violite_8h.html#ab6d8347e106e64fdfcffdf0447e7e4d1">vio_description</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>));</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;info&quot;</span>,(<span class="stringliteral">&quot;socket ready but only EOF to read - disconnected&quot;</span>));</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af25692866530d247001f5c189ffca8f6">error</a>= 2;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="preprocessor">#ifdef NET_DATA_IS_READY_CAN_RETURN_MINUS_ONE</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">/* &#39;net_data_is_ready&#39; returned &quot;don&#39;t know&quot; */</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">if</span> (ready == -1)</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    {</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="comment">/* Read unblocking to clear net */</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <a class="code" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> old_mode;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d2/dd9/violite_8h.html#a596127c4837248ffc807b60df342b84e">vio_blocking</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>, <a class="code" href="../../d8/dec/mpq-internal_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, &amp;old_mode))</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="keywordflow">while</span> ((<span class="keywordtype">long</span>) (<a class="code" href="../../d5/d71/fmt_2include_2fmt_2core_8h.html#a501bb1bb2f0cc5706178ed237958e73b">count</a>= <a class="code" href="../../d2/dd9/violite_8h.html#ad246ea579154afe07d5ad34a9f465745">vio_read</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>, net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>,</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                                       (<span class="keywordtype">size_t</span>) net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aa992b03f110362b7281ad288326d29e8">max_packet</a>)) &gt; 0)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;          <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;info&quot;</span>,(<span class="stringliteral">&quot;skipped %ld bytes from file: %s&quot;</span>,</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                             (<span class="keywordtype">long</span>) <a class="code" href="../../d5/d71/fmt_2include_2fmt_2core_8h.html#a501bb1bb2f0cc5706178ed237958e73b">count</a>, <a class="code" href="../../d2/dd9/violite_8h.html#ab6d8347e106e64fdfcffdf0447e7e4d1">vio_description</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>)));</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <a class="code" href="../../d2/dd9/violite_8h.html#a596127c4837248ffc807b60df342b84e">vio_blocking</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>, <a class="code" href="../../d8/dec/mpq-internal_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, &amp;old_mode);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    }</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* NET_DATA_IS_READY_CAN_RETURN_MINUS_ONE */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* EMBEDDED_LIBRARY */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee20cf636fc25c58b9da8c9aeabc33a9">pkt_nr</a>=net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee8117a193c6eaf0166b6d140fdc7c8e">compress_pkt_nr</a>=0;       <span class="comment">/* Ready for new command */</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">write_pos</a>=net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a2d990f1c0bd095fcbac9c6596274be55">DBUG_VOID_RETURN</a>;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;}</div>
<div class="ttc" id="afmt_2include_2fmt_2core_8h_html_a501bb1bb2f0cc5706178ed237958e73b"><div class="ttname"><a href="../../d5/d71/fmt_2include_2fmt_2core_8h.html#a501bb1bb2f0cc5706178ed237958e73b">count</a></div><div class="ttdeci">constexpr auto count() -&gt; size_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d71/fmt_2include_2fmt_2core_8h_source.html#l01039">core.h:1039</a></div></div>
<div class="ttc" id="anet__serv_8cc_html_a2c6096fa4f4d5f183c31e6f512d4fd93"><div class="ttname"><a href="../../dc/d7b/net__serv_8cc.html#a2c6096fa4f4d5f183c31e6f512d4fd93">net_data_is_ready</a></div><div class="ttdeci">static int net_data_is_ready(my_socket sd)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7b/net__serv_8cc_source.html#l00217">net_serv.cc:217</a></div></div>
<div class="ttc" id="astructst__vio_html_af2208261c74e8ef4f28d691cab7b54cf"><div class="ttname"><a href="../../df/d29/structst__vio.html#af2208261c74e8ef4f28d691cab7b54cf">st_vio::sd</a></div><div class="ttdeci">my_socket sd</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd9/violite_8h_source.html#l00190">violite.h:190</a></div></div>
<div class="ttc" id="aviolite_8h_html_ab6d8347e106e64fdfcffdf0447e7e4d1"><div class="ttname"><a href="../../d2/dd9/violite_8h.html#ab6d8347e106e64fdfcffdf0447e7e4d1">vio_description</a></div><div class="ttdeci">const char * vio_description(Vio *vio)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d4e/viosocket_8c_source.html#l00301">viosocket.c:301</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::buff</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00293">st_net::compress_pkt_nr</a>, <a class="el" href="../../d5/d71/fmt_2include_2fmt_2core_8h_source.html#l01039">count()</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00143">DBUG_PRINT</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00140">DBUG_VOID_RETURN</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00313">st_net::error</a>, <a class="el" href="../../d8/dec/mpq-internal_8h_source.html#l00059">FALSE</a>, <a class="el" href="../../d3/d6b/printf_8h_source.html#l00602">fprintf()</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00292">st_net::max_packet</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00217">net_data_is_ready()</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00293">st_net::pkt_nr</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00190">st_vio::sd</a>, <a class="el" href="../../d8/dec/mpq-internal_8h_source.html#l00062">TRUE</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00283">st_net::vio</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00161">vio_blocking</a>, <a class="el" href="../../d6/d4e/viosocket_8c_source.html#l00301">vio_description()</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00159">vio_read</a>, and <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::write_pos</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d93/client_8c_source.html#l00808">cli_advanced_command()</a>, <a class="el" href="../../d5/d0a/libmysql_8c_source.html#l02053">cli_stmt_execute()</a>, and <a class="el" href="../../dd/d93/client_8c_source.html#l03470">mysql_reconnect()</a>.</p>

</div>
</div>
<a id="a2c6096fa4f4d5f183c31e6f512d4fd93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c6096fa4f4d5f183c31e6f512d4fd93">&#9670;&nbsp;</a></span>net_data_is_ready()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int net_data_is_ready </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#aed973571b4b7eb2facd8c39e8b500bb6">my_socket</a>&#160;</td>
          <td class="paramname"><em>sd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Check if there is any data to be read from the socket.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sd</td><td>socket descriptor</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>No data to read </td></tr>
    <tr><td class="paramname">1</td><td>Data or EOF to read </td></tr>
    <tr><td class="paramname">-1</td><td>Don't know if data is ready or not </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00217">217</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;{</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="preprocessor">#ifdef HAVE_POLL</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="keyword">struct </span>pollfd ufds;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordtype">int</span> res;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  ufds.fd= sd;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  ufds.events= POLLIN | POLLPRI;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">if</span> (!(res= poll(&amp;ufds, 1, 0)))</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="keywordflow">if</span> (res &lt; 0 || !(ufds.revents &amp; (POLLIN | POLLPRI)))</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  fd_set sfds;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keyword">struct </span>timeval tv;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordtype">int</span> res;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="preprocessor">#ifndef __WIN__</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="comment">/* Windows uses an _array_ of 64 fd&#39;s as default, so it&#39;s safe */</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">if</span> (sd &gt;= <a class="code" href="../../db/d6c/stdsoap2_8h.html#a86c5dbf5a99358e288f573d6a1e0873f">FD_SETSIZE</a>)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="preprocessor">#define NET_DATA_IS_READY_CAN_RETURN_MINUS_ONE</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  FD_ZERO(&amp;sfds);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  FD_SET(sd, &amp;sfds);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  tv.tv_sec= tv.tv_usec= 0;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordflow">if</span> ((res= select((<span class="keywordtype">int</span>) (sd + 1), &amp;sfds, <a class="code" href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a>, <a class="code" href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a>, &amp;tv)) &lt; 0)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d9/df6/my__global_8h.html#aa6cd438f0d8653fd1e4d22046b0cb662">test</a>(res ? FD_ISSET(sd, &amp;sfds) : 0);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_POLL */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;}</div>
<div class="ttc" id="ajemalloc__internal_8h_html_ae89ee89f41328ac0ade1e3e26c103570"><div class="ttname"><a href="../../d9/d33/jemalloc__internal_8h.html#ae89ee89f41328ac0ade1e3e26c103570">NULL</a></div><div class="ttdeci">arena_t NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d33/jemalloc__internal_8h_source.html#l00624">jemalloc_internal.h:624</a></div></div>
<div class="ttc" id="astdsoap2_8h_html_a86c5dbf5a99358e288f573d6a1e0873f"><div class="ttname"><a href="../../db/d6c/stdsoap2_8h.html#a86c5dbf5a99358e288f573d6a1e0873f">FD_SETSIZE</a></div><div class="ttdeci">#define FD_SETSIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6c/stdsoap2_8h_source.html#l01006">stdsoap2.h:1006</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../db/d6c/stdsoap2_8h_source.html#l01006">FD_SETSIZE</a>, <a class="el" href="../../d9/d33/jemalloc__internal_8h_source.html#l00624">NULL</a>, and <a class="el" href="../../d9/df6/my__global_8h_source.html#l00480">test</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00274">net_clear()</a>.</p>

</div>
</div>
<a id="ab71978513c49175a28c7ef3334a82250"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab71978513c49175a28c7ef3334a82250">&#9670;&nbsp;</a></span>net_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void net_end </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00149">149</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;{</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;net_end&quot;</span>);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <a class="code" href="../../db/da9/my__sys_8h.html#a3a3ddffcaadb60b7715c9889f8c56afb">my_free</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>=0;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a2d990f1c0bd095fcbac9c6596274be55">DBUG_VOID_RETURN</a>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;}</div>
<div class="ttc" id="amy__sys_8h_html_a3a3ddffcaadb60b7715c9889f8c56afb"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#a3a3ddffcaadb60b7715c9889f8c56afb">my_free</a></div><div class="ttdeci">void my_free(void *ptr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7c/my__malloc_8c_source.html#l00124">my_malloc.c:124</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::buff</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00140">DBUG_VOID_RETURN</a>, and <a class="el" href="../../d0/d7c/my__malloc_8c_source.html#l00124">my_free()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d93/client_8c_source.html#l01076">end_server()</a>.</p>

</div>
</div>
<a id="a8b25274dbacc2f6d54ce7efffe6c4d4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b25274dbacc2f6d54ce7efffe6c4d4b">&#9670;&nbsp;</a></span>net_flush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> net_flush </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Flush write_buffer if not empty. </p>

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00331">331</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;{</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> <a class="code" href="../../d3/dc6/minigzip_8c.html#aee763da2c1c9da197307bad1d009513d">error</a>= 0;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;net_flush&quot;</span>);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordflow">if</span> (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a> != net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">write_pos</a>)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <a class="code" href="../../d3/dc6/minigzip_8c.html#aee763da2c1c9da197307bad1d009513d">error</a>=<a class="code" href="../../d9/df6/my__global_8h.html#aa6cd438f0d8653fd1e4d22046b0cb662">test</a>(<a class="code" href="../../dc/d7b/net__serv_8cc.html#aab6d3c706ccc04a192b65d195b97e047">net_real_write</a>(net, net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>,</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                  (<span class="keywordtype">size_t</span>) (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">write_pos</a> - net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>)));</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">write_pos</a>=net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="comment">/* Sync packet number if using compression */</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keywordflow">if</span> (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ae72db65cba31233b606eacd0a0da5769">compress</a>)</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee20cf636fc25c58b9da8c9aeabc33a9">pkt_nr</a>=net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee8117a193c6eaf0166b6d140fdc7c8e">compress_pkt_nr</a>;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(<a class="code" href="../../d3/dc6/minigzip_8c.html#aee763da2c1c9da197307bad1d009513d">error</a>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;}</div>
<div class="ttc" id="aminigzip_8c_html_aee763da2c1c9da197307bad1d009513d"><div class="ttname"><a href="../../d3/dc6/minigzip_8c.html#aee763da2c1c9da197307bad1d009513d">error</a></div><div class="ttdeci">void error(char *msg) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dc6/minigzip_8c_source.html#l00156">minigzip.c:156</a></div></div>
<div class="ttc" id="anet__serv_8cc_html_aab6d3c706ccc04a192b65d195b97e047"><div class="ttname"><a href="../../dc/d7b/net__serv_8cc.html#aab6d3c706ccc04a192b65d195b97e047">net_real_write</a></div><div class="ttdeci">int net_real_write(NET *net, const uchar *packet, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7b/net__serv_8cc_source.html#l00568">net_serv.cc:568</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::buff</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00301">st_net::compress</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00293">st_net::compress_pkt_nr</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00138">DBUG_RETURN</a>, <a class="el" href="../../d3/dc6/minigzip_8c_source.html#l00156">error()</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00568">net_real_write()</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00293">st_net::pkt_nr</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l00480">test</a>, and <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::write_pos</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d93/client_8c_source.html#l02655">client_mpvio_write_packet()</a>, <a class="el" href="../../d5/d0a/libmysql_8c_source.html#l00443">handle_local_infile()</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00436">net_write_command()</a>, and <a class="el" href="../../dd/d93/client_8c_source.html#l02425">send_client_reply_packet()</a>.</p>

</div>
</div>
<a id="aab6d3c706ccc04a192b65d195b97e047"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab6d3c706ccc04a192b65d195b97e047">&#9670;&nbsp;</a></span>net_real_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int net_real_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/d95/zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read and write one packet using timeouts. If needed, the packet is compressed before sending.</p>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000006">Todo:</a></b></dt><dd><ul>
<li>TODO is it needed to set this variable if we have no socket </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00568">568</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;{</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *<a class="code" href="../../db/d36/base64_8c.html#a5e75484d7880fa39b31f27c3d7058936">pos</a>,*end;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <a class="code" href="../../d5/d85/thr__alarm_8h.html#a0f3d9ec5fc0aa4359ca24674a579ef22">thr_alarm_t</a> alarmed;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="preprocessor">#ifndef NO_ALARM</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <a class="code" href="../../d4/d3f/structst__alarm.html">ALARM</a> alarm_buff;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> retry_count=0;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> net_blocking = <a class="code" href="../../d2/dd9/violite_8h.html#a15bf5ee18a6133eb651693809d1f94a1">vio_is_blocking</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;net_real_write&quot;</span>);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="preprocessor">#if defined(MYSQL_SERVER) &amp;&amp; defined(USE_QUERY_CACHE)</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  query_cache_insert((<span class="keywordtype">char</span>*) packet, len, net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee20cf636fc25c58b9da8c9aeabc33a9">pkt_nr</a>);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="keywordflow">if</span> (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af25692866530d247001f5c189ffca8f6">error</a> == 2)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(-1);                <span class="comment">/* socket can&#39;t be used */</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af097f7a98db2436221b2633daf1e6cba">reading_or_writing</a>=2;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="preprocessor">#ifdef HAVE_COMPRESS</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="keywordflow">if</span> (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ae72db65cba31233b606eacd0a0da5769">compress</a>)</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  {</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordtype">size_t</span> complen;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *<a class="code" href="../../df/d31/prof_8c.html#a3fca4d23183335e3d46f507d28e94e8b">b</a>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> header_length=<a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>+<a class="code" href="../../d6/df0/mysql__com_8h.html#a96b9fe0154bb8a7608f8a2708992ab3e">COMP_HEADER_SIZE</a>;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">if</span> (!(<a class="code" href="../../df/d31/prof_8c.html#a3fca4d23183335e3d46f507d28e94e8b">b</a>= (<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>*) <a class="code" href="../../db/da9/my__sys_8h.html#a8f7b30ff5d0e10610637aa30c3e0048b">my_malloc</a>(len + <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a> +</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                                <a class="code" href="../../d6/df0/mysql__com_8h.html#a96b9fe0154bb8a7608f8a2708992ab3e">COMP_HEADER_SIZE</a>, <a class="code" href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a>(<a class="code" href="../../db/da9/my__sys_8h.html#a95e2a52417433d23f6b8825c52ee9197">MY_WME</a>))))</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af25692866530d247001f5c189ffca8f6">error</a>= 2;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ad32d83e52fbb9bde714a4e91ddd4cca7">last_errno</a>= <a class="code" href="../../d1/d40/mysqld__error_8h.html#ae920041f3d9cce13504b6ad17f459716">ER_OUT_OF_RESOURCES</a>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="comment">/* In the server, the error is reported by MY_WME flag. */</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af097f7a98db2436221b2633daf1e6cba">reading_or_writing</a>= 0;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(1);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <a class="code" href="../../d6/dda/m__string_8h.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a>(<a class="code" href="../../df/d31/prof_8c.html#a3fca4d23183335e3d46f507d28e94e8b">b</a>+header_length,packet,len);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../db/da9/my__sys_8h.html#a59c8a4d33716e5040b14dd57ebd62788">my_compress</a>(<a class="code" href="../../df/d31/prof_8c.html#a3fca4d23183335e3d46f507d28e94e8b">b</a>+header_length, &amp;len, &amp;complen))</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      complen=0;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a604b63506b0857bf76b616883aeb1099">int3store</a>(&amp;<a class="code" href="../../df/d31/prof_8c.html#a3fca4d23183335e3d46f507d28e94e8b">b</a>[<a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>],complen);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a604b63506b0857bf76b616883aeb1099">int3store</a>(<a class="code" href="../../df/d31/prof_8c.html#a3fca4d23183335e3d46f507d28e94e8b">b</a>,len);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <a class="code" href="../../df/d31/prof_8c.html#a3fca4d23183335e3d46f507d28e94e8b">b</a>[3]=(<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>) (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee8117a193c6eaf0166b6d140fdc7c8e">compress_pkt_nr</a>++);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    len+= header_length;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    packet= <a class="code" href="../../df/d31/prof_8c.html#a3fca4d23183335e3d46f507d28e94e8b">b</a>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_COMPRESS */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="preprocessor">#ifdef DEBUG_DATA_PACKETS</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a986ff5ad8d1d935c5d8b0df13b6965a5">DBUG_DUMP</a>(<span class="stringliteral">&quot;data&quot;</span>, packet, len);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="preprocessor">#ifndef NO_ALARM</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <a class="code" href="../../d5/d85/thr__alarm_8h.html#a41ddbe2759bc9d1d6c107674bcb88e25">thr_alarm_init</a>(&amp;alarmed);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <span class="keywordflow">if</span> (net_blocking)</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <a class="code" href="../../d5/d85/thr__alarm_8h.html#adbed654dbd2397ea54cc01c3ea919a4f">thr_alarm</a>(&amp;alarmed, net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a178724b62ac9b041f5e21b1b9897b694">write_timeout</a>, &amp;alarm_buff);</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  alarmed=0;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="comment">/* Write timeout is set in my_net_set_write_timeout */</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* NO_ALARM */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <a class="code" href="../../db/d36/base64_8c.html#a5e75484d7880fa39b31f27c3d7058936">pos</a>= packet;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  end=<a class="code" href="../../db/d36/base64_8c.html#a5e75484d7880fa39b31f27c3d7058936">pos</a>+len;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="../../db/d36/base64_8c.html#a5e75484d7880fa39b31f27c3d7058936">pos</a> != end)</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">if</span> ((<span class="keywordtype">long</span>) (<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>= <a class="code" href="../../d2/dd9/violite_8h.html#ad3182b0e22af9ae4620d853dad75a9d0">vio_write</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>,<a class="code" href="../../db/d36/base64_8c.html#a5e75484d7880fa39b31f27c3d7058936">pos</a>,(<span class="keywordtype">size_t</span>) (end-<a class="code" href="../../db/d36/base64_8c.html#a5e75484d7880fa39b31f27c3d7058936">pos</a>))) &lt;= 0)</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <a class="code" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> interrupted = <a class="code" href="../../d2/dd9/violite_8h.html#a55a066cae80a21e7d85963fbde80df73">vio_should_retry</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="preprocessor">#if !defined(__WIN__)</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <span class="keywordflow">if</span> ((interrupted || <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a> == 0) &amp;&amp; !<a class="code" href="../../d5/d85/thr__alarm_8h.html#a551404263c6127823adcc2ee3b0dd5e9">thr_alarm_in_use</a>(&amp;alarmed))</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d85/thr__alarm_8h.html#adbed654dbd2397ea54cc01c3ea919a4f">thr_alarm</a>(&amp;alarmed, net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a178724b62ac9b041f5e21b1b9897b694">write_timeout</a>, &amp;alarm_buff))</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        {                                       <span class="comment">/* Always true for client */</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <a class="code" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> old_mode;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="keywordflow">while</span> (<a class="code" href="../../d2/dd9/violite_8h.html#a596127c4837248ffc807b60df342b84e">vio_blocking</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>, <a class="code" href="../../d8/dec/mpq-internal_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, &amp;old_mode) &lt; 0)</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd9/violite_8h.html#a55a066cae80a21e7d85963fbde80df73">vio_should_retry</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>) &amp;&amp; retry_count++ &lt; net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a0365f5779e0d4a8052dbd26a04196b5b">retry_count</a>)</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="preprocessor">#ifdef EXTRA_DEBUG</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <a class="code" href="../../d3/d6b/printf_8h.html#a9f315126362cae9675de1642105e631e">fprintf</a>(stderr,</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            <span class="stringliteral">&quot;%s: my_net_write: fcntl returned error %d, aborting thread\n&quot;</span>,</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            <a class="code" href="../../db/da9/my__sys_8h.html#a98dde45574f5cf90dc6a9a4a5090f47a">my_progname</a>,<a class="code" href="../../d2/dd9/violite_8h.html#a07905c60f1763b59da8f2d7b3dad4922">vio_errno</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>));</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* EXTRA_DEBUG */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af25692866530d247001f5c189ffca8f6">error</a>= 2;                     <span class="comment">/* Close socket */</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ad32d83e52fbb9bde714a4e91ddd4cca7">last_errno</a>= <a class="code" href="../../d1/d40/mysqld__error_8h.html#a36242e3abf5ef2e583302bfbb6eacab5">ER_NET_PACKET_TOO_LARGE</a>;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="preprocessor">#ifdef MYSQL_SERVER</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            <a class="code" href="../../db/da9/my__sys_8h.html#a19ebf963aef6b242322e15e01811972e">my_error</a>(<a class="code" href="../../d1/d40/mysqld__error_8h.html#a36242e3abf5ef2e583302bfbb6eacab5">ER_NET_PACKET_TOO_LARGE</a>, <a class="code" href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a>(0));</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordflow">goto</span> end;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      retry_count=0;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* !defined(__WIN__) */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d5/d85/thr__alarm_8h.html#a551404263c6127823adcc2ee3b0dd5e9">thr_alarm_in_use</a>(&amp;alarmed) &amp;&amp; !<a class="code" href="../../d5/d85/thr__alarm_8h.html#a5bfc1020351ad4186df2c4bb98cfbac9">thr_got_alarm</a>(&amp;alarmed) &amp;&amp;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        interrupted)</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">if</span> (retry_count++ &lt; net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a0365f5779e0d4a8052dbd26a04196b5b">retry_count</a>)</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="preprocessor">#ifdef EXTRA_DEBUG</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <a class="code" href="../../d3/d6b/printf_8h.html#a9f315126362cae9675de1642105e631e">fprintf</a>(stderr, <span class="stringliteral">&quot;%s: write looped, aborting thread\n&quot;</span>,</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;          <a class="code" href="../../db/da9/my__sys_8h.html#a98dde45574f5cf90dc6a9a4a5090f47a">my_progname</a>);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* EXTRA_DEBUG */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      }</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="preprocessor">#if defined(THREAD_SAFE_CLIENT) &amp;&amp; !defined(MYSQL_SERVER)</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd9/violite_8h.html#a07905c60f1763b59da8f2d7b3dad4922">vio_errno</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>) == <a class="code" href="../../d9/df6/my__global_8h.html#a973befee10a0b80c3dffcf3b616b8a40">SOCKET_EINTR</a>)</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;warning&quot;</span>,(<span class="stringliteral">&quot;Interrupted write. Retrying...&quot;</span>));</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      }</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* defined(THREAD_SAFE_CLIENT) &amp;&amp; !defined(MYSQL_SERVER) */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af25692866530d247001f5c189ffca8f6">error</a>= 2;                <span class="comment">/* Close socket */</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ad32d83e52fbb9bde714a4e91ddd4cca7">last_errno</a>= (interrupted ? <a class="code" href="../../d1/d40/mysqld__error_8h.html#a101933baf213e044cd2c8f48e87844c3">ER_NET_WRITE_INTERRUPTED</a> :</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                               <a class="code" href="../../d1/d40/mysqld__error_8h.html#aaa12ccc0cb362622f3a49af81cfbdf0e">ER_NET_ERROR_ON_WRITE</a>);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="preprocessor">#ifdef MYSQL_SERVER</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <a class="code" href="../../db/da9/my__sys_8h.html#a19ebf963aef6b242322e15e01811972e">my_error</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ad32d83e52fbb9bde714a4e91ddd4cca7">last_errno</a>, <a class="code" href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a>(0));</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* MYSQL_SERVER */</span><span class="preprocessor"></span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <a class="code" href="../../db/d36/base64_8c.html#a5e75484d7880fa39b31f27c3d7058936">pos</a>+=<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <a class="code" href="../../dc/d7b/net__serv_8cc.html#a5b872400e7ae3e61fc811a6dee4023b2">update_statistics</a>(<a class="code" href="../../dc/d7b/net__serv_8cc.html#afb18611755c8b5d7e12fceeee266f082">thd_increment_bytes_sent</a>(<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>));</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  }</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="preprocessor">#ifndef __WIN__</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; end:</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="preprocessor">#ifdef HAVE_COMPRESS</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  <span class="keywordflow">if</span> (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ae72db65cba31233b606eacd0a0da5769">compress</a>)</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <a class="code" href="../../db/da9/my__sys_8h.html#a3a3ddffcaadb60b7715c9889f8c56afb">my_free</a>((<span class="keywordtype">void</span>*) packet);</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../d5/d85/thr__alarm_8h.html#a551404263c6127823adcc2ee3b0dd5e9">thr_alarm_in_use</a>(&amp;alarmed))</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <a class="code" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> old_mode;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <a class="code" href="../../d5/d85/thr__alarm_8h.html#a150d7f0eb4aeea6341facd6d931475b7">thr_end_alarm</a>(&amp;alarmed);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <a class="code" href="../../d2/dd9/violite_8h.html#a596127c4837248ffc807b60df342b84e">vio_blocking</a>(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a04dd4cfb0c11319b3ced573c160d75d5">vio</a>, net_blocking, &amp;old_mode);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af097f7a98db2436221b2633daf1e6cba">reading_or_writing</a>=0;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(((<span class="keywordtype">int</span>) (<a class="code" href="../../db/d36/base64_8c.html#a5e75484d7880fa39b31f27c3d7058936">pos</a> != end)));</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;}</div>
<div class="ttc" id="am__string_8h_html_aed653b4838032a2c5ce8960421c8cfd7"><div class="ttname"><a href="../../d6/dda/m__string_8h.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a></div><div class="ttdeci">#define memcpy(d, s, n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dda/m__string_8h_source.html#l00050">m_string.h:50</a></div></div>
<div class="ttc" id="amy__sys_8h_html_a59c8a4d33716e5040b14dd57ebd62788"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#a59c8a4d33716e5040b14dd57ebd62788">my_compress</a></div><div class="ttdeci">my_bool my_compress(uchar *, size_t *, size_t *)</div></div>
<div class="ttc" id="amysqld__error_8h_html_a101933baf213e044cd2c8f48e87844c3"><div class="ttname"><a href="../../d1/d40/mysqld__error_8h.html#a101933baf213e044cd2c8f48e87844c3">ER_NET_WRITE_INTERRUPTED</a></div><div class="ttdeci">#define ER_NET_WRITE_INTERRUPTED</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d40/mysqld__error_8h_source.html#l00165">mysqld_error.h:165</a></div></div>
<div class="ttc" id="amysqld__error_8h_html_a36242e3abf5ef2e583302bfbb6eacab5"><div class="ttname"><a href="../../d1/d40/mysqld__error_8h.html#a36242e3abf5ef2e583302bfbb6eacab5">ER_NET_PACKET_TOO_LARGE</a></div><div class="ttdeci">#define ER_NET_PACKET_TOO_LARGE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d40/mysqld__error_8h_source.html#l00157">mysqld_error.h:157</a></div></div>
<div class="ttc" id="amysqld__error_8h_html_aaa12ccc0cb362622f3a49af81cfbdf0e"><div class="ttname"><a href="../../d1/d40/mysqld__error_8h.html#aaa12ccc0cb362622f3a49af81cfbdf0e">ER_NET_ERROR_ON_WRITE</a></div><div class="ttdeci">#define ER_NET_ERROR_ON_WRITE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d40/mysqld__error_8h_source.html#l00164">mysqld_error.h:164</a></div></div>
<div class="ttc" id="amysqld__error_8h_html_ae920041f3d9cce13504b6ad17f459716"><div class="ttname"><a href="../../d1/d40/mysqld__error_8h.html#ae920041f3d9cce13504b6ad17f459716">ER_OUT_OF_RESOURCES</a></div><div class="ttdeci">#define ER_OUT_OF_RESOURCES</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d40/mysqld__error_8h_source.html#l00045">mysqld_error.h:45</a></div></div>
<div class="ttc" id="anet__serv_8cc_html_afb18611755c8b5d7e12fceeee266f082"><div class="ttname"><a href="../../dc/d7b/net__serv_8cc.html#afb18611755c8b5d7e12fceeee266f082">thd_increment_bytes_sent</a></div><div class="ttdeci">#define thd_increment_bytes_sent(N)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7b/net__serv_8cc_source.html#l00100">net_serv.cc:100</a></div></div>
<div class="ttc" id="aprof_8c_html_a3fca4d23183335e3d46f507d28e94e8b"><div class="ttname"><a href="../../df/d31/prof_8c.html#a3fca4d23183335e3d46f507d28e94e8b">b</a></div><div class="ttdeci">const prof_gctx_t * b</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d31/prof_8c_source.html#l00277">prof.c:277</a></div></div>
<div class="ttc" id="aviolite_8h_html_ad3182b0e22af9ae4620d853dad75a9d0"><div class="ttname"><a href="../../d2/dd9/violite_8h.html#ad3182b0e22af9ae4620d853dad75a9d0">vio_write</a></div><div class="ttdeci">#define vio_write(vio, buf, size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd9/violite_8h_source.html#l00160">violite.h:160</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../df/d31/prof_8c_source.html#l00277">b</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00511">COMP_HEADER_SIZE</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00301">st_net::compress</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00293">st_net::compress_pkt_nr</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00159">DBUG_DUMP</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00143">DBUG_PRINT</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00138">DBUG_RETURN</a>, <a class="el" href="../../d1/d40/mysqld__error_8h_source.html#l00164">ER_NET_ERROR_ON_WRITE</a>, <a class="el" href="../../d1/d40/mysqld__error_8h_source.html#l00157">ER_NET_PACKET_TOO_LARGE</a>, <a class="el" href="../../d1/d40/mysqld__error_8h_source.html#l00165">ER_NET_WRITE_INTERRUPTED</a>, <a class="el" href="../../d1/d40/mysqld__error_8h_source.html#l00045">ER_OUT_OF_RESOURCES</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00313">st_net::error</a>, <a class="el" href="../../d3/d6b/printf_8h_source.html#l00602">fprintf()</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l01181">int3store</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00312">st_net::last_errno</a>, <a class="el" href="../../d3/d0b/vector_math_8h_source.html#l00208">G3D::length()</a>, <a class="el" href="../../d6/dda/m__string_8h_source.html#l00050">memcpy</a>, <a class="el" href="../../db/da9/my__sys_8h.html#a59c8a4d33716e5040b14dd57ebd62788">my_compress()</a>, <a class="el" href="../../d4/dc6/my__error_8c_source.html#l00071">my_error()</a>, <a class="el" href="../../d0/d7c/my__malloc_8c_source.html#l00124">my_free()</a>, <a class="el" href="../../d0/d7c/my__malloc_8c_source.html#l00028">my_malloc()</a>, <a class="el" href="../../db/d89/my__static_8c_source.html#l00029">my_progname</a>, <a class="el" href="../../db/da9/my__sys_8h_source.html#l00073">MY_WME</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l00995">MYF</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00510">NET_HEADER_SIZE</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00293">st_net::pkt_nr</a>, <a class="el" href="../../db/d36/base64_8c_source.html#l00104">pos()</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00297">st_net::reading_or_writing</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00294">st_net::retry_count</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l00982">SOCKET_EINTR</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00100">thd_increment_bytes_sent</a>, <a class="el" href="../../d6/ddb/thr__alarm_8c_source.html#l00152">thr_alarm()</a>, <a class="el" href="../../d5/d85/thr__alarm_8h_source.html#l00092">thr_alarm_in_use</a>, <a class="el" href="../../d5/d85/thr__alarm_8h_source.html#l00091">thr_alarm_init</a>, <a class="el" href="../../d6/ddb/thr__alarm_8c_source.html#l00244">thr_end_alarm()</a>, <a class="el" href="../../d5/d85/thr__alarm_8h_source.html#l00074">thr_got_alarm</a>, <a class="el" href="../../d8/dec/mpq-internal_8h_source.html#l00062">TRUE</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00099">update_statistics</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00283">st_net::vio</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00161">vio_blocking</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00158">vio_errno</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00163">vio_is_blocking</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00166">vio_should_retry</a>, <a class="el" href="../../d2/dd9/violite_8h_source.html#l00160">vio_write</a>, and <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00294">st_net::write_timeout</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00331">net_flush()</a>, and <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00510">net_write_buff()</a>.</p>

</div>
</div>
<a id="a1804171d7de40b147aff8de101cabe4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1804171d7de40b147aff8de101cabe4d">&#9670;&nbsp;</a></span>net_realloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> net_realloc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Realloc the packet buffer. </p>

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00160">160</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;{</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *buff;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordtype">size_t</span> pkt_length;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;net_realloc&quot;</span>);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;enter&quot;</span>,(<span class="stringliteral">&quot;length: %lu&quot;</span>, (<a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>));</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a> &gt;= net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a519fa13bc0447d4058c9f32b9b34a08a">max_packet_size</a>)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;error&quot;</span>, (<span class="stringliteral">&quot;Packet too large. Max size: %lu&quot;</span>,</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                         net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a519fa13bc0447d4058c9f32b9b34a08a">max_packet_size</a>));</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">/* @todo: 1 and 2 codes are identical. */</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af25692866530d247001f5c189ffca8f6">error</a>= 1;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ad32d83e52fbb9bde714a4e91ddd4cca7">last_errno</a>= <a class="code" href="../../d1/d40/mysqld__error_8h.html#a36242e3abf5ef2e583302bfbb6eacab5">ER_NET_PACKET_TOO_LARGE</a>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor">#ifdef MYSQL_SERVER</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="../../db/da9/my__sys_8h.html#a19ebf963aef6b242322e15e01811972e">my_error</a>(<a class="code" href="../../d1/d40/mysqld__error_8h.html#a36242e3abf5ef2e583302bfbb6eacab5">ER_NET_PACKET_TOO_LARGE</a>, <a class="code" href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a>(0));</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(1);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  pkt_length = (<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>+<a class="code" href="../../d9/df6/my__global_8h.html#ad2a9cf487b471119a07cba3db4bdf7d2">IO_SIZE</a>-1) &amp; ~(<a class="code" href="../../d9/df6/my__global_8h.html#ad2a9cf487b471119a07cba3db4bdf7d2">IO_SIZE</a>-1); </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">    We must allocate some extra bytes for the end 0 and to be able to</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">    read big compressed blocks + 1 safety byte since uint3korr() in</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">    my_real_read() may actually read 4 bytes depending on build flags and</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">    platform.</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">if</span> (!(buff= (<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>*) <a class="code" href="../../db/da9/my__sys_8h.html#a9b01110f16af641d57c10fb2df0cc77e">my_realloc</a>((<span class="keywordtype">char</span>*) net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>, pkt_length +</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                  <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a> + <a class="code" href="../../d6/df0/mysql__com_8h.html#a96b9fe0154bb8a7608f8a2708992ab3e">COMP_HEADER_SIZE</a> + 1,</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                                  <a class="code" href="../../d9/df6/my__global_8h.html#ab3b3804e3bf2734c0f4f1c72f30df1bd">MYF</a>(<a class="code" href="../../db/da9/my__sys_8h.html#a95e2a52417433d23f6b8825c52ee9197">MY_WME</a>))))</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  {</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">/* @todo: 1 and 2 codes are identical. */</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af25692866530d247001f5c189ffca8f6">error</a>= 1;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ad32d83e52fbb9bde714a4e91ddd4cca7">last_errno</a>= <a class="code" href="../../d1/d40/mysqld__error_8h.html#ae920041f3d9cce13504b6ad17f459716">ER_OUT_OF_RESOURCES</a>;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">/* In the server the error is reported by MY_WME flag. */</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(1);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>=net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">write_pos</a>=buff;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ab8bc042e4c3feef2117642cee822dc65">buff_end</a>=buff+(net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aa992b03f110362b7281ad288326d29e8">max_packet</a>= (<a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) pkt_length);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(0);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div>
<div class="ttc" id="amy__global_8h_html_ad2a9cf487b471119a07cba3db4bdf7d2"><div class="ttname"><a href="../../d9/df6/my__global_8h.html#ad2a9cf487b471119a07cba3db4bdf7d2">IO_SIZE</a></div><div class="ttdeci">#define IO_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df6/my__global_8h_source.html#l00662">my_global.h:662</a></div></div>
<div class="ttc" id="amy__sys_8h_html_a9b01110f16af641d57c10fb2df0cc77e"><div class="ttname"><a href="../../db/da9/my__sys_8h.html#a9b01110f16af641d57c10fb2df0cc77e">my_realloc</a></div><div class="ttdeci">void * my_realloc(void *oldpoint, size_t Size, myf MyFlags)</div><div class="ttdoc">wrapper around realloc()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d7c/my__malloc_8c_source.html#l00074">my_malloc.c:74</a></div></div>
<div class="ttc" id="astructst__net_html_a519fa13bc0447d4058c9f32b9b34a08a"><div class="ttname"><a href="../../de/d2d/structst__net.html#a519fa13bc0447d4058c9f32b9b34a08a">st_net::max_packet_size</a></div><div class="ttdeci">unsigned long max_packet_size</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df0/mysql__com_8h_source.html#l00292">mysql_com.h:292</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::buff</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::buff_end</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00511">COMP_HEADER_SIZE</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00143">DBUG_PRINT</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00138">DBUG_RETURN</a>, <a class="el" href="../../d1/d40/mysqld__error_8h_source.html#l00157">ER_NET_PACKET_TOO_LARGE</a>, <a class="el" href="../../d1/d40/mysqld__error_8h_source.html#l00045">ER_OUT_OF_RESOURCES</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00313">st_net::error</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l00662">IO_SIZE</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00312">st_net::last_errno</a>, <a class="el" href="../../d3/d0b/vector_math_8h_source.html#l00208">G3D::length()</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00292">st_net::max_packet</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00292">st_net::max_packet_size</a>, <a class="el" href="../../d4/dc6/my__error_8c_source.html#l00071">my_error()</a>, <a class="el" href="../../d0/d7c/my__malloc_8c_source.html#l00074">my_realloc()</a>, <a class="el" href="../../db/da9/my__sys_8h_source.html#l00073">MY_WME</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l00995">MYF</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00510">NET_HEADER_SIZE</a>, and <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::write_pos</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00801">my_real_read()</a>, and <a class="el" href="../../d5/d0a/libmysql_8c_source.html#l01304">my_realloc_str()</a>.</p>

</div>
</div>
<a id="ad35f9f2580bfbba65f69666ac4e081fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad35f9f2580bfbba65f69666ac4e081fd">&#9670;&nbsp;</a></span>net_write_buff()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> net_write_buff </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/d95/zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Caching the data in a local buffer before sending it.</p>
<p>Fill up net-&gt;buffer and send it to the client when full.</p>
<p>If the rest of the to-be-sent-packet is bigger than buffer, send it in one big block (to avoid copying to internal buffer). If not, copy the rest of the data to the buffer and return without sending data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">net</td><td>Network handler </td></tr>
    <tr><td class="paramname">packet</td><td>Packet to send </td></tr>
    <tr><td class="paramname">len</td><td>Length of packet</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>The cached buffer can be sent as it is with '<a class="el" href="../../dc/d7b/net__serv_8cc.html#a8b25274dbacc2f6d54ce7efffe6c4d4b">net_flush()</a>'. In this code we have to be careful to not send a packet longer than MAX_PACKET_LENGTH to <a class="el" href="../../dc/d7b/net__serv_8cc.html#aab6d3c706ccc04a192b65d195b97e047">net_real_write()</a> if we are using the compressed protocol as we store the length of the compressed packet in 3 bytes.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>ok </td></tr>
    <tr><td class="paramname">1</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00510">510</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;{</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a> left_length;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keywordflow">if</span> (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ae72db65cba31233b606eacd0a0da5769">compress</a> &amp;&amp; net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aa992b03f110362b7281ad288326d29e8">max_packet</a> &gt; <a class="code" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a>)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    left_length= (<a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) (<a class="code" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a> - (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">write_pos</a> - net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>));</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    left_length= (<a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ab8bc042e4c3feef2117642cee822dc65">buff_end</a> - net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">write_pos</a>);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="preprocessor">#ifdef DEBUG_DATA_PACKETS</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a986ff5ad8d1d935c5d8b0df13b6965a5">DBUG_DUMP</a>(<span class="stringliteral">&quot;data&quot;</span>, packet, len);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keywordflow">if</span> (len &gt; left_length)</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  {</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordflow">if</span> (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">write_pos</a> != net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>)</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    {</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <span class="comment">/* Fill up already used packet and write it */</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      <a class="code" href="../../d6/dda/m__string_8h.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a>((<span class="keywordtype">char</span>*) net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">write_pos</a>,packet,left_length);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dc/d7b/net__serv_8cc.html#aab6d3c706ccc04a192b65d195b97e047">net_real_write</a>(net, net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>, </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;             (<span class="keywordtype">size_t</span>) (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">write_pos</a> - net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>) + left_length))</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">write_pos</a>= net-&gt;<a class="code" href="../../de/d2d/structst__net.html#a3acff748ebe3823c50d6c77d09281c79">buff</a>;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      packet+= left_length;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      len-= left_length;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">if</span> (net-&gt;<a class="code" href="../../de/d2d/structst__net.html#ae72db65cba31233b606eacd0a0da5769">compress</a>)</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="comment">/*</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">    We can&#39;t have bigger packets than 16M with compression</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">    Because the uncompressed length is stored in 3 bytes</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">      */</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      left_length= <a class="code" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a>;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="keywordflow">while</span> (len &gt; left_length)</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      {</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dc/d7b/net__serv_8cc.html#aab6d3c706ccc04a192b65d195b97e047">net_real_write</a>(net, packet, left_length))</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    packet+= left_length;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    len-= left_length;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    }</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">if</span> (len &gt; net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aa992b03f110362b7281ad288326d29e8">max_packet</a>)</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7b/net__serv_8cc.html#aab6d3c706ccc04a192b65d195b97e047">net_real_write</a>(net, packet, len) ? 1 : 0;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">/* Send out rest of the blocks as full sized blocks */</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  }</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <a class="code" href="../../d6/dda/m__string_8h.html#aed653b4838032a2c5ce8960421c8cfd7">memcpy</a>((<span class="keywordtype">char</span>*) net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">write_pos</a>,packet,len);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  net-&gt;<a class="code" href="../../de/d2d/structst__net.html#af160b75bc1ab06bd72a88ba7417f826e">write_pos</a>+= len;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::buff</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::buff_end</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00301">st_net::compress</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00159">DBUG_DUMP</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00292">st_net::max_packet</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00104">MAX_PACKET_LENGTH</a>, <a class="el" href="../../d6/dda/m__string_8h_source.html#l00050">memcpy</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00568">net_real_write()</a>, and <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00284">st_net::write_pos</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00363">my_net_write()</a>, and <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00436">net_write_command()</a>.</p>

</div>
</div>
<a id="a9b0d71007bd87af2b7dcf334afd13579"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b0d71007bd87af2b7dcf334afd13579">&#9670;&nbsp;</a></span>net_write_command()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/df6/my__global_8h.html#a74cd599039dcf29c6e6d342cf4efd0a8">my_bool</a> net_write_command </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/df0/mysql__com_8h.html#ac623dec3869483fe5aaa5d510f71fd1b">NET</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/d95/zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>head_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/d95/zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="el" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Send a command to the server.</p>
<p>The reason for having both header and packet is so that libmysql can easy add a header to a special command (like prepared statements) without having to re-alloc the string.</p>
<p>As the command is part of the first data packet, we have to do some data juggling to put the command in there, without having to create a new packet.</p>
<p>This function will split big packets into sub-packets if needed. (Each sub packet can only be 2^24 bytes)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">net</td><td>NET handler </td></tr>
    <tr><td class="paramname">command</td><td>Command in <a class="el" href="../../d7/d02/namespace_my_s_q_l.html">MySQL</a> server (enum enum_server_command) </td></tr>
    <tr><td class="paramname">header</td><td>Header to write after command </td></tr>
    <tr><td class="paramname">head_len</td><td>Length of header </td></tr>
    <tr><td class="paramname">packet</td><td>Query or parameter to query </td></tr>
    <tr><td class="paramname">len</td><td>Length of packet</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>ok </td></tr>
    <tr><td class="paramname">1</td><td>error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00436">436</a> of file <a class="el" href="../../dc/d7b/net__serv_8cc_source.html">net_serv.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;{</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>=len+1+head_len;         <span class="comment">/* 1 extra byte for command */</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> buff[<a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>+1];</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a91ad9478d81a7aaf2593e8d9c3d06a14">uint</a> header_size=<a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>+1;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordtype">int</span> rc;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a56a51e0edb39d13c83021fd4e7bdc9e9">DBUG_ENTER</a>(<span class="stringliteral">&quot;net_write_command&quot;</span>);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#a3770d2ff545ed3e4b714d20014e663df">DBUG_PRINT</a>(<span class="stringliteral">&quot;enter&quot;</span>,(<span class="stringliteral">&quot;length: %lu&quot;</span>, (<a class="code" href="../../d9/df6/my__global_8h.html#a718b4eb2652c286f4d42dc18a8e71a1a">ulong</a>) len));</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <a class="code" href="../../db/dbc/probes__mysql__nodtrace_8h.html#a44edec30d2fc862246fc5cd930260a84">MYSQL_NET_WRITE_START</a>(<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  buff[4]=command;              <span class="comment">/* For first packet */</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a> &gt;= <a class="code" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a>)</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  {</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">/* Take into account that we have the command in the first header */</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    len= <a class="code" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a> - 1 - head_len;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">do</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    {</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <a class="code" href="../../d9/df6/my__global_8h.html#a604b63506b0857bf76b616883aeb1099">int3store</a>(buff, <a class="code" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a>);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      buff[3]= (<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>) net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee20cf636fc25c58b9da8c9aeabc33a9">pkt_nr</a>++;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <a class="code" href="../../dd/d68/_c_make_lists_8txt.html#a0b5da418382bdd0db6dff439e2863979">if</a> (<a class="code" href="../../dc/d7b/net__serv_8cc.html#ad35f9f2580bfbba65f69666ac4e081fd">net_write_buff</a>(net, buff, header_size) ||</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <a class="code" href="../../dc/d7b/net__serv_8cc.html#ad35f9f2580bfbba65f69666ac4e081fd">net_write_buff</a>(net, header, head_len) ||</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <a class="code" href="../../dc/d7b/net__serv_8cc.html#ad35f9f2580bfbba65f69666ac4e081fd">net_write_buff</a>(net, packet, len))</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <a class="code" href="../../db/dbc/probes__mysql__nodtrace_8h.html#ac33a63f9118b5a389e2028afaf30e981">MYSQL_NET_WRITE_DONE</a>(1);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(1);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      }</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      packet+= len;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>-= <a class="code" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a>;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      len= <a class="code" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a>;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      head_len= 0;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      header_size= <a class="code" href="../../d6/df0/mysql__com_8h.html#ae6564c0f9410928921c747542d2b53f5">NET_HEADER_SIZE</a>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    } <span class="keywordflow">while</span> (<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a> &gt;= <a class="code" href="../../dc/d7b/net__serv_8cc.html#a973c680573b37fc359fc68d0707da355">MAX_PACKET_LENGTH</a>);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    len=<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>;                 <span class="comment">/* Data left to be written */</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <a class="code" href="../../d9/df6/my__global_8h.html#a604b63506b0857bf76b616883aeb1099">int3store</a>(buff,<a class="code" href="../../df/de2/namespace_g3_d.html#a69a355f92fa3aab4f301667be00cd3eb">length</a>);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  buff[3]= (<a class="code" href="../../d9/df6/my__global_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>) net-&gt;<a class="code" href="../../de/d2d/structst__net.html#aee20cf636fc25c58b9da8c9aeabc33a9">pkt_nr</a>++;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  rc= <a class="code" href="../../d9/df6/my__global_8h.html#aa6cd438f0d8653fd1e4d22046b0cb662">test</a>(<a class="code" href="../../dc/d7b/net__serv_8cc.html#ad35f9f2580bfbba65f69666ac4e081fd">net_write_buff</a>(net, buff, header_size) ||</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;           (head_len &amp;&amp; <a class="code" href="../../dc/d7b/net__serv_8cc.html#ad35f9f2580bfbba65f69666ac4e081fd">net_write_buff</a>(net, header, head_len)) ||</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;           <a class="code" href="../../dc/d7b/net__serv_8cc.html#ad35f9f2580bfbba65f69666ac4e081fd">net_write_buff</a>(net, packet, len) || <a class="code" href="../../dc/d7b/net__serv_8cc.html#a8b25274dbacc2f6d54ce7efffe6c4d4b">net_flush</a>(net));</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <a class="code" href="../../db/dbc/probes__mysql__nodtrace_8h.html#ac33a63f9118b5a389e2028afaf30e981">MYSQL_NET_WRITE_DONE</a>(rc);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <a class="code" href="../../d1/d35/dbug__long_8h.html#af63d1bddf8957387d14fe70b8db22b96">DBUG_RETURN</a>(rc);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;}</div>
<div class="ttc" id="anet__serv_8cc_html_a8b25274dbacc2f6d54ce7efffe6c4d4b"><div class="ttname"><a href="../../dc/d7b/net__serv_8cc.html#a8b25274dbacc2f6d54ce7efffe6c4d4b">net_flush</a></div><div class="ttdeci">my_bool net_flush(NET *net)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7b/net__serv_8cc_source.html#l00331">net_serv.cc:331</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00131">DBUG_ENTER</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00143">DBUG_PRINT</a>, <a class="el" href="../../d1/d35/dbug__long_8h_source.html#l00138">DBUG_RETURN</a>, <a class="el" href="../../dd/d68/_c_make_lists_8txt_source.html#l00068">if()</a>, <a class="el" href="../../d9/df6/my__global_8h_source.html#l01181">int3store</a>, <a class="el" href="../../d3/d0b/vector_math_8h_source.html#l00208">G3D::length()</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00104">MAX_PACKET_LENGTH</a>, <a class="el" href="../../db/dbc/probes__mysql__nodtrace_8h_source.html#l00106">MYSQL_NET_WRITE_DONE</a>, <a class="el" href="../../db/dbc/probes__mysql__nodtrace_8h_source.html#l00104">MYSQL_NET_WRITE_START</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00331">net_flush()</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00510">NET_HEADER_SIZE</a>, <a class="el" href="../../dc/d7b/net__serv_8cc_source.html#l00510">net_write_buff()</a>, <a class="el" href="../../d6/df0/mysql__com_8h_source.html#l00293">st_net::pkt_nr</a>, and <a class="el" href="../../d9/df6/my__global_8h_source.html#l00480">test</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d93/client_8c_source.html#l00808">cli_advanced_command()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
